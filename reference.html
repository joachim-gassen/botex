
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python Package for using LLMs as Participants in oTree Experiments">
      
      
        <meta name="author" content="Fikir Worku Edossa and Joachim Gassen">
      
      
        <link rel="canonical" href="https://joachim-gassen.github.io/botex/reference.html">
      
      
        <link rel="prev" href="tutorials/exp_3llms.html">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>API Reference - botex - LLM Bots for oTree Experiments</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="assets/css/overrides.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="botex - LLM Bots for oTree Experiments" class="md-header__button md-logo" aria-label="botex - LLM Bots for oTree Experiments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            botex - LLM Bots for oTree Experiments
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/joachim-gassen/botex" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    joachim-gassen/botex
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="getting_started.html" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="tutorials/running_an_experiment.html" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="reference.html" class="md-tabs__link">
        
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="botex - LLM Bots for oTree Experiments" class="md-nav__button md-logo" aria-label="botex - LLM Bots for oTree Experiments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    botex - LLM Bots for oTree Experiments
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/joachim-gassen/botex" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    joachim-gassen/botex
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="getting_started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/running_an_experiment.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run an oTree Experiment with botex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="tutorials/exp_3llms.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using botex to Benchmark LLM Performance in oTree Experiments
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="reference.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#command-line-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Command Line Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#botex" class="md-nav__link">
    <span class="md-ellipsis">
      botex
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-api-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Python API: Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python API: Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#load_botex_env" class="md-nav__link">
    <span class="md-ellipsis">
      load_botex_env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start_llamacpp_server" class="md-nav__link">
    <span class="md-ellipsis">
      start_llamacpp_server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop_llamacpp_server" class="md-nav__link">
    <span class="md-ellipsis">
      stop_llamacpp_server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-api-otree-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Python API: oTree Interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python API: oTree Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start_otree_server" class="md-nav__link">
    <span class="md-ellipsis">
      start_otree_server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop_otree_server" class="md-nav__link">
    <span class="md-ellipsis">
      stop_otree_server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#otree_server_is_running" class="md-nav__link">
    <span class="md-ellipsis">
      otree_server_is_running
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_session_configs" class="md-nav__link">
    <span class="md-ellipsis">
      get_session_configs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#init_otree_session" class="md-nav__link">
    <span class="md-ellipsis">
      init_otree_session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_bot_urls" class="md-nav__link">
    <span class="md-ellipsis">
      get_bot_urls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_bots_on_session" class="md-nav__link">
    <span class="md-ellipsis">
      run_bots_on_session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_single_bot" class="md-nav__link">
    <span class="md-ellipsis">
      run_single_bot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-api-export-data" class="md-nav__link">
    <span class="md-ellipsis">
      Python API: Export data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python API: Export data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#read_participants_from_botex_db" class="md-nav__link">
    <span class="md-ellipsis">
      read_participants_from_botex_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_conversations_from_botex_db" class="md-nav__link">
    <span class="md-ellipsis">
      read_conversations_from_botex_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read_responses_from_botex_db" class="md-nav__link">
    <span class="md-ellipsis">
      read_responses_from_botex_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export_participant_data" class="md-nav__link">
    <span class="md-ellipsis">
      export_participant_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export_response_data" class="md-nav__link">
    <span class="md-ellipsis">
      export_response_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export_otree_data" class="md-nav__link">
    <span class="md-ellipsis">
      export_otree_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalize_otree_data" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_otree_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="api-reference">API Reference</h1>
<p>This section details the botex API. It consists of the command line interface  <code>botex</code> and a set of Python functions to set up and run oTree-based experiments using LLMs as bots.</p>
<p>The Python API can be divided into three main parts:</p>
<ol>
<li><strong>Setup</strong>: Functions to set up the botex configuration and to start/stop a local llama.cpp server if needed.</li>
<li><strong>oTree Interface</strong>: Functions to interact with the oTree server, such as starting/stopping the server, reading session config data from it, initializing sessions, and running bots on sessions.</li>
<li><strong>Export data</strong>: Functions to export data from the botex and oTree databases.</li>
</ol>
<h2 id="command-line-interface">Command Line Interface</h2>
<p>The <code>botex</code> command line interface provides the option to set up and run oTree experiments with bots from the command line. It also allows the user to export data from both, the botex and the oTree databases.</p>
<h2 id="botex">botex</h2>
<p>Run an oTree session with botex. All necessary arguments can be provided either
as command line arguments, in the environment file referenced by the <code>-c</code>
argument, or as environment variables.</p>
<p><strong>Usage:</strong></p>
<div class="language-text highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>botex [OPTIONS]
</span></code></pre></div>
<p><strong>Options:</strong></p>
<div class="language-text highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>  -c, --config TEXT            Path to the environment file
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>                               containing the botex configuration.
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>                               Defaults to &#39;botex.env&#39;.
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>  -i, --ignore                 Ignore any environment variables and
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>                               config files.
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>  -b, --botex-db TEXT          Path to the botex SQLite database
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>                               file (will be created if it does not
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>                               exist). Read from environment
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>                               variable BOTEX_DB if not provided.
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>                               Defaults to &#39;botex.sqlite3&#39;.
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>  -u, --otree-server-url TEXT  oTree server URL. Read from
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>                               environment variable OTREE_SERVER_URL
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>                               if not provided. Defaults to
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>                               &#39;http://localhost:8000&#39;.
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>  -r, --otree-rest-key TEXT    oTree secret key for its REST API.
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>                               Read from environment variable
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>                               OTREE_REST_KEY if not provided. Only
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>                               required if the oTree server is
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>                               running in DEMO or STUDY mode.
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>  -m, --model TEXT             Path to the LLM model to use for
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>                               botex. Read from environment variable
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>                               LLM_MODEL if not provided. If
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>                               environment variable is not set, you
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>                               will be prompted for the model.
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>  -k, --api-key TEXT           API key for the LLM model. Read from
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>                               environment variable API_KEY if not
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>                               provided. If environment variable is
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>                               not set, you will be prompted to
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>                               enter the key.
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>  -a, --api-base TEXT          Base URL for the LLM model. If not
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>                               provided it will default to None for
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>                               LiteLLM and http://localhost:8080 for
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>                               llama.cpp.
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>  --llamacpp-server TEXT       Path to the llama.cpp server
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>                               executable. Required if the model is
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>                               &#39;llamacpp&#39;. Read from environment
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>                               variable LLAMACPP_SERVER_PATH if not
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>                               provided.
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>  --llamacpp-local-llm TEXT    Path to the local llama.cpp model.
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>                               Required if the model is &#39;llamacpp&#39;.
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>                               Read from environment variable
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>                               LLAMACPP_LOCAL_LLM_PATH if not
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>                               provided.
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>  -s, --session-config TEXT    oTree session config to run. If not
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>                               provided, and also not set by the
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>                               environment variable
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>                               OTREE_SESSION_CONFIG, you will be
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>                               prompted to select from the available
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>                               session configurations.
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>  -p, --nparticipants INTEGER  Number of participants to run the
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a>                               session with. Read from environment
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>                               variable OTREE_NPARTICIPANTS if not
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>                               provided.
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>  -n, --nhumans INTEGER        Number of human participants to
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>                               include in the session. Read from
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>                               environment variable OTREE_NHUMANS if
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>                               not provided.
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>  -e, --export-csv-file TEXT   CSV file to export botex data to. If
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>                               not provided, you will be prompted to
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>                               enter a file name after the session
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>                               is complete.
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a>  -x, --no-throttle            Disables throttling requests to deal
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>                               with rate limiting. Defaults to
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>                               False. If set to True, you might run
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>                               into rate limiting resulting in
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>                               failed bot runs.
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>  -v, --verbose                Print out botex logs while running.
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>                               Defaults to False.
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a>  --help                       Show this message and exit.
</span></code></pre></div>
<h2 id="python-api-setup">Python API: Setup</h2>
<p>The botex configuration can be provided via function parameters or by setting environment variables. The latter is useful for secrets like API keys and also makes handling the API easier if you run repeated experiments. This an be facilitated by calling the function <code>load_botex_env()</code> that reads an <code>.env</code> file (<code>botex.env</code> by default). For users that want to use local LLMs for inference, <code>botex</code>can also start and/or stop a local llama.cpp instance.</p>
<h3 id="load_botex_env"><code>load_botex_env</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Load botex environment variables from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>env_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the .env file containing
the botex configuration. Defaults to "botex.env".</p>
              </div>
            </td>
            <td>
                  <code>&#39;botex.env&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if at least one botex environment variable was set.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/env.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-7"> 7</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-8"> 8</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-9"> 9</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-10">10</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-11">11</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-12">12</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-13">13</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-14">14</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-15">15</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-16">16</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-17">17</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-18">18</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-19">19</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-20">20</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-21">21</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-22">22</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-23">23</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-24">24</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-25">25</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-26">26</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-27">27</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-28">28</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-29">29</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-30">30</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-31">31</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-32">32</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-33">33</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-34">34</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">load_botex_env</span>(env_file <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;botex.env&quot;</span>) <span style="color: #666666">-&gt;</span> <span style="color: #007020">bool</span>:
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span style="color: #4070a0; font-style: italic">    Load botex environment variables from a file.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span style="color: #4070a0; font-style: italic">        env_file (str, optional): The path to the .env file containing</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span style="color: #4070a0; font-style: italic">            the botex configuration. Defaults to &quot;botex.env&quot;.</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span style="color: #4070a0; font-style: italic">        Bool: True if at least one botex environment variable was set.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020; font-weight: bold">not</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>exists(env_file):
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>        logger<span style="color: #666666">.</span>warning(
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>            <span style="color: #4070a0">f&quot;Could not read any botex environment variables from &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>env_file<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39; &quot;</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span style="color: #4070a0">&quot;as the file does not exist. &quot;</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>            <span style="color: #4070a0">&quot;Please make sure that the file is in the right location and that &quot;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>            <span style="color: #4070a0">&quot;it sets the botex environment variables that you need.&quot;</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>        )
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span style="color: #007020; font-weight: bold">return</span> <span style="color: #007020; font-weight: bold">False</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>    success <span style="color: #666666">=</span> load_dotenv(env_file)
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span style="color: #007020; font-weight: bold">if</span> success:
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>        logger<span style="color: #666666">.</span>info(<span style="color: #4070a0">f&quot;Loaded botex environment variables from &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>env_file<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39;&quot;</span>)
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>        logger<span style="color: #666666">.</span>info(
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span style="color: #4070a0">f&quot;Botex environment variables parsed from &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>env_file<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39;. &quot;</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>            <span style="color: #4070a0">&quot;No new environment variables were set.&quot;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>        )
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span style="color: #007020; font-weight: bold">return</span> success
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="start_llamacpp_server"><code>start_llamacpp_server</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Starts a llama.cpp server instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code>dict | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dict containing to the least
the keys <code>llamacpp_server_path</code> (the path to the llama.cpp 
executable) and <code>local_llm_path</code> (the path to the LLM model that you
want llama.cpp to use). If None (the default), then these parameters
are read from the environment variables <code>LLAMACPP_SERVER_PATH</code> and 
<code>LLAMACPP_LOCAL_LLM_PATH</code>. See notes below for additional
configuration parameters</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="subprocess.Popen">Popen</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The process of the running llama.cpp sever if start was
successful.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the server is already running or if starting the server 
fails.            </p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <details class="tip">
<summary>Additional details</summary>
<p>You can provide other configuration parameters for the 
local model in the model configuration dictionary. These include:</p>
<div class="language-text highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code>-   `server_url` (str): The base URL for the llama.cpp 
    server, defaults to `&quot;http://localhost:8080&quot;`.

-   `context_length` (int): The context length for the model. 
    If `None`, BotEx will try to get the context length from the 
    local model metadata; if that is not possible, it defaults 
    to `4096`.

-   `number_of_layers_to_offload_to_gpu` (int): The number of 
    layers to offload to the GPU, defaults to `0`.

- ` temperature` (float): The temperature for the model, 
    defaults to `0.5`.

-   `maximum_tokens_to_predict` (int): The maximum number of 
    tokens to predict, defaults to `10000`.

-   `top_p` (float): The top-p value for the model, 
    defaults to `0.9`.

-   `top_k` (int): The top-k value for the model, 
    defaults to `40`.

-   `num_slots` (int): The number of slots for the model, 
    defaults to `1`.
</code></pre></div>
<p>For all these keys, if not provided in the configuration dictionary, 
botex will try to get the value from environment variables (in all 
capital letters, prefixed by LLAMACPP_); if that is not possible, it 
will use the default value.</p>
</details>
<details class="example">
<summary>Example</summary>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span style="color: #007020; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">botex.llamacpp</span> <span style="color: #007020; font-weight: bold">import</span> start_llamacpp_server
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>config <span style="color: #666666">=</span> {
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span style="color: #4070a0">&quot;server_path&quot;</span>: <span style="color: #4070a0">&quot;/path/to/llama.cpp&quot;</span>,
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span style="color: #4070a0">&quot;local_llm_path&quot;</span>: <span style="color: #4070a0">&quot;/path/to/local/model&quot;</span>,
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span style="color: #4070a0">&quot;server_url&quot;</span>: <span style="color: #4070a0">&quot;http://localhost:8080&quot;</span>,
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span style="color: #4070a0">&quot;context_length&quot;</span>: <span style="color: #40a070">4096</span>,
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span style="color: #4070a0">&quot;number_of_layers_to_offload_to_gpu&quot;</span>: <span style="color: #40a070">0</span>,
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span style="color: #4070a0">&quot;temperature&quot;</span>: <span style="color: #40a070">0.8</span>,
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span style="color: #4070a0">&quot;maximum_tokens_to_predict&quot;</span>: <span style="color: #40a070">10000</span>,
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span style="color: #4070a0">&quot;top_p&quot;</span>: <span style="color: #40a070">0.9</span>,
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span style="color: #4070a0">&quot;top_k&quot;</span>: <span style="color: #40a070">40</span>,
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span style="color: #4070a0">&quot;num_slots&quot;</span>: <span style="color: #40a070">1</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>}
</span></code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>src/botex/llamacpp.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-283">283</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-284">284</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-285">285</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-286">286</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-287">287</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-288">288</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-289">289</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-290">290</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-291">291</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-292">292</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-293">293</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-294">294</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-295">295</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-296">296</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-297">297</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-298">298</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-299">299</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-300">300</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-301">301</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-302">302</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-303">303</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-304">304</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-305">305</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-306">306</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-307">307</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-308">308</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-309">309</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-310">310</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-311">311</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-312">312</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-313">313</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-314">314</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-315">315</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-316">316</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-317">317</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-318">318</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-319">319</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-320">320</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-321">321</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-322">322</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-323">323</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-324">324</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-325">325</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-326">326</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-327">327</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-328">328</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-329">329</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-330">330</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-331">331</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-332">332</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-333">333</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-334">334</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-335">335</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-336">336</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-337">337</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-338">338</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-339">339</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-340">340</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-341">341</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-342">342</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-343">343</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-344">344</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-345">345</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-346">346</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-347">347</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-348">348</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-349">349</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-350">350</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-351">351</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-352">352</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-353">353</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-354">354</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-355">355</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-356">356</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-357">357</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-358">358</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-359">359</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-360">360</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">start_llamacpp_server</span>(config: <span style="color: #007020">dict</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> subprocess<span style="color: #666666">.</span>Popen:
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span style="color: #4070a0; font-style: italic">    Starts a llama.cpp server instance.</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a><span style="color: #4070a0; font-style: italic">        config (dict | None, optional): A dict containing to the least</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span style="color: #4070a0; font-style: italic">            the keys `llamacpp_server_path` (the path to the llama.cpp </span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span style="color: #4070a0; font-style: italic">            executable) and `local_llm_path` (the path to the LLM model that you</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span style="color: #4070a0; font-style: italic">            want llama.cpp to use). If None (the default), then these parameters</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span style="color: #4070a0; font-style: italic">            are read from the environment variables `LLAMACPP_SERVER_PATH` and </span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span style="color: #4070a0; font-style: italic">            `LLAMACPP_LOCAL_LLM_PATH`. See notes below for additional</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span style="color: #4070a0; font-style: italic">            configuration parameters</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span style="color: #4070a0; font-style: italic">        The process of the running llama.cpp sever if start was</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span style="color: #4070a0; font-style: italic">            successful.</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><span style="color: #4070a0; font-style: italic">    Raises:</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span style="color: #4070a0; font-style: italic">        Exception: If the server is already running or if starting the server </span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span style="color: #4070a0; font-style: italic">            fails.            </span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span style="color: #4070a0; font-style: italic">    ??? tip &quot;Additional details&quot;</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span style="color: #4070a0; font-style: italic">        You can provide other configuration parameters for the </span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span style="color: #4070a0; font-style: italic">        local model in the model configuration dictionary. These include:</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a><span style="color: #4070a0; font-style: italic">            -   `server_url` (str): The base URL for the llama.cpp </span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a><span style="color: #4070a0; font-style: italic">                server, defaults to `&quot;http://localhost:8080&quot;`.</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span style="color: #4070a0; font-style: italic">            -   `context_length` (int): The context length for the model. </span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span style="color: #4070a0; font-style: italic">                If `None`, BotEx will try to get the context length from the </span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span style="color: #4070a0; font-style: italic">                local model metadata; if that is not possible, it defaults </span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span style="color: #4070a0; font-style: italic">                to `4096`.</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a><span style="color: #4070a0; font-style: italic">            -   `number_of_layers_to_offload_to_gpu` (int): The number of </span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a><span style="color: #4070a0; font-style: italic">                layers to offload to the GPU, defaults to `0`.</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a><span style="color: #4070a0; font-style: italic">            - ` temperature` (float): The temperature for the model, </span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a><span style="color: #4070a0; font-style: italic">                defaults to `0.5`.</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a><span style="color: #4070a0; font-style: italic">            -   `maximum_tokens_to_predict` (int): The maximum number of </span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a><span style="color: #4070a0; font-style: italic">                tokens to predict, defaults to `10000`.</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><span style="color: #4070a0; font-style: italic">            -   `top_p` (float): The top-p value for the model, </span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span style="color: #4070a0; font-style: italic">                defaults to `0.9`.</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a><span style="color: #4070a0; font-style: italic">            -   `top_k` (int): The top-k value for the model, </span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span style="color: #4070a0; font-style: italic">                defaults to `40`.</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span style="color: #4070a0; font-style: italic">            -   `num_slots` (int): The number of slots for the model, </span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><span style="color: #4070a0; font-style: italic">                defaults to `1`.</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span style="color: #4070a0; font-style: italic">        For all these keys, if not provided in the configuration dictionary, </span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span style="color: #4070a0; font-style: italic">        botex will try to get the value from environment variables (in all </span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span style="color: #4070a0; font-style: italic">        capital letters, prefixed by LLAMACPP_); if that is not possible, it </span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a><span style="color: #4070a0; font-style: italic">        will use the default value.</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a><span style="color: #4070a0; font-style: italic">    ??? example &quot;Example&quot;</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a><span style="color: #4070a0; font-style: italic">        ```python</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span style="color: #4070a0; font-style: italic">        from botex.llamacpp import start_llamacpp_server</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a><span style="color: #4070a0; font-style: italic">        config = {</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a><span style="color: #4070a0; font-style: italic">            &quot;server_path&quot;: &quot;/path/to/llama.cpp&quot;,</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a><span style="color: #4070a0; font-style: italic">            &quot;local_llm_path&quot;: &quot;/path/to/local/model&quot;,</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span style="color: #4070a0; font-style: italic">            &quot;server_url&quot;: &quot;http://localhost:8080&quot;,</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span style="color: #4070a0; font-style: italic">            &quot;context_length&quot;: 4096,</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span style="color: #4070a0; font-style: italic">            &quot;number_of_layers_to_offload_to_gpu&quot;: 0,</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span style="color: #4070a0; font-style: italic">            &quot;temperature&quot;: 0.8,</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span style="color: #4070a0; font-style: italic">            &quot;maximum_tokens_to_predict&quot;: 10000,</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span style="color: #4070a0; font-style: italic">            &quot;top_p&quot;: 0.9,</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span style="color: #4070a0; font-style: italic">            &quot;top_k&quot;: 40,</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a><span style="color: #4070a0; font-style: italic">            &quot;num_slots&quot;: 1</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span style="color: #4070a0; font-style: italic">        }</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a>    manager <span style="color: #666666">=</span> LlamaCppServerManager(config)
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span style="color: #007020; font-weight: bold">return</span> manager<span style="color: #666666">.</span>start_server()
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="stop_llamacpp_server"><code>stop_llamacpp_server</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Stops a running llama.cpp server instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>process</code>
            </td>
            <td>
                  <code><span title="subprocess.Popen">Popen</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The process of the running llama.cpp server.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None (stops the running llama.cpp server)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/llamacpp.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-362">362</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-363">363</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-364">364</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-365">365</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-366">366</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-367">367</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-368">368</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-369">369</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-370">370</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-371">371</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-372">372</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">stop_llamacpp_server</span>(process: subprocess<span style="color: #666666">.</span>Popen) <span style="color: #666666">-&gt;</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a><span style="color: #4070a0; font-style: italic">    Stops a running llama.cpp server instance.</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a><span style="color: #4070a0; font-style: italic">        process (subprocess.Popen): The process of the running llama.cpp server.</span>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a><span style="color: #4070a0; font-style: italic">        None (stops the running llama.cpp server)</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a>    LlamaCppServerManager<span style="color: #666666">.</span>stop_server(process)
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="python-api-otree-interface">Python API: oTree Interface</h2>
<p>Running experiments with botex requires an oTree server with an active session to be accessible. The following functions allow the user to interact with the oTree server, such as starting/stopping the server, reading session config data from it, and initializing sessions. Once a session is initialized, the core functions <code>run_bots_on_session()</code> and <code>run_single_bot()</code> can be used to run bots on the session.</p>
<h3 id="start_otree_server"><code>start_otree_server</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Start an oTree server in a subprocess.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>project_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to your oTree project folder.
If None (the default), it will be obtained from the environment
variable OTREE_PROJECT_PATH.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>port</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The port to run the server on. If None 
(the default), it will first try to read from the 
environment variable OTREE_PORT. It that is not set. it 
will default to 8000.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the log file. If None 
(the default), it will first be tried to read from the
environment variable OTREE_LOG_FILE. If that is not set,
it will default to 'otree.log'.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>auth_level</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authentication level for the oTree 
server. It is set by environment variable OTREE_AUTH_LEVEL. 
The default is None, which will leave this environment variable
unchanged. if you use 'DEMO' or 'STUDY', the environment variable
will be set accordingly and you need to provide a rest key
in the argument 'rest_key' below.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rest_key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API key for the oTree server.
If None (the default), it will be obtained from the environment
variable OTREE_REST_KEY.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>admin_password</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The admin password for the oTree server.
For this to work, <code>settings.py</code> in the oTree project needs to read
the password from the environment variable OTREE_ADMIN_PASSWORD
(which is normally the case).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeout in seconds to wait for the 
server. Defaults to 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="subprocess.Popen">Popen</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A subprocess object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the oTree server does not start within the timeout.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-134">134</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-135">135</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-136">136</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-137">137</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-138">138</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-139">139</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-140">140</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-141">141</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-142">142</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-143">143</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-144">144</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-145">145</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-146">146</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-147">147</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-148">148</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-149">149</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-150">150</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-151">151</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-152">152</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-153">153</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-154">154</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-155">155</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-156">156</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-157">157</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-158">158</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-159">159</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-160">160</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-161">161</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-162">162</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-163">163</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-164">164</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-165">165</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-166">166</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-167">167</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-168">168</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-169">169</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-170">170</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-171">171</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-172">172</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-173">173</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-174">174</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-175">175</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-176">176</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-177">177</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-178">178</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-179">179</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-180">180</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-181">181</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-182">182</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-183">183</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-184">184</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-185">185</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-186">186</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-187">187</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-188">188</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-189">189</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-190">190</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-191">191</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-192">192</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-193">193</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-194">194</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-195">195</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-196">196</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-197">197</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-198">198</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-199">199</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-200">200</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-201">201</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-202">202</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-203">203</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-204">204</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-205">205</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-206">206</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-207">207</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-208">208</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-209">209</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-210">210</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-211">211</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-212">212</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-213">213</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-214">214</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-215">215</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-216">216</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-217">217</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-218">218</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-219">219</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-220">220</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-221">221</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-222">222</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-223">223</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-224">224</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-225">225</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-226">226</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">start_otree_server</span>(
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        project_path <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        port <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, 
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        log_file <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        auth_level <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, 
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>        rest_key <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>        admin_password <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        timeout <span style="color: #666666">=</span> <span style="color: #40a070">5</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    ) <span style="color: #666666">-&gt;</span> subprocess<span style="color: #666666">.</span>Popen:
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span style="color: #4070a0; font-style: italic">    Start an oTree server in a subprocess.</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a><span style="color: #4070a0; font-style: italic">        project_path (str, optional): Path to your oTree project folder.</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a><span style="color: #4070a0; font-style: italic">            If None (the default), it will be obtained from the environment</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span style="color: #4070a0; font-style: italic">            variable OTREE_PROJECT_PATH.</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a><span style="color: #4070a0; font-style: italic">        port (int, optional): The port to run the server on. If None </span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span style="color: #4070a0; font-style: italic">            (the default), it will first try to read from the </span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span style="color: #4070a0; font-style: italic">            environment variable OTREE_PORT. It that is not set. it </span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span style="color: #4070a0; font-style: italic">            will default to 8000.</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span style="color: #4070a0; font-style: italic">        log_file (str, optional): Path to the log file. If None </span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span style="color: #4070a0; font-style: italic">            (the default), it will first be tried to read from the</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span style="color: #4070a0; font-style: italic">            environment variable OTREE_LOG_FILE. If that is not set,</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span style="color: #4070a0; font-style: italic">            it will default to &#39;otree.log&#39;.</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span style="color: #4070a0; font-style: italic">        auth_level (str, optional): The authentication level for the oTree </span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span style="color: #4070a0; font-style: italic">            server. It is set by environment variable OTREE_AUTH_LEVEL. </span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span style="color: #4070a0; font-style: italic">            The default is None, which will leave this environment variable</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span style="color: #4070a0; font-style: italic">            unchanged. if you use &#39;DEMO&#39; or &#39;STUDY&#39;, the environment variable</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span style="color: #4070a0; font-style: italic">            will be set accordingly and you need to provide a rest key</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span style="color: #4070a0; font-style: italic">            in the argument &#39;rest_key&#39; below.</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span style="color: #4070a0; font-style: italic">        rest_key (str, optional): The API key for the oTree server.</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span style="color: #4070a0; font-style: italic">            If None (the default), it will be obtained from the environment</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span style="color: #4070a0; font-style: italic">            variable OTREE_REST_KEY.</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span style="color: #4070a0; font-style: italic">        admin_password (str, optional): The admin password for the oTree server.</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span style="color: #4070a0; font-style: italic">            For this to work, `settings.py` in the oTree project needs to read</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span style="color: #4070a0; font-style: italic">            the password from the environment variable OTREE_ADMIN_PASSWORD</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span style="color: #4070a0; font-style: italic">            (which is normally the case).</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><span style="color: #4070a0; font-style: italic">        timeout (int, optional): Timeout in seconds to wait for the </span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a><span style="color: #4070a0; font-style: italic">            server. Defaults to 5.</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span style="color: #4070a0; font-style: italic">        A subprocess object.</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span style="color: #4070a0; font-style: italic">    Raises:</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span style="color: #4070a0; font-style: italic">        Exception: If the oTree server does not start within the timeout.</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span style="color: #007020; font-weight: bold">if</span> project_path <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>        project_path <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;OTREE_PROJECT_PATH&#39;</span>)
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span style="color: #007020; font-weight: bold">if</span> project_path <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span style="color: #007020; font-weight: bold">raise</span> <span style="color: #007020">Exception</span>(<span style="color: #4070a0">&#39;No oTree project path provided.&#39;</span>)
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span style="color: #007020; font-weight: bold">if</span> port <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: port <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;OTREE_PORT&#39;</span>, <span style="color: #40a070">8000</span>)
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span style="color: #007020; font-weight: bold">if</span> log_file <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: log_file <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;OTREE_LOG_FILE&#39;</span>, <span style="color: #4070a0">&#39;otree.log&#39;</span>)
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>    otree_log <span style="color: #666666">=</span> <span style="color: #007020">open</span>(log_file, <span style="color: #4070a0">&#39;w&#39;</span>)
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span style="color: #007020; font-weight: bold">if</span> auth_level <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">None</span>: 
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>        os<span style="color: #666666">.</span>environ[<span style="color: #4070a0">&#39;OTREE_AUTH_LEVEL&#39;</span>] <span style="color: #666666">=</span> auth_level
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span style="color: #007020; font-weight: bold">if</span> rest_key <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>            os<span style="color: #666666">.</span>environ[<span style="color: #4070a0">&#39;OTREE_REST_KEY&#39;</span>] <span style="color: #666666">=</span> rest_key
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span style="color: #007020; font-weight: bold">if</span> admin_password <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>            os<span style="color: #666666">.</span>environ[<span style="color: #4070a0">&#39;OTREE_ADMIN_PASSWORD&#39;</span>] <span style="color: #666666">=</span> admin_password 
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span style="color: #007020; font-weight: bold">if</span> platform<span style="color: #666666">.</span>system() <span style="color: #666666">==</span> <span style="color: #4070a0">&quot;Windows&quot;</span>:
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>        otree_server <span style="color: #666666">=</span> subprocess<span style="color: #666666">.</span>Popen(
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>            [<span style="color: #4070a0">&quot;otree&quot;</span>, <span style="color: #4070a0">&quot;devserver&quot;</span>, <span style="color: #007020">str</span>(port)], cwd<span style="color: #666666">=</span>project_path,
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>            stderr<span style="color: #666666">=</span>otree_log, stdout<span style="color: #666666">=</span>otree_log,
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>            creationflags<span style="color: #666666">=</span>subprocess<span style="color: #666666">.</span>CREATE_NEW_PROCESS_GROUP
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>        )
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>        otree_server <span style="color: #666666">=</span> subprocess<span style="color: #666666">.</span>Popen(
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>            [<span style="color: #4070a0">&quot;otree&quot;</span>, <span style="color: #4070a0">&quot;devserver&quot;</span>, <span style="color: #007020">str</span>(port)], cwd<span style="color: #666666">=</span>project_path,
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>            stderr<span style="color: #666666">=</span>otree_log, stdout<span style="color: #666666">=</span>otree_log
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>        )
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>    otree_server_url <span style="color: #666666">=</span> <span style="color: #4070a0">f&#39;http://localhost:</span><span style="color: #70a0d0; font-style: italic">{</span>port<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39;</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>    os<span style="color: #666666">.</span>environ[<span style="color: #4070a0">&#39;OTREE_SERVER_URL&#39;</span>] <span style="color: #666666">=</span> otree_server_url
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span style="color: #60a0b0; font-style: italic"># Access oTree API to check if server is running</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>    time_out <span style="color: #666666">=</span> time<span style="color: #666666">.</span>time() <span style="color: #666666">+</span> timeout
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span style="color: #007020; font-weight: bold">while</span> <span style="color: #007020; font-weight: bold">True</span>:
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span style="color: #007020; font-weight: bold">if</span> otree_server_is_running(rest_key <span style="color: #666666">=</span> rest_key):
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>            logger<span style="color: #666666">.</span>info(
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span style="color: #4070a0">&quot;oTree server started successfully &quot;</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span style="color: #4070a0">f&quot;with endpoint &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>otree_server_url<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39;&quot;</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>            )
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span style="color: #007020; font-weight: bold">break</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span style="color: #007020; font-weight: bold">if</span> time<span style="color: #666666">.</span>time() <span style="color: #666666">&gt;</span> time_out:
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>                logger<span style="color: #666666">.</span>error(
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>                    <span style="color: #4070a0">f&quot;oTree endpoint &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>otree_server_url<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39; did not respond &quot;</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>                    <span style="color: #4070a0">f&quot;within </span><span style="color: #70a0d0; font-style: italic">{</span>timeout<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0"> seconds. Exiting.&quot;</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>                )
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span style="color: #007020; font-weight: bold">raise</span> <span style="color: #007020">Exception</span>(<span style="color: #4070a0">&#39;oTree server did not start.&#39;</span>)
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>            time<span style="color: #666666">.</span>sleep(<span style="color: #40a070">1</span>)
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span style="color: #007020; font-weight: bold">return</span> otree_server
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="stop_otree_server"><code>stop_otree_server</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Stop an oTree server subprocess.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>otree_server</code>
            </td>
            <td>
                  <code>subprocess</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The subprocess object to be terminated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The return code of the oTree subprocess</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-229">229</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-230">230</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-231">231</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-232">232</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-233">233</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-234">234</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-235">235</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-236">236</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-237">237</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-238">238</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-239">239</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-240">240</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-241">241</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-242">242</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-243">243</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-244">244</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-245">245</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-246">246</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-247">247</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-248">248</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-249">249</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-250">250</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-251">251</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-252">252</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">stop_otree_server</span>(otree_server: subprocess<span style="color: #666666">.</span>Popen) <span style="color: #666666">-&gt;</span> <span style="color: #007020">int</span>:
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a><span style="color: #4070a0; font-style: italic">    Stop an oTree server subprocess.</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span style="color: #4070a0; font-style: italic">        otree_server (subprocess): The subprocess object to be terminated.</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span style="color: #4070a0; font-style: italic">        The return code of the oTree subprocess</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>    otree_running <span style="color: #666666">=</span> otree_server<span style="color: #666666">.</span>poll() <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span style="color: #007020; font-weight: bold">if</span> otree_running: 
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>        proc <span style="color: #666666">=</span> psutil<span style="color: #666666">.</span>Process(otree_server<span style="color: #666666">.</span>pid)
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span style="color: #007020; font-weight: bold">if</span> platform<span style="color: #666666">.</span>system() <span style="color: #666666">==</span> <span style="color: #4070a0">&quot;Windows&quot;</span>:
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>            proc<span style="color: #666666">.</span>send_signal(signal<span style="color: #666666">.</span>CTRL_BREAK_EVENT)
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>            proc<span style="color: #666666">.</span>wait()
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span style="color: #007020; font-weight: bold">else</span>: 
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>            proc<span style="color: #666666">.</span>children()[<span style="color: #40a070">0</span>]<span style="color: #666666">.</span>send_signal(signal<span style="color: #666666">.</span>SIGKILL)
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>            otree_server<span style="color: #666666">.</span>kill()
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>            otree_server<span style="color: #666666">.</span>wait()
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>        logger<span style="color: #666666">.</span>info(<span style="color: #4070a0">&quot;oTree server stopped.&quot;</span>)
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>        logger<span style="color: #666666">.</span>warning(<span style="color: #4070a0">&#39;oTree server already stopped.&#39;</span>)
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span style="color: #007020; font-weight: bold">return</span> otree_server<span style="color: #666666">.</span>poll()
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="otree_server_is_running"><code>otree_server_is_running</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Check if an oTree server is running.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>server_url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the oTree server. Read from environment
variable OTREE_SERVER_URL if None (the default).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rest_key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API key for the oTree server. Read from environment
variable OTREE_REST_KEY if None (the default).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the server is running, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-111">111</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-112">112</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-113">113</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-114">114</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-115">115</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-116">116</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-117">117</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-118">118</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-119">119</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-120">120</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-121">121</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-122">122</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-123">123</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-124">124</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-125">125</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-126">126</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-127">127</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-128">128</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-129">129</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-130">130</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">otree_server_is_running</span>(server_url <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, rest_key <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> <span style="color: #007020">bool</span>:
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span style="color: #4070a0; font-style: italic">    Check if an oTree server is running.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span style="color: #4070a0; font-style: italic">        server_url (str): The URL of the oTree server. Read from environment</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span style="color: #4070a0; font-style: italic">            variable OTREE_SERVER_URL if None (the default).</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span style="color: #4070a0; font-style: italic">        rest_key (str): The API key for the oTree server. Read from environment</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span style="color: #4070a0; font-style: italic">            variable OTREE_REST_KEY if None (the default).</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span style="color: #4070a0; font-style: italic">        True if the server is running, False otherwise.</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span style="color: #007020; font-weight: bold">try</span>: 
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>        data <span style="color: #666666">=</span> call_otree_api(
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>            requests<span style="color: #666666">.</span>get, <span style="color: #4070a0">&#39;otree_version&#39;</span>, 
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>            otree_server_url<span style="color: #666666">=</span>server_url, otree_rest_key<span style="color: #666666">=</span>rest_key
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>        )
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span style="color: #007020; font-weight: bold">except</span>:
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        data <span style="color: #666666">=</span> {<span style="color: #4070a0">&#39;error&#39;</span>: <span style="color: #4070a0">&quot;No API response&quot;</span>}
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span style="color: #007020; font-weight: bold">return</span> <span style="color: #4070a0">&#39;version&#39;</span> <span style="color: #007020; font-weight: bold">in</span> data
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="get_session_configs"><code>get_session_configs</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Get the session configurations from an oTree server.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>otree_server_url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the oTree server. Read from 
environment variable OTREE_SERVER_URL if None (the default).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>otree_rest_key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API key for the oTree server. Read from 
environment variable OTREE_REST_KEY if None (the default).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The session configurations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-255">255</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-256">256</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-257">257</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-258">258</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-259">259</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-260">260</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-261">261</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-262">262</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-263">263</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-264">264</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-265">265</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-266">266</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-267">267</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-268">268</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-269">269</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-270">270</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-271">271</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-272">272</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-273">273</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-274">274</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-275">275</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">get_session_configs</span>(
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>        otree_server_url: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>        otree_rest_key: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>    ) <span style="color: #666666">-&gt;</span> <span style="color: #007020">dict</span>:
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a><span style="color: #4070a0; font-style: italic">    Get the session configurations from an oTree server.</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span style="color: #4070a0; font-style: italic">        otree_server_url (str): The URL of the oTree server. Read from </span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a><span style="color: #4070a0; font-style: italic">            environment variable OTREE_SERVER_URL if None (the default).</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span style="color: #4070a0; font-style: italic">        otree_rest_key (str): The API key for the oTree server. Read from </span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a><span style="color: #4070a0; font-style: italic">            environment variable OTREE_REST_KEY if None (the default).</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span style="color: #4070a0; font-style: italic">        The session configurations.</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span style="color: #007020; font-weight: bold">return</span> call_otree_api(
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>        requests<span style="color: #666666">.</span>get, <span style="color: #4070a0">&#39;session_configs&#39;</span>, 
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>        otree_server_url<span style="color: #666666">=</span>otree_server_url, otree_rest_key<span style="color: #666666">=</span>otree_rest_key
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>    )
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="init_otree_session"><code>init_otree_session</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Initialize an oTree session with a given number of participants.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the oTree session configuration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>npart</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of participants.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nhumans</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of human participants (defaults to zero.
Provide either nhumans or is_human, but not both.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_human</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of booleans indicating whether each participant 
is human. Needs to be the same length as npart. If None (the 
default), humans (if present) will be randomly assigned.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>room_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the oTree room for the session. If None 
(the default), no room will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the SQLite database file to store BotEx   <br />
data. If None (the default), it will be obtained from the 
environment variable BOTEX_DB. If the database does not exist, it 
will be created.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>otree_server_url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The URL of the oTree server. If None (the 
default), it will be obtained from the environment variable 
OTREE_SERVER_URL.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>otree_rest_key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API key for the oTree server. If None (the 
default), it will be obtained from the environment variable 
OTREE_REST_KEY.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modified_session_config_fields</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of fields to modify 
in the the oTree session config. Default is None. </p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict with the keys 'session_id', 'participant_code', 'is_human', 
'bot_urls', and 'human_urls' containing the session ID, participant 
codes, human indicators, and the URLs for the human and bot 
participants.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-277">277</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-278">278</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-279">279</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-280">280</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-281">281</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-282">282</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-283">283</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-284">284</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-285">285</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-286">286</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-287">287</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-288">288</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-289">289</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-290">290</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-291">291</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-292">292</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-293">293</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-294">294</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-295">295</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-296">296</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-297">297</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-298">298</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-299">299</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-300">300</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-301">301</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-302">302</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-303">303</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-304">304</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-305">305</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-306">306</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-307">307</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-308">308</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-309">309</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-310">310</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-311">311</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-312">312</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-313">313</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-314">314</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-315">315</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-316">316</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-317">317</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-318">318</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-319">319</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-320">320</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-321">321</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-322">322</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-323">323</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-324">324</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-325">325</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-326">326</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-327">327</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-328">328</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-329">329</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-330">330</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-331">331</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-332">332</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-333">333</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-334">334</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-335">335</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-336">336</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-337">337</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-338">338</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-339">339</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-340">340</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-341">341</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-342">342</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-343">343</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-344">344</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-345">345</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-346">346</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-347">347</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-348">348</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-349">349</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-350">350</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-351">351</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-352">352</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-353">353</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-354">354</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-355">355</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-356">356</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-357">357</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-358">358</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-359">359</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-360">360</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-361">361</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-362">362</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-363">363</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-364">364</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-365">365</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-366">366</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-367">367</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-368">368</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-369">369</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-370">370</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-371">371</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-372">372</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-373">373</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-374">374</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-375">375</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-376">376</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-377">377</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-378">378</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-379">379</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-380">380</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-381">381</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-382">382</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">init_otree_session</span>(
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a>        config_name: <span style="color: #007020">str</span>,
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>        npart: <span style="color: #007020">int</span>,
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a>        nhumans: <span style="color: #007020">int</span> <span style="color: #666666">=</span> <span style="color: #40a070">0</span>, 
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a>        is_human: List[<span style="color: #007020">bool</span>] <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>        room_name: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a>        botex_db: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a>        otree_server_url: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a>        otree_rest_key: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>        modified_session_config_fields: <span style="color: #007020">dict</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>    ) <span style="color: #666666">-&gt;</span> <span style="color: #007020">dict</span>:
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span style="color: #4070a0; font-style: italic">    Initialize an oTree session with a given number of participants.</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span style="color: #4070a0; font-style: italic">        config_name (str): The name of the oTree session configuration.</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span style="color: #4070a0; font-style: italic">        npart (int): The total number of participants.</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span style="color: #4070a0; font-style: italic">        nhumans (int): The number of human participants (defaults to zero.</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a><span style="color: #4070a0; font-style: italic">            Provide either nhumans or is_human, but not both.</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span style="color: #4070a0; font-style: italic">        is_human (list): A list of booleans indicating whether each participant </span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span style="color: #4070a0; font-style: italic">            is human. Needs to be the same length as npart. If None (the </span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span style="color: #4070a0; font-style: italic">            default), humans (if present) will be randomly assigned.</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span style="color: #4070a0; font-style: italic">        room_name (str): The name of the oTree room for the session. If None </span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><span style="color: #4070a0; font-style: italic">            (the default), no room will be used.</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span style="color: #4070a0; font-style: italic">        botex_db (str): The name of the SQLite database file to store BotEx     </span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span style="color: #4070a0; font-style: italic">            data. If None (the default), it will be obtained from the </span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a><span style="color: #4070a0; font-style: italic">            environment variable BOTEX_DB. If the database does not exist, it </span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span style="color: #4070a0; font-style: italic">            will be created.</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span style="color: #4070a0; font-style: italic">        otree_server_url (str): The URL of the oTree server. If None (the </span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span style="color: #4070a0; font-style: italic">            default), it will be obtained from the environment variable </span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span style="color: #4070a0; font-style: italic">            OTREE_SERVER_URL.</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a><span style="color: #4070a0; font-style: italic">        otree_rest_key (str): The API key for the oTree server. If None (the </span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a><span style="color: #4070a0; font-style: italic">            default), it will be obtained from the environment variable </span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span style="color: #4070a0; font-style: italic">            OTREE_REST_KEY.</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span style="color: #4070a0; font-style: italic">        modified_session_config_fields (dict): A dictionary of fields to modify </span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span style="color: #4070a0; font-style: italic">            in the the oTree session config. Default is None. </span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a><span style="color: #4070a0; font-style: italic">        dict with the keys &#39;session_id&#39;, &#39;participant_code&#39;, &#39;is_human&#39;, </span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a><span style="color: #4070a0; font-style: italic">            &#39;bot_urls&#39;, and &#39;human_urls&#39; containing the session ID, participant </span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a><span style="color: #4070a0; font-style: italic">            codes, human indicators, and the URLs for the human and bot </span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a><span style="color: #4070a0; font-style: italic">            participants.</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span style="color: #007020; font-weight: bold">if</span> nhumans <span style="color: #666666">&gt;</span> <span style="color: #40a070">0</span> <span style="color: #007020; font-weight: bold">and</span> is_human <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">None</span>: <span style="color: #007020; font-weight: bold">raise</span>(<span style="color: #007020">Exception</span>(
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span style="color: #4070a0">&quot;Provide either nhumans or is_human, but not both.&quot;</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a>    ))
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span style="color: #007020; font-weight: bold">if</span> is_human <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020">len</span>(is_human) <span style="color: #666666">!=</span> npart: <span style="color: #007020; font-weight: bold">raise</span>(<span style="color: #007020">Exception</span>(
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span style="color: #4070a0">&quot;Length of is_human must be the same as npart.&quot;</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>        ))
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span style="color: #007020; font-weight: bold">if</span> is_human <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #007020; font-weight: bold">and</span> nhumans <span style="color: #666666">&gt;</span> <span style="color: #40a070">0</span>:
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a>        is_human <span style="color: #666666">=</span> [<span style="color: #007020; font-weight: bold">True</span>]<span style="color: #666666">*</span>nhumans <span style="color: #666666">+</span> [<span style="color: #007020; font-weight: bold">False</span>]<span style="color: #666666">*</span>(npart <span style="color: #666666">-</span> nhumans)
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a>        shuffle(is_human)
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span style="color: #007020; font-weight: bold">if</span> is_human <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #007020; font-weight: bold">and</span> nhumans <span style="color: #666666">==</span> <span style="color: #40a070">0</span>: is_human <span style="color: #666666">=</span> [<span style="color: #007020; font-weight: bold">False</span>]<span style="color: #666666">*</span>npart
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span style="color: #007020; font-weight: bold">if</span> botex_db <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: botex_db <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;BOTEX_DB&#39;</span>)
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span style="color: #007020; font-weight: bold">if</span> otree_server_url <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a>        otree_server_url <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;OTREE_SERVER_URL&#39;</span>)
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>    session_id <span style="color: #666666">=</span> call_otree_api(
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>        requests<span style="color: #666666">.</span>post, <span style="color: #4070a0">&#39;sessions&#39;</span>, 
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>        otree_server_url<span style="color: #666666">=</span>otree_server_url, otree_rest_key<span style="color: #666666">=</span>otree_rest_key, 
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>        session_config_name<span style="color: #666666">=</span>config_name, 
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a>        num_participants<span style="color: #666666">=</span>npart, room_name<span style="color: #666666">=</span>room_name,
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a>        modified_session_config_fields<span style="color: #666666">=</span>modified_session_config_fields
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>    )[<span style="color: #4070a0">&#39;code&#39;</span>]
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a>    part_data <span style="color: #666666">=</span> <span style="color: #007020">sorted</span>(
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a>        call_otree_api(
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a>            requests<span style="color: #666666">.</span>get, <span style="color: #4070a0">&#39;sessions&#39;</span>, session_id,
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a>            otree_server_url<span style="color: #666666">=</span>otree_server_url, otree_rest_key<span style="color: #666666">=</span>otree_rest_key 
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a>        )[<span style="color: #4070a0">&#39;participants&#39;</span>],
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a>        key<span style="color: #666666">=</span><span style="color: #007020; font-weight: bold">lambda</span> d: d[<span style="color: #4070a0">&#39;id_in_session&#39;</span>]
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a>    )
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a>    part_codes <span style="color: #666666">=</span> [pd[<span style="color: #4070a0">&#39;code&#39;</span>] <span style="color: #007020; font-weight: bold">for</span> pd <span style="color: #007020; font-weight: bold">in</span> part_data]
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a>    base_url <span style="color: #666666">=</span> otree_server_url <span style="color: #666666">+</span> <span style="color: #4070a0">&#39;/InitializeParticipant/&#39;</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>    urls <span style="color: #666666">=</span> [base_url <span style="color: #666666">+</span> pc <span style="color: #007020; font-weight: bold">for</span> pc <span style="color: #007020; font-weight: bold">in</span> part_codes]
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a>    rows <span style="color: #666666">=</span> <span style="color: #007020">zip</span>(
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a>        [config_name]<span style="color: #666666">*</span>npart, [session_id]<span style="color: #666666">*</span>npart, 
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a>        part_codes, is_human, urls
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a>    )
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a>    conn <span style="color: #666666">=</span> setup_botex_db(botex_db)
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a>    cursor <span style="color: #666666">=</span> conn<span style="color: #666666">.</span>cursor()
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>    cursor<span style="color: #666666">.</span>executemany(
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a><span style="color: #bbbbbb">        </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span style="color: #4070a0; font-style: italic">        INSERT INTO participants (</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a><span style="color: #4070a0; font-style: italic">            session_name, session_id, participant_id, is_human, url) </span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a><span style="color: #4070a0; font-style: italic">            VALUES (?, ?, ?, ?, ?) </span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a><span style="color: #4070a0; font-style: italic">        &quot;&quot;&quot;</span>, rows
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a>    )
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a>    conn<span style="color: #666666">.</span>commit()
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>    cursor<span style="color: #666666">.</span>close()
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span style="color: #007020; font-weight: bold">return</span> {
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span style="color: #4070a0">&#39;session_id&#39;</span>: session_id, 
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span style="color: #4070a0">&#39;participant_code&#39;</span>: part_codes,
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span style="color: #4070a0">&#39;is_human&#39;</span>: is_human,
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span style="color: #4070a0">&#39;bot_urls&#39;</span>: <span style="color: #007020">list</span>(compress(urls, [<span style="color: #007020; font-weight: bold">not</span> x <span style="color: #007020; font-weight: bold">for</span> x <span style="color: #007020; font-weight: bold">in</span> is_human])), 
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span style="color: #4070a0">&#39;human_urls&#39;</span>: <span style="color: #007020">list</span>(compress(urls, is_human))
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a>    }
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="get_bot_urls"><code>get_bot_urls</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Get the URLs for the bot participants in an oTree session.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the oTree session.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the SQLite database file to store BotEx 
data. If None (the default), it will be obtained from the 
environment variable BOTEX_DB.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>already_started</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will also run bots that 
have already started but not yet finished. This is useful if bots 
did not startup properly because of network issues. Default is 
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of URLs for the bot participants</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-385">385</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-386">386</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-387">387</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-388">388</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-389">389</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-390">390</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-391">391</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-392">392</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-393">393</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-394">394</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-395">395</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-396">396</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-397">397</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-398">398</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-399">399</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-400">400</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-401">401</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-402">402</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-403">403</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-404">404</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-405">405</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-406">406</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-407">407</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-408">408</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-409">409</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-410">410</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-411">411</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-412">412</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-413">413</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-414">414</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-415">415</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-416">416</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-417">417</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-418">418</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-419">419</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-420">420</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-421">421</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-422">422</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">get_bot_urls</span>(
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>        session_id: <span style="color: #007020">str</span>,
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>        botex_db: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>        already_started: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a>    ) <span style="color: #666666">-&gt;</span> List[<span style="color: #007020">str</span>]:
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a><span style="color: #4070a0; font-style: italic">    Get the URLs for the bot participants in an oTree session.</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span style="color: #4070a0; font-style: italic">        session_id (str): The ID of the oTree session.</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a><span style="color: #4070a0; font-style: italic">        botex_db (str): The name of the SQLite database file to store BotEx </span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><span style="color: #4070a0; font-style: italic">            data. If None (the default), it will be obtained from the </span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span style="color: #4070a0; font-style: italic">            environment variable BOTEX_DB.</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a><span style="color: #4070a0; font-style: italic">        already_started (bool): If True, the function will also run bots that </span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a><span style="color: #4070a0; font-style: italic">            have already started but not yet finished. This is useful if bots </span>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span style="color: #4070a0; font-style: italic">            did not startup properly because of network issues. Default is </span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><span style="color: #4070a0; font-style: italic">            False.</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span style="color: #4070a0; font-style: italic">        List of URLs for the bot participants</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span style="color: #007020; font-weight: bold">if</span> botex_db <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: botex_db <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;BOTEX_DB&#39;</span>)
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a>    conn <span style="color: #666666">=</span> sqlite3<span style="color: #666666">.</span>connect(botex_db)
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a>    cursor <span style="color: #666666">=</span> conn<span style="color: #666666">.</span>cursor()
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a>    cursor<span style="color: #666666">.</span>execute(
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><span style="color: #bbbbbb">        </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a><span style="color: #4070a0; font-style: italic">        SELECT url,time_in,time_out FROM participants </span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a><span style="color: #4070a0; font-style: italic">        WHERE session_id = ? AND is_human = 0</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a><span style="color: #4070a0; font-style: italic">        &quot;&quot;&quot;</span>, (session_id,)
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>    )
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span style="color: #007020; font-weight: bold">if</span> already_started:
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>        urls <span style="color: #666666">=</span> [row[<span style="color: #40a070">0</span>] <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> cursor<span style="color: #666666">.</span>fetchall() <span style="color: #007020; font-weight: bold">if</span> row[<span style="color: #40a070">2</span>] <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>]
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a>        urls <span style="color: #666666">=</span> [row[<span style="color: #40a070">0</span>] <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> cursor<span style="color: #666666">.</span>fetchall() <span style="color: #007020; font-weight: bold">if</span> row[<span style="color: #40a070">1</span>] <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>]
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a>    cursor<span style="color: #666666">.</span>close()
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>    conn<span style="color: #666666">.</span>close()
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span style="color: #007020; font-weight: bold">return</span> urls
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="run_bots_on_session"><code>run_bots_on_session</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Run botex bots on an oTree session.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the oTree session.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bot_urls</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of URLs for the bot participants.
Will be retrieved from the database if None (the default).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the SQLite database file for BotEx data.
If None (the default), it will be obtained from the environment 
variable BOTEX_DB.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to use for the bot. Default is 
<code>gpt-4o-2024-08-06</code> from OpenAI vie LiteLLM. It needs to be a model 
that supports structured outputs. For OpenAI, these are 
gpt-4o-mini-2024-07-18 and later or gpt-4o-2024-08-06 and later. If 
you use a commercial model, You need to provide an API key in the 
parameter <code>api_key</code> and be prepared to pay to use this model.</p>
<p>If you want to use local models, we suggest that you use llama.cpp, 
In this case, set this string to <code>lamacpp</code> and set the URL of your 
llama.cpp server in <code>api_base</code>. If you want botex to start the  llama.cpp server for you, run <code>start_llamacpp_sever()</code> prior to 
running run_bots_on_session().</p>
              </div>
            </td>
            <td>
                  <code>&#39;gpt-4o-2024-08-06&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API key for the model that you use. If None (the 
default), it will be obtained from environment variables by liteLLM 
(e.g., OPENAI_API_KEY or GEMINI_API_KEY). </p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_base</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The base URL for the llm server. Default is None not to
interfere with the default LiteLLM behavior. If you want to use a 
local model with llama.cpp and if you have not explicitly set this 
parameter, it will default to <code>http://localhost:8080</code>, the default 
url for the llama.cpp server.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>throttle</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to slow down the bot's requests. Slowing done 
the requests can help to avoid rate limiting. Default is False. The 
bot will switch to <code>throttle=True</code> when LiteLLM is used and 
completion requests raise exceptions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_conv_history</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the full conversation history.
This will increase token use and only work with very short 
experiments. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_prompts</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of user prompts to override the 
default prompts that the bot uses. The keys should be one or more 
of the following:</p>
<p>[<code>start</code>, <code>analyze_first_page_no_q</code>, <code>analyze_first_page_q</code>, 
<code>analyze_page_no_q</code>, <code>analyze_page_q</code>,
<code>analyze_page_no_q_full_hist</code>, <code>analyze_page_q_full_hist</code>, 
<code>page_not_changed</code>, <code>system</code>, <code>system_full_hist</code>, <code>resp_too_long</code>, 
<code>json_error</code>, <code>end</code>, <code>end_full_hist</code>].</p>
<p>If a key is not present in  the dictionary, the default prompt will 
be used. If a key that is not in the default prompts is present in 
the dictionary, then the bot will exit with a warning and not run 
to make sure that the user is aware of the issue.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>already_started</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will also run bots that 
have already started but not yet finished. This is useful if bots 
did not startup properly because of network issues. Default is 
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True (the default), the function will wait for the bots 
to finish.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments to pass on to
<code>litellm.completion()</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None | <span title="typing.List">List</span>[<span title="threading.Thread">Thread</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None (bot conversation logs are stored in database) if wait is True. A list of Threads running the bots if wait is False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <details class="tip">
<summary>Additional details</summary>
<p>When running local models via llama.cpp, if you would like 
    botex to start the llama.cpp server for you, 
    run <code>start_llamacpp_server()</code> to start up the server prior to
    running <code>run_bots_on_session()</code>.</p>
</details>
<details class="example">
<summary>Example Usage</summary>
<ul>
<li>Running botex with the default model (<code>gpt-4o-2024-08-06</code>)</li>
</ul>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>run_bots_on_session(
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    session_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_id&quot;</span>,
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    botex_db<span style="color: #666666">=</span><span style="color: #4070a0">&quot;path/to/botex.sqlite3&quot;</span>,
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    api_key<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_openai_api_key&quot;</span>,
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span style="color: #60a0b0; font-style: italic"># Other parameters if and as needed</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>)
</span></code></pre></div>
<ul>
<li>Using a specific model supported by LiteLLM</li>
</ul>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>run_bots_on_session(
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    session_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_id&quot;</span>,
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    botex_db<span style="color: #666666">=</span><span style="color: #4070a0">&quot;path/to/botex.sqlite3&quot;</span>,
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    model<span style="color: #666666">=</span><span style="color: #4070a0">&quot;gemini/gemini-1.5-flash&quot;</span>,
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    api_key<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_gemini_api_key&quot;</span>,
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span style="color: #60a0b0; font-style: italic"># Other parameters if and as needed</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>)
</span></code></pre></div>
<ul>
<li>Using a local model with BotEx starting the llama.cpp server</li>
</ul>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>llamacpp_config <span style="color: #666666">=</span> {
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span style="color: #4070a0">&quot;server_path&quot;</span>: <span style="color: #4070a0">&quot;/path/to/llama/server&quot;</span>,
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span style="color: #4070a0">&quot;local_llm_path&quot;</span>: <span style="color: #4070a0">&quot;/path/to/local/model&quot;</span>,
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span style="color: #60a0b0; font-style: italic"># Additional configuration parameters if and as needed</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>}
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>process_id <span style="color: #666666">=</span> start_llamacpp_server(llamacpp_config)
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>run_bots_on_session(
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    session_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_id&quot;</span>,
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    botex_db<span style="color: #666666">=</span><span style="color: #4070a0">&quot;path/to/botex.sqlite3&quot;</span>,
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    model<span style="color: #666666">=</span><span style="color: #4070a0">&quot;llamacpp&quot;</span>,
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span style="color: #60a0b0; font-style: italic"># Other parameters if and as needed</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>)
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>stop_llamacpp_server(process_id)
</span></code></pre></div>
<ul>
<li>Using a local model with an already running llama.cpp server that 
    uses a URL different from the default (if you are using the 
    default "http://localhost:8080", you can simply omit the <code>api_base</code> 
    parameter)</li>
</ul>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>run_bots_on_session(
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    session_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_id&quot;</span>,
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    botex_db<span style="color: #666666">=</span><span style="color: #4070a0">&quot;path/to/botex.sqlite3&quot;</span>,
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    model <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;llamacpp&quot;</span>,
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    api_base <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;http://yourserver:port&quot;</span>},
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span style="color: #60a0b0; font-style: italic"># Other parameters if and as needed</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>)
</span></code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-424">424</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-425">425</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-426">426</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-427">427</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-428">428</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-429">429</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-430">430</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-431">431</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-432">432</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-433">433</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-434">434</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-435">435</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-436">436</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-437">437</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-438">438</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-439">439</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-440">440</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-441">441</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-442">442</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-443">443</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-444">444</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-445">445</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-446">446</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-447">447</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-448">448</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-449">449</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-450">450</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-451">451</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-452">452</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-453">453</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-454">454</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-455">455</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-456">456</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-457">457</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-458">458</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-459">459</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-460">460</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-461">461</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-462">462</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-463">463</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-464">464</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-465">465</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-466">466</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-467">467</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-468">468</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-469">469</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-470">470</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-471">471</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-472">472</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-473">473</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-474">474</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-475">475</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-476">476</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-477">477</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-478">478</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-479">479</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-480">480</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-481">481</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-482">482</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-483">483</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-484">484</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-485">485</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-486">486</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-487">487</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-488">488</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-489">489</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-490">490</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-491">491</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-492">492</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-493">493</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-494">494</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-495">495</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-496">496</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-497">497</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-498">498</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-499">499</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-500">500</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-501">501</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-502">502</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-503">503</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-504">504</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-505">505</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-506">506</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-507">507</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-508">508</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-509">509</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-510">510</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-511">511</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-512">512</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-513">513</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-514">514</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-515">515</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-516">516</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-517">517</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-518">518</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-519">519</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-520">520</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-521">521</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-522">522</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-523">523</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-524">524</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-525">525</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-526">526</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-527">527</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-528">528</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-529">529</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-530">530</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-531">531</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-532">532</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-533">533</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-534">534</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-535">535</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-536">536</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-537">537</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-538">538</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-539">539</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-540">540</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-541">541</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-542">542</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-543">543</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-544">544</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-545">545</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-546">546</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-547">547</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-548">548</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-549">549</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-550">550</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-551">551</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-552">552</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-553">553</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-554">554</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-555">555</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-556">556</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-557">557</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-558">558</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-559">559</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-560">560</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-561">561</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-562">562</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-563">563</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-564">564</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-565">565</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-566">566</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-567">567</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-568">568</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-569">569</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-570">570</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-571">571</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-572">572</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-573">573</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-574">574</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-575">575</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-576">576</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-577">577</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-578">578</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-579">579</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-580">580</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-581">581</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-582">582</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-583">583</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-584">584</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-585">585</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-586">586</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-587">587</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-588">588</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-589">589</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-590">590</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-591">591</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-592">592</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-593">593</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-594">594</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-595">595</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">run_bots_on_session</span>(
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a>        session_id: <span style="color: #007020">str</span>,
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a>        bot_urls: List[<span style="color: #007020">str</span>] <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, 
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a>        botex_db: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, 
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>        model: <span style="color: #007020">str</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;gpt-4o-2024-08-06&quot;</span>,
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429"></a>        api_key: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a>        api_base: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a>        throttle: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>,
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a>        full_conv_history: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>,
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a>        user_prompts: <span style="color: #007020">dict</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>        already_started: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>,
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a>        wait: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">True</span>,
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span style="color: #666666">**</span>kwargs
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a>    ) <span style="color: #666666">-&gt;</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">|</span> List[Thread]:
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a><span style="color: #4070a0; font-style: italic">    Run botex bots on an oTree session.</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span style="color: #4070a0; font-style: italic">        session_id (str): The ID of the oTree session.</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a><span style="color: #4070a0; font-style: italic">        bot_urls (list): A list of URLs for the bot participants.</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><span style="color: #4070a0; font-style: italic">            Will be retrieved from the database if None (the default).</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span style="color: #4070a0; font-style: italic">        botex_db (str): The name of the SQLite database file for BotEx data.</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a><span style="color: #4070a0; font-style: italic">            If None (the default), it will be obtained from the environment </span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span style="color: #4070a0; font-style: italic">            variable BOTEX_DB.</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a><span style="color: #4070a0; font-style: italic">        model (str): The model to use for the bot. Default is </span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span style="color: #4070a0; font-style: italic">            `gpt-4o-2024-08-06` from OpenAI vie LiteLLM. It needs to be a model </span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span style="color: #4070a0; font-style: italic">            that supports structured outputs. For OpenAI, these are </span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a><span style="color: #4070a0; font-style: italic">            gpt-4o-mini-2024-07-18 and later or gpt-4o-2024-08-06 and later. If </span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a><span style="color: #4070a0; font-style: italic">            you use a commercial model, You need to provide an API key in the </span>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a><span style="color: #4070a0; font-style: italic">            parameter `api_key` and be prepared to pay to use this model.</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a><span style="color: #4070a0; font-style: italic">            If you want to use local models, we suggest that you use llama.cpp, </span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a><span style="color: #4070a0; font-style: italic">            In this case, set this string to `lamacpp` and set the URL of your </span>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a><span style="color: #4070a0; font-style: italic">            llama.cpp server in `api_base`. If you want botex to start the  llama.cpp server for you, run `start_llamacpp_sever()` prior to </span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a><span style="color: #4070a0; font-style: italic">            running run_bots_on_session().</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a><span style="color: #4070a0; font-style: italic">        api_key (str): The API key for the model that you use. If None (the </span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a><span style="color: #4070a0; font-style: italic">            default), it will be obtained from environment variables by liteLLM </span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a><span style="color: #4070a0; font-style: italic">            (e.g., OPENAI_API_KEY or GEMINI_API_KEY). </span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a><span style="color: #4070a0; font-style: italic">        api_base (str): The base URL for the llm server. Default is None not to</span>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a><span style="color: #4070a0; font-style: italic">            interfere with the default LiteLLM behavior. If you want to use a </span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a><span style="color: #4070a0; font-style: italic">            local model with llama.cpp and if you have not explicitly set this </span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a><span style="color: #4070a0; font-style: italic">            parameter, it will default to `http://localhost:8080`, the default </span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a><span style="color: #4070a0; font-style: italic">            url for the llama.cpp server.</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a><span style="color: #4070a0; font-style: italic">        throttle (bool): Whether to slow down the bot&#39;s requests. Slowing done </span>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a><span style="color: #4070a0; font-style: italic">            the requests can help to avoid rate limiting. Default is False. The </span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a><span style="color: #4070a0; font-style: italic">            bot will switch to `throttle=True` when LiteLLM is used and </span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a><span style="color: #4070a0; font-style: italic">            completion requests raise exceptions.</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a><span style="color: #4070a0; font-style: italic">        full_conv_history (bool): Whether to keep the full conversation history.</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a><span style="color: #4070a0; font-style: italic">            This will increase token use and only work with very short </span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a><span style="color: #4070a0; font-style: italic">            experiments. Default is False.</span>
</span><span id="__span-0-474"><a id="__codelineno-0-474" name="__codelineno-0-474"></a><span style="color: #4070a0; font-style: italic">        user_prompts (dict): A dictionary of user prompts to override the </span>
</span><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><span style="color: #4070a0; font-style: italic">            default prompts that the bot uses. The keys should be one or more </span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a><span style="color: #4070a0; font-style: italic">            of the following:</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a><span style="color: #4070a0; font-style: italic">            [`start`, `analyze_first_page_no_q`, `analyze_first_page_q`, </span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span style="color: #4070a0; font-style: italic">            `analyze_page_no_q`, `analyze_page_q`,</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a><span style="color: #4070a0; font-style: italic">            `analyze_page_no_q_full_hist`, `analyze_page_q_full_hist`, </span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><span style="color: #4070a0; font-style: italic">            `page_not_changed`, `system`, `system_full_hist`, `resp_too_long`, </span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span style="color: #4070a0; font-style: italic">            `json_error`, `end`, `end_full_hist`].</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span style="color: #4070a0; font-style: italic">            If a key is not present in  the dictionary, the default prompt will </span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><span style="color: #4070a0; font-style: italic">            be used. If a key that is not in the default prompts is present in </span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><span style="color: #4070a0; font-style: italic">            the dictionary, then the bot will exit with a warning and not run </span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><span style="color: #4070a0; font-style: italic">            to make sure that the user is aware of the issue.</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><span style="color: #4070a0; font-style: italic">        already_started (bool): If True, the function will also run bots that </span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a><span style="color: #4070a0; font-style: italic">            have already started but not yet finished. This is useful if bots </span>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span style="color: #4070a0; font-style: italic">            did not startup properly because of network issues. Default is </span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span style="color: #4070a0; font-style: italic">            False.</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a><span style="color: #4070a0; font-style: italic">        wait (bool): If True (the default), the function will wait for the bots </span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a><span style="color: #4070a0; font-style: italic">            to finish.</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a><span style="color: #4070a0; font-style: italic">        kwargs (dict): Additional keyword arguments to pass on to</span>
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a><span style="color: #4070a0; font-style: italic">            `litellm.completion()`.</span>
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a><span style="color: #4070a0; font-style: italic">        None (bot conversation logs are stored in database) if wait is True. A list of Threads running the bots if wait is False.</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a><span style="color: #4070a0; font-style: italic">    ??? tip &quot;Additional details&quot;</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a><span style="color: #4070a0; font-style: italic">        When running local models via llama.cpp, if you would like </span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a><span style="color: #4070a0; font-style: italic">            botex to start the llama.cpp server for you, </span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a><span style="color: #4070a0; font-style: italic">            run `start_llamacpp_server()` to start up the server prior to</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a><span style="color: #4070a0; font-style: italic">            running `run_bots_on_session()`.</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a><span style="color: #4070a0; font-style: italic">    ??? example &quot;Example Usage&quot;</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a>
</span><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a><span style="color: #4070a0; font-style: italic">        - Running botex with the default model (`gpt-4o-2024-08-06`)</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span style="color: #4070a0; font-style: italic">        ```python</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a><span style="color: #4070a0; font-style: italic">        run_bots_on_session(</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a><span style="color: #4070a0; font-style: italic">            session_id=&quot;your_session_id&quot;,</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span style="color: #4070a0; font-style: italic">            botex_db=&quot;path/to/botex.sqlite3&quot;,</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><span style="color: #4070a0; font-style: italic">            api_key=&quot;your_openai_api_key&quot;,</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span style="color: #4070a0; font-style: italic">            # Other parameters if and as needed</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span style="color: #4070a0; font-style: italic">        )</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><span style="color: #4070a0; font-style: italic">        - Using a specific model supported by LiteLLM</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><span style="color: #4070a0; font-style: italic">        ```python    </span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span style="color: #4070a0; font-style: italic">        run_bots_on_session(</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a><span style="color: #4070a0; font-style: italic">            session_id=&quot;your_session_id&quot;,</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a><span style="color: #4070a0; font-style: italic">            botex_db=&quot;path/to/botex.sqlite3&quot;,</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a><span style="color: #4070a0; font-style: italic">            model=&quot;gemini/gemini-1.5-flash&quot;,</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a><span style="color: #4070a0; font-style: italic">            api_key=&quot;your_gemini_api_key&quot;,</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a><span style="color: #4070a0; font-style: italic">            # Other parameters if and as needed</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a><span style="color: #4070a0; font-style: italic">        )</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a><span style="color: #4070a0; font-style: italic">        - Using a local model with BotEx starting the llama.cpp server</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a><span style="color: #4070a0; font-style: italic">        ```python</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a><span style="color: #4070a0; font-style: italic">        llamacpp_config = {</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a><span style="color: #4070a0; font-style: italic">            &quot;server_path&quot;: &quot;/path/to/llama/server&quot;,</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a><span style="color: #4070a0; font-style: italic">            &quot;local_llm_path&quot;: &quot;/path/to/local/model&quot;,</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a><span style="color: #4070a0; font-style: italic">            # Additional configuration parameters if and as needed</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a><span style="color: #4070a0; font-style: italic">        }</span>
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a><span style="color: #4070a0; font-style: italic">        process_id = start_llamacpp_server(llamacpp_config)</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a><span style="color: #4070a0; font-style: italic">        run_bots_on_session(</span>
</span><span id="__span-0-542"><a id="__codelineno-0-542" name="__codelineno-0-542"></a><span style="color: #4070a0; font-style: italic">            session_id=&quot;your_session_id&quot;,</span>
</span><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a><span style="color: #4070a0; font-style: italic">            botex_db=&quot;path/to/botex.sqlite3&quot;,</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><span style="color: #4070a0; font-style: italic">            model=&quot;llamacpp&quot;,</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a><span style="color: #4070a0; font-style: italic">            # Other parameters if and as needed</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a><span style="color: #4070a0; font-style: italic">        )</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a><span style="color: #4070a0; font-style: italic">        stop_llamacpp_server(process_id)</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a><span style="color: #4070a0; font-style: italic">        - Using a local model with an already running llama.cpp server that </span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a><span style="color: #4070a0; font-style: italic">            uses a URL different from the default (if you are using the </span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a><span style="color: #4070a0; font-style: italic">            default &quot;http://localhost:8080&quot;, you can simply omit the `api_base` </span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a><span style="color: #4070a0; font-style: italic">            parameter)</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a><span style="color: #4070a0; font-style: italic">        ```python</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a><span style="color: #4070a0; font-style: italic">        run_bots_on_session(</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a><span style="color: #4070a0; font-style: italic">            session_id=&quot;your_session_id&quot;,</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a><span style="color: #4070a0; font-style: italic">            botex_db=&quot;path/to/botex.sqlite3&quot;,</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a><span style="color: #4070a0; font-style: italic">            model = &quot;llamacpp&quot;,</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a><span style="color: #4070a0; font-style: italic">            api_base = &quot;http://yourserver:port&quot;},</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a><span style="color: #4070a0; font-style: italic">            # Other parameters if and as needed</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a><span style="color: #4070a0; font-style: italic">        )</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span style="color: #007020; font-weight: bold">if</span> botex_db <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: botex_db <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;BOTEX_DB&#39;</span>)
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span style="color: #007020; font-weight: bold">if</span> api_key <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #007020; font-weight: bold">and</span> <span style="color: #4070a0">&#39;openai_api_key&#39;</span> <span style="color: #007020; font-weight: bold">in</span> kwargs: 
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567"></a>        api_key <span style="color: #666666">=</span> kwargs<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;openai_api_key&#39;</span>)
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span style="color: #007020; font-weight: bold">if</span> bot_urls <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: 
</span><span id="__span-0-569"><a id="__codelineno-0-569" name="__codelineno-0-569"></a>        bot_urls <span style="color: #666666">=</span> get_bot_urls(session_id, botex_db, already_started)
</span><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570"></a>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571"></a>    otree_url <span style="color: #666666">=</span> bot_urls[<span style="color: #40a070">0</span>]<span style="color: #666666">.</span>split(<span style="color: #4070a0">&#39;/InitializeParticipant/&#39;</span>)[<span style="color: #40a070">0</span>]
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572"></a>    logger<span style="color: #666666">.</span>info(
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span style="color: #4070a0">f&quot;Running bots on session </span><span style="color: #70a0d0; font-style: italic">{</span>session_id<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">. &quot;</span>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span style="color: #4070a0">f&quot;You can monitor the session at </span><span style="color: #70a0d0; font-style: italic">{</span>otree_url<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">/SessionMonitor/</span><span style="color: #70a0d0; font-style: italic">{</span>session_id<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&quot;</span>
</span><span id="__span-0-575"><a id="__codelineno-0-575" name="__codelineno-0-575"></a>    )
</span><span id="__span-0-576"><a id="__codelineno-0-576" name="__codelineno-0-576"></a>    thread_kwargs <span style="color: #666666">=</span> {
</span><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span style="color: #4070a0">&#39;botex_db&#39;</span>: botex_db, <span style="color: #4070a0">&#39;session_id&#39;</span>: session_id, 
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span style="color: #4070a0">&#39;full_conv_history&#39;</span>: full_conv_history, 
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span style="color: #4070a0">&#39;model&#39;</span>: model, <span style="color: #4070a0">&#39;api_key&#39;</span>: api_key,
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span style="color: #4070a0">&#39;api_base&#39;</span>: api_base,
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span style="color: #4070a0">&#39;user_prompts&#39;</span>: user_prompts,
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span style="color: #4070a0">&#39;throttle&#39;</span>: throttle
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583"></a>    }
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584"></a>    thread_kwargs<span style="color: #666666">.</span>update(kwargs)
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585"></a>    threads <span style="color: #666666">=</span> [
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586"></a>        Thread(
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a>            target <span style="color: #666666">=</span> run_bot, 
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a>            kwargs <span style="color: #666666">=</span> <span style="color: #007020">dict</span>(thread_kwargs, <span style="color: #666666">**</span>{<span style="color: #4070a0">&#39;url&#39;</span>: url})
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a>        ) <span style="color: #007020; font-weight: bold">for</span> url <span style="color: #007020; font-weight: bold">in</span> bot_urls 
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a>    ]
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span style="color: #007020; font-weight: bold">for</span> t <span style="color: #007020; font-weight: bold">in</span> threads: t<span style="color: #666666">.</span>start()
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span style="color: #007020; font-weight: bold">if</span> wait: 
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span style="color: #007020; font-weight: bold">for</span> t <span style="color: #007020; font-weight: bold">in</span> threads: t<span style="color: #666666">.</span>join()
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span style="color: #007020; font-weight: bold">return</span> threads
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="run_single_bot"><code>run_single_bot</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Runs a single botex bot manually.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The participant URL to start the bot on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the oTree session. Defaults to "unknown"</p>
              </div>
            </td>
            <td>
                  <code>&#39;unknown&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The oTree ID of the oTree session. Defaults to 
"unknown".</p>
              </div>
            </td>
            <td>
                  <code>&#39;unknown&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>participant_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The oTree ID of the participant. Defaults to 
"unknown".</p>
              </div>
            </td>
            <td>
                  <code>&#39;unknown&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the SQLite database file to store botex 
data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_conv_history</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the full conversation history.
This will increase token use and only work with very short 
experiments. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to use for the bot. Default is 
<code>gpt-4o-2024-08-06</code> from OpenAI vie LiteLLM. It needs to be a model 
that supports structured outputs. For OpenAI, these are 
gpt-4o-mini-2024-07-18 and later or gpt-4o-2024-08-06 and later. If 
you use a commercial model, You need to provide an API key in the 
parameter <code>api_key</code> and be prepared to pay to use this model.</p>
<p>If you want to use local models, we suggest that you use llama.cpp, 
In this case, set this string to <code>lamacpp</code> and set the URL of your 
llama.cpp server in <code>api_base</code>. If you want botex to start the  llama.cpp server for you, run <code>start_llamacpp_sever()</code> prior to 
running run_bots_on_session().</p>
              </div>
            </td>
            <td>
                  <code>&#39;gpt-4o-2024-08-06&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API key for the model that you use. If None (the 
default), it will be obtained from environment variables by liteLLM 
(e.g., OPENAI_API_KEY or GEMINI_API_KEY). </p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>api_base</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The base URL for the llm server. Default is None not to
interfere with the default LiteLLM behavior. If you want to use a 
local model with llama.cpp and if you have not explicitly set this 
parameter, it will default to <code>http://localhost:8080</code>, the default 
url for the llama.cpp server.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>throttle</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to slow down the bot's requests. Slowing done 
the requests can help to avoid rate limiting. Default is False. The 
bot will switch to <code>throttle=True</code> when LiteLLM is used and 
completion requests raise exceptions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_conv_history</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the full conversation history.
This will increase token use and only work with very short 
experiments. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_prompts</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of user prompts to override the 
default prompts that the bot uses. The keys should be one or more 
of the following:</p>
<p>[<code>start</code>, <code>analyze_first_page_no_q</code>, <code>analyze_first_page_q</code>, 
<code>analyze_page_no_q</code>, <code>analyze_page_q</code>,
<code>analyze_page_no_q_full_hist</code>, <code>analyze_page_q_full_hist</code>, 
<code>page_not_changed</code>, <code>system</code>, <code>system_full_hist</code>, <code>resp_too_long</code>, 
<code>json_error</code>, <code>end</code>, <code>end_full_hist</code>].</p>
<p>If a key is not present in  the dictionary, the default prompt will 
be used. If a key that is not in the default prompts is present in 
the dictionary, then the bot will exit with a warning and not run 
to make sure that the user is aware of the issue.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True (the default), the function will wait for the bots 
to finish.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments to pass on to
<code>litellm.completion()</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None | <span title="threading.Thread">Thread</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None (conversation is stored in the botex database) if wait is True.
The Thread running the bot if wait is False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Notes:</p>
<ul>
<li>When running local models via llama.cpp, if you would like 
    botex to start the llama.cpp server for you, 
    run <code>start_llamacpp_server()</code> to start up the server prior to
    running <code>run_bots_on_session()</code>.</li>
</ul>
<details class="example">
<summary>Example Usage</summary>
<ul>
<li>Using a model via LiteLLM</li>
</ul>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>run_single_bot(
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    url<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_participant_url&quot;</span>,
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    session_name<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_name&quot;</span>,
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    session_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_id&quot;</span>,
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    participant_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_participant_id&quot;</span>,
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    botex_db<span style="color: #666666">=</span><span style="color: #4070a0">&quot;path/to/botex.sqlite3&quot;</span>,
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    model<span style="color: #666666">=</span><span style="color: #4070a0">&quot;a LiteLLM model string, e.g. &#39;gemini/gemini-1.5-flash&#39;&quot;</span>,
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    api_key<span style="color: #666666">=</span><span style="color: #4070a0">&quot;the API key for your model provide&quot;</span>,
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span style="color: #60a0b0; font-style: italic"># Other parameters if and as needed</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>)
</span></code></pre></div>
<ul>
<li>Using a local model with an already running llama.cpp server</li>
</ul>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>run_single_bot(
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    url<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_participant_url&quot;</span>,
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    session_name<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_name&quot;</span>,
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    session_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_id&quot;</span>,
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    participant_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_participant_id&quot;</span>,
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    botex_db<span style="color: #666666">=</span><span style="color: #4070a0">&quot;path/to/botex.sqlite3&quot;</span>,
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    model<span style="color: #666666">=</span><span style="color: #4070a0">&quot;llamacpp&quot;</span>,
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    api_base<span style="color: #666666">=</span><span style="color: #4070a0">&quot;http://yourhost:port&quot;</span> <span style="color: #60a0b0; font-style: italic"># defaults to http://localhost:8080</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span style="color: #60a0b0; font-style: italic"># Other parameters if and as needed</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>)
</span></code></pre></div>
<ul>
<li>Using a local model with BotEx starting the llama.cpp server</li>
</ul>
<div class="language-python highlight" style="background: #f0f0f0"><pre style="line-height: 125%;"><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>llamacpp_config <span style="color: #666666">=</span> {
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span style="color: #4070a0">&quot;server_path&quot;</span>: <span style="color: #4070a0">&quot;/path/to/llama/server&quot;</span>,
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span style="color: #4070a0">&quot;local_llm_path&quot;</span>: <span style="color: #4070a0">&quot;/path/to/local/model&quot;</span>,
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span style="color: #60a0b0; font-style: italic"># Additional configuration parameters if and as needed</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>}
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>process_id <span style="color: #666666">=</span> start_llamacpp_server(llamacpp_config)
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>run_single_bot(
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    url<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_participant_url&quot;</span>,
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    session_name<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_name&quot;</span>,
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    session_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_session_id&quot;</span>,
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    participant_id<span style="color: #666666">=</span><span style="color: #4070a0">&quot;your_participant_id&quot;</span>,
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    botex_db<span style="color: #666666">=</span><span style="color: #4070a0">&quot;path/to/botex.sqlite3&quot;</span>,
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    model<span style="color: #666666">=</span><span style="color: #4070a0">&quot;llamacpp&quot;</span>,
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span style="color: #60a0b0; font-style: italic"># Other parameters if and as needed</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>)
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>stop_llamacpp_server(process_id)
</span></code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-597">597</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-598">598</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-599">599</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-600">600</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-601">601</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-602">602</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-603">603</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-604">604</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-605">605</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-606">606</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-607">607</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-608">608</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-609">609</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-610">610</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-611">611</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-612">612</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-613">613</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-614">614</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-615">615</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-616">616</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-617">617</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-618">618</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-619">619</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-620">620</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-621">621</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-622">622</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-623">623</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-624">624</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-625">625</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-626">626</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-627">627</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-628">628</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-629">629</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-630">630</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-631">631</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-632">632</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-633">633</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-634">634</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-635">635</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-636">636</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-637">637</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-638">638</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-639">639</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-640">640</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-641">641</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-642">642</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-643">643</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-644">644</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-645">645</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-646">646</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-647">647</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-648">648</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-649">649</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-650">650</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-651">651</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-652">652</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-653">653</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-654">654</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-655">655</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-656">656</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-657">657</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-658">658</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-659">659</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-660">660</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-661">661</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-662">662</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-663">663</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-664">664</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-665">665</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-666">666</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-667">667</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-668">668</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-669">669</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-670">670</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-671">671</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-672">672</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-673">673</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-674">674</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-675">675</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-676">676</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-677">677</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-678">678</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-679">679</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-680">680</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-681">681</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-682">682</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-683">683</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-684">684</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-685">685</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-686">686</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-687">687</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-688">688</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-689">689</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-690">690</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-691">691</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-692">692</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-693">693</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-694">694</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-695">695</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-696">696</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-697">697</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-698">698</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-699">699</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-700">700</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-701">701</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-702">702</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-703">703</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-704">704</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-705">705</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-706">706</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-707">707</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-708">708</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-709">709</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-710">710</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-711">711</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-712">712</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-713">713</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-714">714</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-715">715</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-716">716</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-717">717</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-718">718</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-719">719</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-720">720</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-721">721</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-722">722</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-723">723</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-724">724</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-725">725</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-726">726</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-727">727</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-728">728</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-729">729</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-730">730</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-731">731</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-732">732</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-733">733</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-734">734</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-735">735</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-736">736</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-737">737</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-738">738</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-739">739</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-740">740</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-741">741</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-742">742</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-743">743</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-744">744</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-745">745</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-746">746</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-747">747</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-748">748</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-749">749</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-750">750</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-751">751</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-752">752</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-753">753</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-754">754</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-755">755</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-756">756</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-757">757</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-758">758</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-759">759</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-760">760</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-761">761</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-762">762</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-763">763</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-764">764</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-765">765</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-766">766</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-767">767</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-768">768</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-769">769</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-770">770</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-771">771</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-772">772</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-773">773</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-774">774</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-775">775</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-776">776</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-777">777</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-778">778</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-779">779</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-780">780</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-781">781</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-782">782</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">run_single_bot</span>(
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>    url: <span style="color: #007020">str</span>,
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>    session_name: <span style="color: #007020">str</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;unknown&quot;</span>,
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>    session_id: <span style="color: #007020">str</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;unknown&quot;</span>, 
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601"></a>    participant_id: <span style="color: #007020">str</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;unknown&quot;</span>,
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a>    botex_db: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a>    model: <span style="color: #007020">str</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;gpt-4o-2024-08-06&quot;</span>,
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>    api_key: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a>    api_base: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a>    throttle: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>, 
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a>    full_conv_history: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>,
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a>    user_prompts: <span style="color: #007020">dict</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a>    wait: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">True</span>,
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span style="color: #666666">**</span>kwargs
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a>) <span style="color: #666666">-&gt;</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">|</span> Thread:
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a><span style="color: #4070a0; font-style: italic">    Runs a single botex bot manually.</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a><span style="color: #4070a0; font-style: italic">        url (str): The participant URL to start the bot on.</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a><span style="color: #4070a0; font-style: italic">        session_name (str): The name of the oTree session. Defaults to &quot;unknown&quot;</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a><span style="color: #4070a0; font-style: italic">        session_id (str): The oTree ID of the oTree session. Defaults to </span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a><span style="color: #4070a0; font-style: italic">            &quot;unknown&quot;.</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a><span style="color: #4070a0; font-style: italic">        participant_id (str): The oTree ID of the participant. Defaults to </span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a><span style="color: #4070a0; font-style: italic">            &quot;unknown&quot;.</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a><span style="color: #4070a0; font-style: italic">        botex_db (str): The name of the SQLite database file to store botex </span>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623"></a><span style="color: #4070a0; font-style: italic">            data.</span>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a><span style="color: #4070a0; font-style: italic">        full_conv_history (bool): Whether to keep the full conversation history.</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a><span style="color: #4070a0; font-style: italic">            This will increase token use and only work with very short </span>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a><span style="color: #4070a0; font-style: italic">            experiments. Default is False.</span>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a><span style="color: #4070a0; font-style: italic">        model (str): The model to use for the bot. Default is </span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a><span style="color: #4070a0; font-style: italic">            `gpt-4o-2024-08-06` from OpenAI vie LiteLLM. It needs to be a model </span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a><span style="color: #4070a0; font-style: italic">            that supports structured outputs. For OpenAI, these are </span>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a><span style="color: #4070a0; font-style: italic">            gpt-4o-mini-2024-07-18 and later or gpt-4o-2024-08-06 and later. If </span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a><span style="color: #4070a0; font-style: italic">            you use a commercial model, You need to provide an API key in the </span>
</span><span id="__span-0-632"><a id="__codelineno-0-632" name="__codelineno-0-632"></a><span style="color: #4070a0; font-style: italic">            parameter `api_key` and be prepared to pay to use this model.</span>
</span><span id="__span-0-633"><a id="__codelineno-0-633" name="__codelineno-0-633"></a>
</span><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a><span style="color: #4070a0; font-style: italic">            If you want to use local models, we suggest that you use llama.cpp, </span>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a><span style="color: #4070a0; font-style: italic">            In this case, set this string to `lamacpp` and set the URL of your </span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a><span style="color: #4070a0; font-style: italic">            llama.cpp server in `api_base`. If you want botex to start the  llama.cpp server for you, run `start_llamacpp_sever()` prior to </span>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a><span style="color: #4070a0; font-style: italic">            running run_bots_on_session().</span>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a><span style="color: #4070a0; font-style: italic">        api_key (str): The API key for the model that you use. If None (the </span>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a><span style="color: #4070a0; font-style: italic">            default), it will be obtained from environment variables by liteLLM </span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a><span style="color: #4070a0; font-style: italic">            (e.g., OPENAI_API_KEY or GEMINI_API_KEY). </span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a><span style="color: #4070a0; font-style: italic">        api_base (str): The base URL for the llm server. Default is None not to</span>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a><span style="color: #4070a0; font-style: italic">            interfere with the default LiteLLM behavior. If you want to use a </span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a><span style="color: #4070a0; font-style: italic">            local model with llama.cpp and if you have not explicitly set this </span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a><span style="color: #4070a0; font-style: italic">            parameter, it will default to `http://localhost:8080`, the default </span>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a><span style="color: #4070a0; font-style: italic">            url for the llama.cpp server.</span>
</span><span id="__span-0-646"><a id="__codelineno-0-646" name="__codelineno-0-646"></a><span style="color: #4070a0; font-style: italic">        throttle (bool): Whether to slow down the bot&#39;s requests. Slowing done </span>
</span><span id="__span-0-647"><a id="__codelineno-0-647" name="__codelineno-0-647"></a><span style="color: #4070a0; font-style: italic">            the requests can help to avoid rate limiting. Default is False. The </span>
</span><span id="__span-0-648"><a id="__codelineno-0-648" name="__codelineno-0-648"></a><span style="color: #4070a0; font-style: italic">            bot will switch to `throttle=True` when LiteLLM is used and </span>
</span><span id="__span-0-649"><a id="__codelineno-0-649" name="__codelineno-0-649"></a><span style="color: #4070a0; font-style: italic">            completion requests raise exceptions.</span>
</span><span id="__span-0-650"><a id="__codelineno-0-650" name="__codelineno-0-650"></a><span style="color: #4070a0; font-style: italic">        full_conv_history (bool): Whether to keep the full conversation history.</span>
</span><span id="__span-0-651"><a id="__codelineno-0-651" name="__codelineno-0-651"></a><span style="color: #4070a0; font-style: italic">            This will increase token use and only work with very short </span>
</span><span id="__span-0-652"><a id="__codelineno-0-652" name="__codelineno-0-652"></a><span style="color: #4070a0; font-style: italic">            experiments. Default is False.</span>
</span><span id="__span-0-653"><a id="__codelineno-0-653" name="__codelineno-0-653"></a><span style="color: #4070a0; font-style: italic">        user_prompts (dict): A dictionary of user prompts to override the </span>
</span><span id="__span-0-654"><a id="__codelineno-0-654" name="__codelineno-0-654"></a><span style="color: #4070a0; font-style: italic">            default prompts that the bot uses. The keys should be one or more </span>
</span><span id="__span-0-655"><a id="__codelineno-0-655" name="__codelineno-0-655"></a><span style="color: #4070a0; font-style: italic">            of the following:</span>
</span><span id="__span-0-656"><a id="__codelineno-0-656" name="__codelineno-0-656"></a>
</span><span id="__span-0-657"><a id="__codelineno-0-657" name="__codelineno-0-657"></a><span style="color: #4070a0; font-style: italic">            [`start`, `analyze_first_page_no_q`, `analyze_first_page_q`, </span>
</span><span id="__span-0-658"><a id="__codelineno-0-658" name="__codelineno-0-658"></a><span style="color: #4070a0; font-style: italic">            `analyze_page_no_q`, `analyze_page_q`,</span>
</span><span id="__span-0-659"><a id="__codelineno-0-659" name="__codelineno-0-659"></a><span style="color: #4070a0; font-style: italic">            `analyze_page_no_q_full_hist`, `analyze_page_q_full_hist`, </span>
</span><span id="__span-0-660"><a id="__codelineno-0-660" name="__codelineno-0-660"></a><span style="color: #4070a0; font-style: italic">            `page_not_changed`, `system`, `system_full_hist`, `resp_too_long`, </span>
</span><span id="__span-0-661"><a id="__codelineno-0-661" name="__codelineno-0-661"></a><span style="color: #4070a0; font-style: italic">            `json_error`, `end`, `end_full_hist`].</span>
</span><span id="__span-0-662"><a id="__codelineno-0-662" name="__codelineno-0-662"></a>
</span><span id="__span-0-663"><a id="__codelineno-0-663" name="__codelineno-0-663"></a><span style="color: #4070a0; font-style: italic">            If a key is not present in  the dictionary, the default prompt will </span>
</span><span id="__span-0-664"><a id="__codelineno-0-664" name="__codelineno-0-664"></a><span style="color: #4070a0; font-style: italic">            be used. If a key that is not in the default prompts is present in </span>
</span><span id="__span-0-665"><a id="__codelineno-0-665" name="__codelineno-0-665"></a><span style="color: #4070a0; font-style: italic">            the dictionary, then the bot will exit with a warning and not run </span>
</span><span id="__span-0-666"><a id="__codelineno-0-666" name="__codelineno-0-666"></a><span style="color: #4070a0; font-style: italic">            to make sure that the user is aware of the issue.</span>
</span><span id="__span-0-667"><a id="__codelineno-0-667" name="__codelineno-0-667"></a><span style="color: #4070a0; font-style: italic">        wait (bool): If True (the default), the function will wait for the bots </span>
</span><span id="__span-0-668"><a id="__codelineno-0-668" name="__codelineno-0-668"></a><span style="color: #4070a0; font-style: italic">            to finish.</span>
</span><span id="__span-0-669"><a id="__codelineno-0-669" name="__codelineno-0-669"></a><span style="color: #4070a0; font-style: italic">        kwargs (dict): Additional keyword arguments to pass on to</span>
</span><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670"></a><span style="color: #4070a0; font-style: italic">            `litellm.completion()`.</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671"></a>
</span><span id="__span-0-672"><a id="__codelineno-0-672" name="__codelineno-0-672"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-673"><a id="__codelineno-0-673" name="__codelineno-0-673"></a><span style="color: #4070a0; font-style: italic">        None (conversation is stored in the botex database) if wait is True.</span>
</span><span id="__span-0-674"><a id="__codelineno-0-674" name="__codelineno-0-674"></a><span style="color: #4070a0; font-style: italic">            The Thread running the bot if wait is False.</span>
</span><span id="__span-0-675"><a id="__codelineno-0-675" name="__codelineno-0-675"></a>
</span><span id="__span-0-676"><a id="__codelineno-0-676" name="__codelineno-0-676"></a><span style="color: #4070a0; font-style: italic">    Notes:</span>
</span><span id="__span-0-677"><a id="__codelineno-0-677" name="__codelineno-0-677"></a>
</span><span id="__span-0-678"><a id="__codelineno-0-678" name="__codelineno-0-678"></a><span style="color: #4070a0; font-style: italic">    -   When running local models via llama.cpp, if you would like </span>
</span><span id="__span-0-679"><a id="__codelineno-0-679" name="__codelineno-0-679"></a><span style="color: #4070a0; font-style: italic">        botex to start the llama.cpp server for you, </span>
</span><span id="__span-0-680"><a id="__codelineno-0-680" name="__codelineno-0-680"></a><span style="color: #4070a0; font-style: italic">        run `start_llamacpp_server()` to start up the server prior to</span>
</span><span id="__span-0-681"><a id="__codelineno-0-681" name="__codelineno-0-681"></a><span style="color: #4070a0; font-style: italic">        running `run_bots_on_session()`.</span>
</span><span id="__span-0-682"><a id="__codelineno-0-682" name="__codelineno-0-682"></a>
</span><span id="__span-0-683"><a id="__codelineno-0-683" name="__codelineno-0-683"></a><span style="color: #4070a0; font-style: italic">    ??? example &quot;Example Usage&quot;</span>
</span><span id="__span-0-684"><a id="__codelineno-0-684" name="__codelineno-0-684"></a>
</span><span id="__span-0-685"><a id="__codelineno-0-685" name="__codelineno-0-685"></a><span style="color: #4070a0; font-style: italic">        - Using a model via LiteLLM</span>
</span><span id="__span-0-686"><a id="__codelineno-0-686" name="__codelineno-0-686"></a>
</span><span id="__span-0-687"><a id="__codelineno-0-687" name="__codelineno-0-687"></a><span style="color: #4070a0; font-style: italic">        ```python</span>
</span><span id="__span-0-688"><a id="__codelineno-0-688" name="__codelineno-0-688"></a><span style="color: #4070a0; font-style: italic">        run_single_bot(</span>
</span><span id="__span-0-689"><a id="__codelineno-0-689" name="__codelineno-0-689"></a><span style="color: #4070a0; font-style: italic">            url=&quot;your_participant_url&quot;,</span>
</span><span id="__span-0-690"><a id="__codelineno-0-690" name="__codelineno-0-690"></a><span style="color: #4070a0; font-style: italic">            session_name=&quot;your_session_name&quot;,</span>
</span><span id="__span-0-691"><a id="__codelineno-0-691" name="__codelineno-0-691"></a><span style="color: #4070a0; font-style: italic">            session_id=&quot;your_session_id&quot;,</span>
</span><span id="__span-0-692"><a id="__codelineno-0-692" name="__codelineno-0-692"></a><span style="color: #4070a0; font-style: italic">            participant_id=&quot;your_participant_id&quot;,</span>
</span><span id="__span-0-693"><a id="__codelineno-0-693" name="__codelineno-0-693"></a><span style="color: #4070a0; font-style: italic">            botex_db=&quot;path/to/botex.sqlite3&quot;,</span>
</span><span id="__span-0-694"><a id="__codelineno-0-694" name="__codelineno-0-694"></a><span style="color: #4070a0; font-style: italic">            model=&quot;a LiteLLM model string, e.g. &#39;gemini/gemini-1.5-flash&#39;&quot;,</span>
</span><span id="__span-0-695"><a id="__codelineno-0-695" name="__codelineno-0-695"></a><span style="color: #4070a0; font-style: italic">            api_key=&quot;the API key for your model provide&quot;,</span>
</span><span id="__span-0-696"><a id="__codelineno-0-696" name="__codelineno-0-696"></a><span style="color: #4070a0; font-style: italic">            # Other parameters if and as needed</span>
</span><span id="__span-0-697"><a id="__codelineno-0-697" name="__codelineno-0-697"></a><span style="color: #4070a0; font-style: italic">        )</span>
</span><span id="__span-0-698"><a id="__codelineno-0-698" name="__codelineno-0-698"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-699"><a id="__codelineno-0-699" name="__codelineno-0-699"></a>
</span><span id="__span-0-700"><a id="__codelineno-0-700" name="__codelineno-0-700"></a>
</span><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701"></a><span style="color: #4070a0; font-style: italic">        - Using a local model with an already running llama.cpp server</span>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702"></a>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703"></a><span style="color: #4070a0; font-style: italic">        ```python</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704"></a><span style="color: #4070a0; font-style: italic">        run_single_bot(</span>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705"></a><span style="color: #4070a0; font-style: italic">            url=&quot;your_participant_url&quot;,</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706"></a><span style="color: #4070a0; font-style: italic">            session_name=&quot;your_session_name&quot;,</span>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707"></a><span style="color: #4070a0; font-style: italic">            session_id=&quot;your_session_id&quot;,</span>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708"></a><span style="color: #4070a0; font-style: italic">            participant_id=&quot;your_participant_id&quot;,</span>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709"></a><span style="color: #4070a0; font-style: italic">            botex_db=&quot;path/to/botex.sqlite3&quot;,</span>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710"></a><span style="color: #4070a0; font-style: italic">            model=&quot;llamacpp&quot;,</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711"></a><span style="color: #4070a0; font-style: italic">            api_base=&quot;http://yourhost:port&quot; # defaults to http://localhost:8080</span>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712"></a><span style="color: #4070a0; font-style: italic">            # Other parameters if and as needed</span>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713"></a><span style="color: #4070a0; font-style: italic">        )</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715"></a>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716"></a><span style="color: #4070a0; font-style: italic">        - Using a local model with BotEx starting the llama.cpp server</span>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717"></a>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718"></a><span style="color: #4070a0; font-style: italic">        ```python</span>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719"></a><span style="color: #4070a0; font-style: italic">        llamacpp_config = {</span>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720"></a><span style="color: #4070a0; font-style: italic">            &quot;server_path&quot;: &quot;/path/to/llama/server&quot;,</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721"></a><span style="color: #4070a0; font-style: italic">            &quot;local_llm_path&quot;: &quot;/path/to/local/model&quot;,</span>
</span><span id="__span-0-722"><a id="__codelineno-0-722" name="__codelineno-0-722"></a><span style="color: #4070a0; font-style: italic">            # Additional configuration parameters if and as needed</span>
</span><span id="__span-0-723"><a id="__codelineno-0-723" name="__codelineno-0-723"></a><span style="color: #4070a0; font-style: italic">        }</span>
</span><span id="__span-0-724"><a id="__codelineno-0-724" name="__codelineno-0-724"></a><span style="color: #4070a0; font-style: italic">        process_id = start_llamacpp_server(llamacpp_config)</span>
</span><span id="__span-0-725"><a id="__codelineno-0-725" name="__codelineno-0-725"></a><span style="color: #4070a0; font-style: italic">        run_single_bot(</span>
</span><span id="__span-0-726"><a id="__codelineno-0-726" name="__codelineno-0-726"></a><span style="color: #4070a0; font-style: italic">            url=&quot;your_participant_url&quot;,</span>
</span><span id="__span-0-727"><a id="__codelineno-0-727" name="__codelineno-0-727"></a><span style="color: #4070a0; font-style: italic">            session_name=&quot;your_session_name&quot;,</span>
</span><span id="__span-0-728"><a id="__codelineno-0-728" name="__codelineno-0-728"></a><span style="color: #4070a0; font-style: italic">            session_id=&quot;your_session_id&quot;,</span>
</span><span id="__span-0-729"><a id="__codelineno-0-729" name="__codelineno-0-729"></a><span style="color: #4070a0; font-style: italic">            participant_id=&quot;your_participant_id&quot;,</span>
</span><span id="__span-0-730"><a id="__codelineno-0-730" name="__codelineno-0-730"></a><span style="color: #4070a0; font-style: italic">            botex_db=&quot;path/to/botex.sqlite3&quot;,</span>
</span><span id="__span-0-731"><a id="__codelineno-0-731" name="__codelineno-0-731"></a><span style="color: #4070a0; font-style: italic">            model=&quot;llamacpp&quot;,</span>
</span><span id="__span-0-732"><a id="__codelineno-0-732" name="__codelineno-0-732"></a><span style="color: #4070a0; font-style: italic">            # Other parameters if and as needed</span>
</span><span id="__span-0-733"><a id="__codelineno-0-733" name="__codelineno-0-733"></a><span style="color: #4070a0; font-style: italic">        )</span>
</span><span id="__span-0-734"><a id="__codelineno-0-734" name="__codelineno-0-734"></a><span style="color: #4070a0; font-style: italic">        stop_llamacpp_server(process_id)</span>
</span><span id="__span-0-735"><a id="__codelineno-0-735" name="__codelineno-0-735"></a><span style="color: #4070a0; font-style: italic">        ```</span>
</span><span id="__span-0-736"><a id="__codelineno-0-736" name="__codelineno-0-736"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-737"><a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span style="color: #007020; font-weight: bold">if</span> api_base <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-738"><a id="__codelineno-0-738" name="__codelineno-0-738"></a>        kwargs[<span style="color: #4070a0">&#39;api_base&#39;</span>] <span style="color: #666666">=</span> api_base
</span><span id="__span-0-739"><a id="__codelineno-0-739" name="__codelineno-0-739"></a>
</span><span id="__span-0-740"><a id="__codelineno-0-740" name="__codelineno-0-740"></a>    <span style="color: #007020; font-weight: bold">if</span> botex_db <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: botex_db <span style="color: #666666">=</span> os<span style="color: #666666">.</span>environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;BOTEX_DB&#39;</span>)
</span><span id="__span-0-741"><a id="__codelineno-0-741" name="__codelineno-0-741"></a>    <span style="color: #007020; font-weight: bold">if</span> api_key <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #007020; font-weight: bold">and</span> <span style="color: #4070a0">&#39;openai_api_key&#39;</span> <span style="color: #007020; font-weight: bold">in</span> kwargs: 
</span><span id="__span-0-742"><a id="__codelineno-0-742" name="__codelineno-0-742"></a>        api_key <span style="color: #666666">=</span> kwargs<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;openai_api_key&#39;</span>)
</span><span id="__span-0-743"><a id="__codelineno-0-743" name="__codelineno-0-743"></a>
</span><span id="__span-0-744"><a id="__codelineno-0-744" name="__codelineno-0-744"></a>    kwargs[<span style="color: #4070a0">&#39;api_key&#39;</span>] <span style="color: #666666">=</span> api_key
</span><span id="__span-0-745"><a id="__codelineno-0-745" name="__codelineno-0-745"></a>    is_human <span style="color: #666666">=</span> <span style="color: #40a070">0</span>
</span><span id="__span-0-746"><a id="__codelineno-0-746" name="__codelineno-0-746"></a>
</span><span id="__span-0-747"><a id="__codelineno-0-747" name="__codelineno-0-747"></a>    conn <span style="color: #666666">=</span> setup_botex_db(botex_db)
</span><span id="__span-0-748"><a id="__codelineno-0-748" name="__codelineno-0-748"></a>    cursor <span style="color: #666666">=</span> conn<span style="color: #666666">.</span>cursor()
</span><span id="__span-0-749"><a id="__codelineno-0-749" name="__codelineno-0-749"></a>    cursor<span style="color: #666666">.</span>execute(
</span><span id="__span-0-750"><a id="__codelineno-0-750" name="__codelineno-0-750"></a><span style="color: #bbbbbb">        </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-751"><a id="__codelineno-0-751" name="__codelineno-0-751"></a><span style="color: #4070a0; font-style: italic">        INSERT INTO participants (</span>
</span><span id="__span-0-752"><a id="__codelineno-0-752" name="__codelineno-0-752"></a><span style="color: #4070a0; font-style: italic">            session_name, session_id, participant_id, is_human, url) </span>
</span><span id="__span-0-753"><a id="__codelineno-0-753" name="__codelineno-0-753"></a><span style="color: #4070a0; font-style: italic">            VALUES (?, ?, ?, ?, ?) </span>
</span><span id="__span-0-754"><a id="__codelineno-0-754" name="__codelineno-0-754"></a><span style="color: #4070a0; font-style: italic">        &quot;&quot;&quot;</span>, (session_name, session_id, participant_id, is_human, url,)
</span><span id="__span-0-755"><a id="__codelineno-0-755" name="__codelineno-0-755"></a>    )
</span><span id="__span-0-756"><a id="__codelineno-0-756" name="__codelineno-0-756"></a>    conn<span style="color: #666666">.</span>commit()
</span><span id="__span-0-757"><a id="__codelineno-0-757" name="__codelineno-0-757"></a>    cursor<span style="color: #666666">.</span>close()
</span><span id="__span-0-758"><a id="__codelineno-0-758" name="__codelineno-0-758"></a>    <span style="color: #007020; font-weight: bold">if</span> wait:
</span><span id="__span-0-759"><a id="__codelineno-0-759" name="__codelineno-0-759"></a>        run_bot(
</span><span id="__span-0-760"><a id="__codelineno-0-760" name="__codelineno-0-760"></a>            botex_db <span style="color: #666666">=</span> botex_db, 
</span><span id="__span-0-761"><a id="__codelineno-0-761" name="__codelineno-0-761"></a>            session_id <span style="color: #666666">=</span> session_id, 
</span><span id="__span-0-762"><a id="__codelineno-0-762" name="__codelineno-0-762"></a>            url <span style="color: #666666">=</span> url, 
</span><span id="__span-0-763"><a id="__codelineno-0-763" name="__codelineno-0-763"></a>            model <span style="color: #666666">=</span> model, 
</span><span id="__span-0-764"><a id="__codelineno-0-764" name="__codelineno-0-764"></a>            throttle <span style="color: #666666">=</span> throttle, 
</span><span id="__span-0-765"><a id="__codelineno-0-765" name="__codelineno-0-765"></a>            full_conv_history <span style="color: #666666">=</span> full_conv_history,
</span><span id="__span-0-766"><a id="__codelineno-0-766" name="__codelineno-0-766"></a>            user_prompts <span style="color: #666666">=</span> user_prompts,
</span><span id="__span-0-767"><a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span style="color: #666666">**</span>kwargs
</span><span id="__span-0-768"><a id="__codelineno-0-768" name="__codelineno-0-768"></a>        )
</span><span id="__span-0-769"><a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-770"><a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span style="color: #007020; font-weight: bold">return</span> Thread(
</span><span id="__span-0-771"><a id="__codelineno-0-771" name="__codelineno-0-771"></a>            target <span style="color: #666666">=</span> run_bot, 
</span><span id="__span-0-772"><a id="__codelineno-0-772" name="__codelineno-0-772"></a>            kwargs <span style="color: #666666">=</span> <span style="color: #007020">dict</span>(
</span><span id="__span-0-773"><a id="__codelineno-0-773" name="__codelineno-0-773"></a>                botex_db <span style="color: #666666">=</span> botex_db, 
</span><span id="__span-0-774"><a id="__codelineno-0-774" name="__codelineno-0-774"></a>                session_id <span style="color: #666666">=</span> session_id, 
</span><span id="__span-0-775"><a id="__codelineno-0-775" name="__codelineno-0-775"></a>                url <span style="color: #666666">=</span> url, 
</span><span id="__span-0-776"><a id="__codelineno-0-776" name="__codelineno-0-776"></a>                model <span style="color: #666666">=</span> model, 
</span><span id="__span-0-777"><a id="__codelineno-0-777" name="__codelineno-0-777"></a>                throttle <span style="color: #666666">=</span> throttle, 
</span><span id="__span-0-778"><a id="__codelineno-0-778" name="__codelineno-0-778"></a>                full_conv_history <span style="color: #666666">=</span> full_conv_history,
</span><span id="__span-0-779"><a id="__codelineno-0-779" name="__codelineno-0-779"></a>                user_prompts <span style="color: #666666">=</span> user_prompts,
</span><span id="__span-0-780"><a id="__codelineno-0-780" name="__codelineno-0-780"></a>                <span style="color: #666666">**</span>kwargs
</span><span id="__span-0-781"><a id="__codelineno-0-781" name="__codelineno-0-781"></a>            )
</span><span id="__span-0-782"><a id="__codelineno-0-782" name="__codelineno-0-782"></a>        )
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="python-api-export-data">Python API: Export data</h2>
<p>Running oTree experiments with botex generates two data sources:</p>
<ol>
<li>The 'normal' experiment data that oTree collects.</li>
<li>Additional data that botex collects, such as the prompting sequence between botex and the bots, as well as the answers and the reasoning behind the answers that the LLM bots provide.</li>
</ol>
<p>botex provides functions to export these data from the botex and oTree databases. In addition, the function <code>normalize_otree_data()</code> can be used to re-organize the wide multi-app oTree data into a normalized format that is more convenient for downstream use.</p>
<h3 id="read_participants_from_botex_db"><code>read_participants_from_botex_db</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Read the participants table from the botex database and return it as a list 
of dicts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A session ID to filter the results.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of a SQLite database file. If not 
provided, it will try to read the file name from the environment 
variable BOTEX_DB.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries with participant data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/botex_db.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-56">56</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-57">57</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-58">58</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-59">59</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-60">60</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-61">61</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-62">62</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-63">63</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-64">64</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-65">65</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-66">66</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-67">67</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-68">68</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-69">69</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-70">70</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-71">71</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-72">72</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-73">73</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-74">74</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-75">75</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-76">76</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-77">77</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-78">78</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-79">79</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-80">80</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-81">81</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-82">82</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-83">83</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">read_participants_from_botex_db</span>(session_id <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, botex_db <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> List[Dict]:
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span style="color: #4070a0; font-style: italic">    Read the participants table from the botex database and return it as a list </span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span style="color: #4070a0; font-style: italic">    of dicts.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span style="color: #4070a0; font-style: italic">        session_id (str, optional): A session ID to filter the results.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span style="color: #4070a0; font-style: italic">        botex_db (str, optional): The name of a SQLite database file. If not </span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span style="color: #4070a0; font-style: italic">            provided, it will try to read the file name from the environment </span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span style="color: #4070a0; font-style: italic">            variable BOTEX_DB.</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span style="color: #4070a0; font-style: italic">        A list of dictionaries with participant data.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span style="color: #007020; font-weight: bold">if</span> botex_db <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: botex_db <span style="color: #666666">=</span> environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;BOTEX_DB&#39;</span>)
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    conn <span style="color: #666666">=</span> sqlite3<span style="color: #666666">.</span>connect(botex_db)
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>    conn<span style="color: #666666">.</span>row_factory <span style="color: #666666">=</span> sqlite3<span style="color: #666666">.</span>Row 
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    cursor <span style="color: #666666">=</span> conn<span style="color: #666666">.</span>cursor()
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span style="color: #007020; font-weight: bold">if</span> session_id:
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        cursor<span style="color: #666666">.</span>execute(
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span style="color: #4070a0">&quot;SELECT * FROM participants WHERE session_id = ?&quot;</span>, (session_id,)
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        )
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        cursor<span style="color: #666666">.</span>execute(<span style="color: #4070a0">&quot;SELECT * FROM participants&quot;</span>)
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    sessions <span style="color: #666666">=</span> [<span style="color: #007020">dict</span>(row) <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> cursor<span style="color: #666666">.</span>fetchall()]
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    cursor<span style="color: #666666">.</span>close()
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    conn<span style="color: #666666">.</span>close()
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span style="color: #007020; font-weight: bold">return</span> sessions
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="read_conversations_from_botex_db"><code>read_conversations_from_botex_db</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Reads the conversations table from the botex database. 
The conversation table contains the messages exchanged 
with the LLM underlying the bot. Each conversation is
returned as a dictionary containing a JSON string with the 
message sequence.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>participant_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Participant ID to filter the results.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of a SQLite database file.
If not provided, it will try to read the file name from
the environment variable BOTEX_DB.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A session ID to filter the results.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries with the conversation data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/botex_db.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-87"> 87</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-88"> 88</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-89"> 89</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-90"> 90</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-91"> 91</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-92"> 92</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-93"> 93</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-94"> 94</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-95"> 95</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-96"> 96</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-97"> 97</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-98"> 98</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-99"> 99</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-100">100</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-101">101</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-102">102</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-103">103</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-104">104</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-105">105</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-106">106</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-107">107</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-108">108</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-109">109</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-110">110</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-111">111</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-112">112</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-113">113</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-114">114</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-115">115</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-116">116</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-117">117</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-118">118</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-119">119</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-120">120</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-121">121</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-122">122</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-123">123</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-124">124</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-125">125</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">read_conversations_from_botex_db</span>(
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        participant_id <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, botex_db <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, session_id <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    ) <span style="color: #666666">-&gt;</span> List[Dict]:
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span style="color: #4070a0; font-style: italic">    Reads the conversations table from the botex database. </span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span style="color: #4070a0; font-style: italic">    The conversation table contains the messages exchanged </span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span style="color: #4070a0; font-style: italic">    with the LLM underlying the bot. Each conversation is</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span style="color: #4070a0; font-style: italic">    returned as a dictionary containing a JSON string with the </span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span style="color: #4070a0; font-style: italic">    message sequence.</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span style="color: #4070a0; font-style: italic">        participant_id (str, optional): A Participant ID to filter the results.</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span style="color: #4070a0; font-style: italic">        botex_db (str, optional): The name of a SQLite database file.</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span style="color: #4070a0; font-style: italic">            If not provided, it will try to read the file name from</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span style="color: #4070a0; font-style: italic">            the environment variable BOTEX_DB.</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span style="color: #4070a0; font-style: italic">        session_id (str, optional): A session ID to filter the results.</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span style="color: #4070a0; font-style: italic">        A list of dictionaries with the conversation data.</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span style="color: #007020; font-weight: bold">if</span> botex_db <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>: botex_db <span style="color: #666666">=</span> environ<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;BOTEX_DB&#39;</span>)
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    conn <span style="color: #666666">=</span> sqlite3<span style="color: #666666">.</span>connect(botex_db)
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>    conn<span style="color: #666666">.</span>row_factory <span style="color: #666666">=</span> sqlite3<span style="color: #666666">.</span>Row 
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>    cursor <span style="color: #666666">=</span> conn<span style="color: #666666">.</span>cursor()
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span style="color: #007020; font-weight: bold">if</span> participant_id:
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        cursor<span style="color: #666666">.</span>execute(
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span style="color: #4070a0">&quot;SELECT * FROM conversations WHERE id = ?&quot;</span>, (participant_id,)
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>        )
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>        cursor<span style="color: #666666">.</span>execute(<span style="color: #4070a0">&quot;SELECT * FROM conversations&quot;</span>)
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>    conversations <span style="color: #666666">=</span> [<span style="color: #007020">dict</span>(row) <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> cursor<span style="color: #666666">.</span>fetchall()]
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span style="color: #007020; font-weight: bold">if</span> session_id:
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        conversations <span style="color: #666666">=</span> [
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>            c <span style="color: #007020; font-weight: bold">for</span> c <span style="color: #007020; font-weight: bold">in</span> conversations 
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span style="color: #007020; font-weight: bold">if</span> json<span style="color: #666666">.</span>loads(c[<span style="color: #4070a0">&#39;bot_parms&#39;</span>])[<span style="color: #4070a0">&#39;session_id&#39;</span>] <span style="color: #666666">==</span> session_id
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>        ]
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>    cursor<span style="color: #666666">.</span>close()
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>    conn<span style="color: #666666">.</span>close()
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span style="color: #007020; font-weight: bold">return</span> conversations
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="read_responses_from_botex_db"><code>read_responses_from_botex_db</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Extracts the responses and their rationales from the botex conversation data
and returns them as a list of dicts. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of a SQLite database file.
If not provided, it will try to read the file name from
the environment variable BOTEX_DB.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A session ID to filter the results.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries with the rationale data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/botex_db.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-127">127</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-128">128</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-129">129</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-130">130</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-131">131</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-132">132</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-133">133</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-134">134</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-135">135</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-136">136</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-137">137</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-138">138</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-139">139</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-140">140</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-141">141</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-142">142</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-143">143</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-144">144</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-145">145</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-146">146</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-147">147</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-148">148</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-149">149</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-150">150</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-151">151</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-152">152</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-153">153</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-154">154</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-155">155</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-156">156</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-157">157</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">read_responses_from_botex_db</span>(botex_db <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, session_id <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> List[Dict]:
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span style="color: #4070a0; font-style: italic">    Extracts the responses and their rationales from the botex conversation data</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span style="color: #4070a0; font-style: italic">    and returns them as a list of dicts. </span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span style="color: #4070a0; font-style: italic">    Parameters:</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span style="color: #4070a0; font-style: italic">        botex_db (str, optional): The name of a SQLite database file.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span style="color: #4070a0; font-style: italic">            If not provided, it will try to read the file name from</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span style="color: #4070a0; font-style: italic">            the environment variable BOTEX_DB.</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span style="color: #4070a0; font-style: italic">        session_id (str, optional): A session ID to filter the results.</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span style="color: #4070a0; font-style: italic">        A list of dictionaries with the rationale data.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    cs <span style="color: #666666">=</span> read_conversations_from_botex_db(botex_db <span style="color: #666666">=</span> botex_db, session_id <span style="color: #666666">=</span> session_id)
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>    resp <span style="color: #666666">=</span> [parse_conversation(c) <span style="color: #007020; font-weight: bold">for</span> c <span style="color: #007020; font-weight: bold">in</span> cs]
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    rt <span style="color: #666666">=</span> []
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span style="color: #007020; font-weight: bold">for</span> r <span style="color: #007020; font-weight: bold">in</span> resp:
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span style="color: #007020; font-weight: bold">for</span> answer_dict <span style="color: #007020; font-weight: bold">in</span> r[<span style="color: #4070a0">&#39;answers&#39;</span>]:
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span style="color: #007020; font-weight: bold">for</span> id_, a <span style="color: #007020; font-weight: bold">in</span> answer_dict<span style="color: #666666">.</span>items():
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span style="color: #007020; font-weight: bold">if</span> id_ <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;round&#39;</span>: <span style="color: #007020; font-weight: bold">continue</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>                rt<span style="color: #666666">.</span>append({
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>                    <span style="color: #4070a0">&#39;session_id&#39;</span>: r[<span style="color: #4070a0">&#39;session_id&#39;</span>], 
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>                    <span style="color: #4070a0">&#39;participant_id&#39;</span>: r[<span style="color: #4070a0">&#39;participant_id&#39;</span>], 
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>                    <span style="color: #4070a0">&#39;round&#39;</span>: answer_dict[<span style="color: #4070a0">&#39;round&#39;</span>], 
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span style="color: #4070a0">&#39;question_id&#39;</span>: id_, 
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>                    <span style="color: #4070a0">&#39;answer&#39;</span>: a[<span style="color: #4070a0">&#39;answer&#39;</span>], 
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>                    <span style="color: #4070a0">&#39;reason&#39;</span>: a[<span style="color: #4070a0">&#39;reason&#39;</span>]
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>                })
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span style="color: #007020; font-weight: bold">return</span> rt
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="export_participant_data"><code>export_participant_data</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Export the participants table from the botex database, retrieved by calling
<code>read_participants_from_botex_db()</code>, to a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to save the CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to the botex sqlite3 file. 
If not provided, it will try to read the file name from
the environment variable BOTEX_DB.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A session ID to filter the results.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None (saves the CSV to the specified file path)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/botex_db.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-161">161</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-162">162</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-163">163</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-164">164</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-165">165</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-166">166</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-167">167</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-168">168</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-169">169</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-170">170</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-171">171</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-172">172</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-173">173</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-174">174</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-175">175</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-176">176</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-177">177</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-178">178</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-179">179</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-180">180</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-181">181</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-182">182</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">export_participant_data</span>(csv_file, botex_db <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, session_id <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span style="color: #4070a0; font-style: italic">    Export the participants table from the botex database, retrieved by calling</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span style="color: #4070a0; font-style: italic">    `read_participants_from_botex_db()`, to a CSV file.</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span style="color: #4070a0; font-style: italic">    Parameters:</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span style="color: #4070a0; font-style: italic">        csv_file (str): The file path to save the CSV file.</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span style="color: #4070a0; font-style: italic">        botex_db (str, optional): The file path to the botex sqlite3 file. </span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span style="color: #4070a0; font-style: italic">            If not provided, it will try to read the file name from</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span style="color: #4070a0; font-style: italic">            the environment variable BOTEX_DB.</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><span style="color: #4070a0; font-style: italic">        session_id (str, optional): A session ID to filter the results.</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span style="color: #4070a0; font-style: italic">        None (saves the CSV to the specified file path)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>    p <span style="color: #666666">=</span> read_participants_from_botex_db(
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>        session_id <span style="color: #666666">=</span> session_id, botex_db <span style="color: #666666">=</span> botex_db
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>    )
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span style="color: #007020; font-weight: bold">with</span> <span style="color: #007020">open</span>(csv_file, <span style="color: #4070a0">&#39;w&#39;</span>, newline<span style="color: #666666">=</span><span style="color: #4070a0">&#39;&#39;</span>) <span style="color: #007020; font-weight: bold">as</span> f:
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>        w <span style="color: #666666">=</span> csv<span style="color: #666666">.</span>DictWriter(f, p[<span style="color: #40a070">0</span>]<span style="color: #666666">.</span>keys())
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>        w<span style="color: #666666">.</span>writeheader()
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>        w<span style="color: #666666">.</span>writerows(p)
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="export_response_data"><code>export_response_data</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Export the responses parsed from the bot conversations in the botex
database, retrieved by calling <code>read_responses_from_botex_db()</code>, 
to a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to save the CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>botex_db</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to the botex sqlite3 file. 
If not provided, it will try to read the file name from
the environment variable BOTEX_DB.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A session ID to filter the results.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None (saves the CSV to the specified file path)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/botex/botex_db.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-186">186</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-187">187</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-188">188</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-189">189</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-190">190</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-191">191</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-192">192</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-193">193</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-194">194</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-195">195</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-196">196</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-197">197</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-198">198</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-199">199</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-200">200</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-201">201</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-202">202</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-203">203</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-204">204</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-205">205</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-206">206</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">export_response_data</span>(csv_file, botex_db <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, session_id <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span style="color: #4070a0; font-style: italic">    Export the responses parsed from the bot conversations in the botex</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span style="color: #4070a0; font-style: italic">    database, retrieved by calling `read_responses_from_botex_db()`, </span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span style="color: #4070a0; font-style: italic">    to a CSV file.</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span style="color: #4070a0; font-style: italic">    Parameters:</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span style="color: #4070a0; font-style: italic">        csv_file (str): The file path to save the CSV file.</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span style="color: #4070a0; font-style: italic">        botex_db (str, optional): The file path to the botex sqlite3 file. </span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span style="color: #4070a0; font-style: italic">            If not provided, it will try to read the file name from</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span style="color: #4070a0; font-style: italic">            the environment variable BOTEX_DB.</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span style="color: #4070a0; font-style: italic">        session_id (str, optional): A session ID to filter the results.</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span style="color: #4070a0; font-style: italic">        None (saves the CSV to the specified file path)</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>    r <span style="color: #666666">=</span> read_responses_from_botex_db(botex_db <span style="color: #666666">=</span> botex_db, session_id <span style="color: #666666">=</span> session_id)
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span style="color: #007020; font-weight: bold">with</span> <span style="color: #007020">open</span>(csv_file, <span style="color: #4070a0">&#39;w&#39;</span>, newline<span style="color: #666666">=</span><span style="color: #4070a0">&#39;&#39;</span>) <span style="color: #007020; font-weight: bold">as</span> f:
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>        w <span style="color: #666666">=</span> csv<span style="color: #666666">.</span>DictWriter(f, r[<span style="color: #40a070">0</span>]<span style="color: #666666">.</span>keys())
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>        w<span style="color: #666666">.</span>writeheader()
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>        w<span style="color: #666666">.</span>writerows(r)
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="export_otree_data"><code>export_otree_data</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Export wide data from an oTree server.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the CSV file where the data should be stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>server_url</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL of the oTree server. If None 
(the default), the function will try to use the oTree server URL 
from the environment variable OTREE_SERVER_URL.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>admin_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Admin username. Defaults to "admin".</p>
              </div>
            </td>
            <td>
                  <code>&#39;admin&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>admin_password</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Admin password. If None (the default),
the function will try to use the oTree admin password from the 
environment variable OTREE_ADMIN_PASSWORD.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_out</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeout in seconds to wait for the download. 
Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the download does not succeed within the timeout.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns
    None (data is stored in the CSV file).</p>


<details class="detail" open>
  <summary>Detail</summary>
  <p>The function uses Selenium and a headless Chrome browser to download 
the CSV file. Ideally, it would use an oTree API endpoint instead.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-785">785</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-786">786</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-787">787</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-788">788</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-789">789</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-790">790</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-791">791</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-792">792</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-793">793</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-794">794</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-795">795</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-796">796</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-797">797</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-798">798</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-799">799</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-800">800</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-801">801</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-802">802</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-803">803</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-804">804</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-805">805</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-806">806</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-807">807</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-808">808</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-809">809</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-810">810</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-811">811</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-812">812</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-813">813</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-814">814</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-815">815</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-816">816</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-817">817</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-818">818</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-819">819</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-820">820</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-821">821</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-822">822</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-823">823</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-824">824</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-825">825</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-826">826</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-827">827</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-828">828</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-829">829</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-830">830</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-831">831</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-832">832</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-833">833</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-834">834</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-835">835</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-836">836</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-837">837</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-838">838</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-839">839</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-840">840</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-841">841</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-842">842</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-843">843</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-844">844</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-845">845</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-846">846</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-847">847</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-848">848</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-849">849</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-850">850</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-851">851</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-852">852</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-853">853</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-854">854</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-855">855</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-856">856</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-857">857</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-858">858</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-859">859</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-860">860</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-861">861</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-862">862</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-863">863</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-864">864</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-865">865</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-866">866</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-867">867</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-785"><a id="__codelineno-0-785" name="__codelineno-0-785"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">export_otree_data</span>(
</span><span id="__span-0-786"><a id="__codelineno-0-786" name="__codelineno-0-786"></a>        csv_file: <span style="color: #007020">str</span>,
</span><span id="__span-0-787"><a id="__codelineno-0-787" name="__codelineno-0-787"></a>        server_url: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>, 
</span><span id="__span-0-788"><a id="__codelineno-0-788" name="__codelineno-0-788"></a>        admin_name: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&quot;admin&quot;</span>, 
</span><span id="__span-0-789"><a id="__codelineno-0-789" name="__codelineno-0-789"></a>        admin_password: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>,
</span><span id="__span-0-790"><a id="__codelineno-0-790" name="__codelineno-0-790"></a>        time_out: <span style="color: #007020">int</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #40a070">10</span>
</span><span id="__span-0-791"><a id="__codelineno-0-791" name="__codelineno-0-791"></a>    ) <span style="color: #666666">-&gt;</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-792"><a id="__codelineno-0-792" name="__codelineno-0-792"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-793"><a id="__codelineno-0-793" name="__codelineno-0-793"></a><span style="color: #4070a0; font-style: italic">    Export wide data from an oTree server.</span>
</span><span id="__span-0-794"><a id="__codelineno-0-794" name="__codelineno-0-794"></a>
</span><span id="__span-0-795"><a id="__codelineno-0-795" name="__codelineno-0-795"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-796"><a id="__codelineno-0-796" name="__codelineno-0-796"></a><span style="color: #4070a0; font-style: italic">        csv_file (str): Path to the CSV file where the data should be stored.</span>
</span><span id="__span-0-797"><a id="__codelineno-0-797" name="__codelineno-0-797"></a><span style="color: #4070a0; font-style: italic">        server_url (str, optional): URL of the oTree server. If None </span>
</span><span id="__span-0-798"><a id="__codelineno-0-798" name="__codelineno-0-798"></a><span style="color: #4070a0; font-style: italic">            (the default), the function will try to use the oTree server URL </span>
</span><span id="__span-0-799"><a id="__codelineno-0-799" name="__codelineno-0-799"></a><span style="color: #4070a0; font-style: italic">            from the environment variable OTREE_SERVER_URL.</span>
</span><span id="__span-0-800"><a id="__codelineno-0-800" name="__codelineno-0-800"></a><span style="color: #4070a0; font-style: italic">        admin_name (str, optional): Admin username. Defaults to &quot;admin&quot;.</span>
</span><span id="__span-0-801"><a id="__codelineno-0-801" name="__codelineno-0-801"></a><span style="color: #4070a0; font-style: italic">        admin_password (str, optional): Admin password. If None (the default),</span>
</span><span id="__span-0-802"><a id="__codelineno-0-802" name="__codelineno-0-802"></a><span style="color: #4070a0; font-style: italic">            the function will try to use the oTree admin password from the </span>
</span><span id="__span-0-803"><a id="__codelineno-0-803" name="__codelineno-0-803"></a><span style="color: #4070a0; font-style: italic">            environment variable OTREE_ADMIN_PASSWORD.</span>
</span><span id="__span-0-804"><a id="__codelineno-0-804" name="__codelineno-0-804"></a><span style="color: #4070a0; font-style: italic">        time_out (int, optional): Timeout in seconds to wait for the download. </span>
</span><span id="__span-0-805"><a id="__codelineno-0-805" name="__codelineno-0-805"></a><span style="color: #4070a0; font-style: italic">            Defaults to 10.</span>
</span><span id="__span-0-806"><a id="__codelineno-0-806" name="__codelineno-0-806"></a>
</span><span id="__span-0-807"><a id="__codelineno-0-807" name="__codelineno-0-807"></a><span style="color: #4070a0; font-style: italic">    Raises:</span>
</span><span id="__span-0-808"><a id="__codelineno-0-808" name="__codelineno-0-808"></a><span style="color: #4070a0; font-style: italic">        Exception: If the download does not succeed within the timeout.</span>
</span><span id="__span-0-809"><a id="__codelineno-0-809" name="__codelineno-0-809"></a>
</span><span id="__span-0-810"><a id="__codelineno-0-810" name="__codelineno-0-810"></a><span style="color: #4070a0; font-style: italic">    Returns</span>
</span><span id="__span-0-811"><a id="__codelineno-0-811" name="__codelineno-0-811"></a><span style="color: #4070a0; font-style: italic">        None (data is stored in the CSV file).</span>
</span><span id="__span-0-812"><a id="__codelineno-0-812" name="__codelineno-0-812"></a>
</span><span id="__span-0-813"><a id="__codelineno-0-813" name="__codelineno-0-813"></a><span style="color: #4070a0; font-style: italic">    Detail:</span>
</span><span id="__span-0-814"><a id="__codelineno-0-814" name="__codelineno-0-814"></a><span style="color: #4070a0; font-style: italic">        The function uses Selenium and a headless Chrome browser to download </span>
</span><span id="__span-0-815"><a id="__codelineno-0-815" name="__codelineno-0-815"></a><span style="color: #4070a0; font-style: italic">        the CSV file. Ideally, it would use an oTree API endpoint instead.</span>
</span><span id="__span-0-816"><a id="__codelineno-0-816" name="__codelineno-0-816"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-817"><a id="__codelineno-0-817" name="__codelineno-0-817"></a>
</span><span id="__span-0-818"><a id="__codelineno-0-818" name="__codelineno-0-818"></a>    chrome_options <span style="color: #666666">=</span> Options()
</span><span id="__span-0-819"><a id="__codelineno-0-819" name="__codelineno-0-819"></a>    chrome_options<span style="color: #666666">.</span>add_argument(<span style="color: #4070a0">&quot;--headless&quot;</span>)
</span><span id="__span-0-820"><a id="__codelineno-0-820" name="__codelineno-0-820"></a>    chrome_options<span style="color: #666666">.</span>add_argument(<span style="color: #4070a0">&quot;--disable-gpu&quot;</span>)
</span><span id="__span-0-821"><a id="__codelineno-0-821" name="__codelineno-0-821"></a>    chrome_options<span style="color: #666666">.</span>add_argument(<span style="color: #4070a0">&quot;--no-sandbox&quot;</span>)
</span><span id="__span-0-822"><a id="__codelineno-0-822" name="__codelineno-0-822"></a>    chrome_options<span style="color: #666666">.</span>add_argument(<span style="color: #4070a0">&quot;--disable-dev-shm-usage&quot;</span>)
</span><span id="__span-0-823"><a id="__codelineno-0-823" name="__codelineno-0-823"></a>    chrome_options<span style="color: #666666">.</span>add_argument(<span style="color: #4070a0">&quot;--log-level=3&quot;</span>)
</span><span id="__span-0-824"><a id="__codelineno-0-824" name="__codelineno-0-824"></a>    chrome_options<span style="color: #666666">.</span>add_experimental_option(<span style="color: #4070a0">&#39;excludeSwitches&#39;</span>, [<span style="color: #4070a0">&#39;enable-logging&#39;</span>])
</span><span id="__span-0-825"><a id="__codelineno-0-825" name="__codelineno-0-825"></a>
</span><span id="__span-0-826"><a id="__codelineno-0-826" name="__codelineno-0-826"></a>    <span style="color: #007020; font-weight: bold">with</span> tempfile<span style="color: #666666">.</span>TemporaryDirectory() <span style="color: #007020; font-weight: bold">as</span> tmp_dir:
</span><span id="__span-0-827"><a id="__codelineno-0-827" name="__codelineno-0-827"></a>        prefs <span style="color: #666666">=</span> {<span style="color: #4070a0">&quot;download.default_directory&quot;</span>: tmp_dir}
</span><span id="__span-0-828"><a id="__codelineno-0-828" name="__codelineno-0-828"></a>        chrome_options<span style="color: #666666">.</span>add_experimental_option(<span style="color: #4070a0">&quot;prefs&quot;</span>, prefs)
</span><span id="__span-0-829"><a id="__codelineno-0-829" name="__codelineno-0-829"></a>        driver <span style="color: #666666">=</span> webdriver<span style="color: #666666">.</span>Chrome(options<span style="color: #666666">=</span>chrome_options)
</span><span id="__span-0-830"><a id="__codelineno-0-830" name="__codelineno-0-830"></a>        driver<span style="color: #666666">.</span>set_window_size(<span style="color: #40a070">1920</span>, <span style="color: #40a070">1400</span>)
</span><span id="__span-0-831"><a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span style="color: #007020; font-weight: bold">if</span> server_url <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-832"><a id="__codelineno-0-832" name="__codelineno-0-832"></a>            server_url <span style="color: #666666">=</span> os<span style="color: #666666">.</span>getenv(<span style="color: #4070a0">&quot;OTREE_SERVER_URL&quot;</span>)
</span><span id="__span-0-833"><a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span style="color: #007020; font-weight: bold">if</span> admin_password <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-834"><a id="__codelineno-0-834" name="__codelineno-0-834"></a>            admin_password <span style="color: #666666">=</span> os<span style="color: #666666">.</span>getenv(<span style="color: #4070a0">&quot;OTREE_ADMIN_PASSWORD&quot;</span>)
</span><span id="__span-0-835"><a id="__codelineno-0-835" name="__codelineno-0-835"></a>
</span><span id="__span-0-836"><a id="__codelineno-0-836" name="__codelineno-0-836"></a>        export_url <span style="color: #666666">=</span> <span style="color: #4070a0">f&quot;</span><span style="color: #70a0d0; font-style: italic">{</span>server_url<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">/export&quot;</span>
</span><span id="__span-0-837"><a id="__codelineno-0-837" name="__codelineno-0-837"></a>        driver<span style="color: #666666">.</span>get(export_url)
</span><span id="__span-0-838"><a id="__codelineno-0-838" name="__codelineno-0-838"></a>        current_url <span style="color: #666666">=</span> driver<span style="color: #666666">.</span>current_url
</span><span id="__span-0-839"><a id="__codelineno-0-839" name="__codelineno-0-839"></a>        <span style="color: #007020; font-weight: bold">if</span> <span style="color: #4070a0">&quot;login&quot;</span> <span style="color: #007020; font-weight: bold">in</span> current_url:
</span><span id="__span-0-840"><a id="__codelineno-0-840" name="__codelineno-0-840"></a>            driver<span style="color: #666666">.</span>find_element(By<span style="color: #666666">.</span>ID, <span style="color: #4070a0">&quot;id_username&quot;</span>)<span style="color: #666666">.</span>send_keys(admin_name)
</span><span id="__span-0-841"><a id="__codelineno-0-841" name="__codelineno-0-841"></a>            driver<span style="color: #666666">.</span>find_element(By<span style="color: #666666">.</span>ID, <span style="color: #4070a0">&quot;id_password&quot;</span>)<span style="color: #666666">.</span>send_keys(admin_password)
</span><span id="__span-0-842"><a id="__codelineno-0-842" name="__codelineno-0-842"></a>            submit_button <span style="color: #666666">=</span> WebDriverWait(driver, <span style="color: #40a070">10</span>)<span style="color: #666666">.</span>until(
</span><span id="__span-0-843"><a id="__codelineno-0-843" name="__codelineno-0-843"></a>                EC<span style="color: #666666">.</span>element_to_be_clickable((By<span style="color: #666666">.</span>ID, <span style="color: #4070a0">&quot;btn-login&quot;</span>))
</span><span id="__span-0-844"><a id="__codelineno-0-844" name="__codelineno-0-844"></a>            )
</span><span id="__span-0-845"><a id="__codelineno-0-845" name="__codelineno-0-845"></a>            submit_button<span style="color: #666666">.</span>click()
</span><span id="__span-0-846"><a id="__codelineno-0-846" name="__codelineno-0-846"></a>            WebDriverWait(driver, <span style="color: #40a070">10</span>)<span style="color: #666666">.</span>until(EC<span style="color: #666666">.</span>url_changes(current_url))
</span><span id="__span-0-847"><a id="__codelineno-0-847" name="__codelineno-0-847"></a>            driver<span style="color: #666666">.</span>get(export_url)
</span><span id="__span-0-848"><a id="__codelineno-0-848" name="__codelineno-0-848"></a>
</span><span id="__span-0-849"><a id="__codelineno-0-849" name="__codelineno-0-849"></a>        download_link <span style="color: #666666">=</span> WebDriverWait(driver, <span style="color: #40a070">10</span>)<span style="color: #666666">.</span>until(
</span><span id="__span-0-850"><a id="__codelineno-0-850" name="__codelineno-0-850"></a>            EC<span style="color: #666666">.</span>element_to_be_clickable((By<span style="color: #666666">.</span>ID, <span style="color: #4070a0">&quot;wide-csv&quot;</span>))
</span><span id="__span-0-851"><a id="__codelineno-0-851" name="__codelineno-0-851"></a>        )
</span><span id="__span-0-852"><a id="__codelineno-0-852" name="__codelineno-0-852"></a>        driver<span style="color: #666666">.</span>execute_script(<span style="color: #4070a0">&quot;arguments[0].scrollIntoView(true)&quot;</span>, download_link)
</span><span id="__span-0-853"><a id="__codelineno-0-853" name="__codelineno-0-853"></a>        download_link<span style="color: #666666">.</span>click()
</span><span id="__span-0-854"><a id="__codelineno-0-854" name="__codelineno-0-854"></a>
</span><span id="__span-0-855"><a id="__codelineno-0-855" name="__codelineno-0-855"></a>        time_out <span style="color: #666666">=</span> time<span style="color: #666666">.</span>time() <span style="color: #666666">+</span> time_out
</span><span id="__span-0-856"><a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span style="color: #007020; font-weight: bold">while</span> <span style="color: #007020; font-weight: bold">True</span>:            
</span><span id="__span-0-857"><a id="__codelineno-0-857" name="__codelineno-0-857"></a>            time<span style="color: #666666">.</span>sleep(<span style="color: #40a070">1</span>)
</span><span id="__span-0-858"><a id="__codelineno-0-858" name="__codelineno-0-858"></a>            csv_files <span style="color: #666666">=</span> [f <span style="color: #007020; font-weight: bold">for</span> f <span style="color: #007020; font-weight: bold">in</span> os<span style="color: #666666">.</span>listdir(tmp_dir) <span style="color: #007020; font-weight: bold">if</span> f<span style="color: #666666">.</span>endswith(<span style="color: #4070a0">&quot;.csv&quot;</span>)]
</span><span id="__span-0-859"><a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020">len</span>(csv_files) <span style="color: #666666">==</span> <span style="color: #40a070">1</span>:
</span><span id="__span-0-860"><a id="__codelineno-0-860" name="__codelineno-0-860"></a>                shutil<span style="color: #666666">.</span>move(<span style="color: #4070a0">f&quot;</span><span style="color: #70a0d0; font-style: italic">{</span>tmp_dir<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">/</span><span style="color: #70a0d0; font-style: italic">{</span>csv_files[<span style="color: #40a070">0</span>]<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&quot;</span>, csv_file)
</span><span id="__span-0-861"><a id="__codelineno-0-861" name="__codelineno-0-861"></a>                logger<span style="color: #666666">.</span>info(<span style="color: #4070a0">&quot;oTree CSV file downloaded.&quot;</span>)
</span><span id="__span-0-862"><a id="__codelineno-0-862" name="__codelineno-0-862"></a>                <span style="color: #007020; font-weight: bold">break</span>
</span><span id="__span-0-863"><a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-864"><a id="__codelineno-0-864" name="__codelineno-0-864"></a>                <span style="color: #007020; font-weight: bold">if</span> time<span style="color: #666666">.</span>time() <span style="color: #666666">&gt;</span> time_out:
</span><span id="__span-0-865"><a id="__codelineno-0-865" name="__codelineno-0-865"></a>                    logger<span style="color: #666666">.</span>error(<span style="color: #4070a0">&quot;oTree CSV file download failed.&quot;</span>)
</span><span id="__span-0-866"><a id="__codelineno-0-866" name="__codelineno-0-866"></a>                    <span style="color: #007020; font-weight: bold">break</span>
</span><span id="__span-0-867"><a id="__codelineno-0-867" name="__codelineno-0-867"></a>        driver<span style="color: #666666">.</span>quit()
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="normalize_otree_data"><code>normalize_otree_data</code></h3>


<div class="doc doc-object doc-function">




    <div class="doc doc-contents first">

        <p>Normalize oTree data from wide to long format, then reshape it into a set 
of list-of-dicts structures. Optionally save it to a set of CSV files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>otree_csv_file</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a wide multi app oTree CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var_dict</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dict to customize the exported data. See
detail section.</p>
              </div>
            </td>
            <td>
                  <code>{&#39;participant&#39;: {&#39;code&#39;: &#39;participant_code&#39;, &#39;time_started_utc&#39;: &#39;time_started_utc&#39;, &#39;_current_app_name&#39;: &#39;current_app&#39;, &#39;_current_page_name&#39;: &#39;current_page&#39;}, &#39;session&#39;: {&#39;code&#39;: &#39;session_code&#39;}}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>store_as_csv</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to store the normalized data as
CSV files. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_exp_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder where the normalized
CSV files should be stored. Defaults to '.' (current folder).</p>
              </div>
            </td>
            <td>
                  <code>&#39;.&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exp_prefix</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prefix to be used for the CSV file names. 
Defaults to '' (no prefix).</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dict whose keys are table names (e.g. 'session', 'participant', 
'myapp_group', 'myapp_player', etc.) and whose values are lists of 
dictionaries (i.e., row data).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <details class="tip">
<summary>Additional details</summary>
<p>The var_dict parameter is a dictionary that allows to customize the
exported data. The keys of the dictionary are the names of the oTree
apps. The values are dictionaries that map the original column names to
the desired column names. The keys of these inner dictionaries are the
original column names and the values are the desired column names. All
variables that are not included in the dict are omitted from the output.
The 'participant' and 'session' keys are reserved for the participant 
and session data, respectively.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/botex/otree.py</code></summary>
              <div class="language-python highlight" style="background: #f0f0f0"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-870"> 870</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-871"> 871</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-872"> 872</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-873"> 873</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-874"> 874</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-875"> 875</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-876"> 876</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-877"> 877</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-878"> 878</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-879"> 879</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-880"> 880</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-881"> 881</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-882"> 882</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-883"> 883</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-884"> 884</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-885"> 885</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-886"> 886</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-887"> 887</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-888"> 888</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-889"> 889</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-890"> 890</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-891"> 891</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-892"> 892</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-893"> 893</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-894"> 894</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-895"> 895</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-896"> 896</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-897"> 897</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-898"> 898</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-899"> 899</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-900"> 900</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-901"> 901</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-902"> 902</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-903"> 903</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-904"> 904</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-905"> 905</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-906"> 906</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-907"> 907</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-908"> 908</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-909"> 909</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-910"> 910</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-911"> 911</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-912"> 912</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-913"> 913</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-914"> 914</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-915"> 915</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-916"> 916</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-917"> 917</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-918"> 918</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-919"> 919</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-920"> 920</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-921"> 921</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-922"> 922</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-923"> 923</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-924"> 924</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-925"> 925</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-926"> 926</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-927"> 927</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-928"> 928</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-929"> 929</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-930"> 930</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-931"> 931</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-932"> 932</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-933"> 933</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-934"> 934</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-935"> 935</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-936"> 936</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-937"> 937</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-938"> 938</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-939"> 939</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-940"> 940</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-941"> 941</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-942"> 942</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-943"> 943</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-944"> 944</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-945"> 945</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-946"> 946</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-947"> 947</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-948"> 948</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-949"> 949</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-950"> 950</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-951"> 951</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-952"> 952</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-953"> 953</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-954"> 954</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-955"> 955</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-956"> 956</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-957"> 957</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-958"> 958</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-959"> 959</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-960"> 960</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-961"> 961</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-962"> 962</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-963"> 963</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-964"> 964</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-965"> 965</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-966"> 966</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-967"> 967</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-968"> 968</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-969"> 969</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-970"> 970</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-971"> 971</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-972"> 972</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-973"> 973</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-974"> 974</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-975"> 975</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-976"> 976</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-977"> 977</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-978"> 978</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-979"> 979</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-980"> 980</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-981"> 981</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-982"> 982</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-983"> 983</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-984"> 984</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-985"> 985</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-986"> 986</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-987"> 987</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-988"> 988</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-989"> 989</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-990"> 990</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-991"> 991</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-992"> 992</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-993"> 993</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-994"> 994</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-995"> 995</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-996"> 996</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-997"> 997</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-998"> 998</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-999"> 999</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1000">1000</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1001">1001</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1002">1002</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1003">1003</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1004">1004</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1005">1005</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1006">1006</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1007">1007</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1008">1008</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1009">1009</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1010">1010</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1011">1011</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1012">1012</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1013">1013</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1014">1014</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1015">1015</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1016">1016</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1017">1017</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1018">1018</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1019">1019</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1020">1020</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1021">1021</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1022">1022</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1023">1023</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1024">1024</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1025">1025</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1026">1026</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1027">1027</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1028">1028</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1029">1029</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1030">1030</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1031">1031</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1032">1032</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1033">1033</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1034">1034</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1035">1035</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1036">1036</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1037">1037</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1038">1038</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1039">1039</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1040">1040</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1041">1041</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1042">1042</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1043">1043</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1044">1044</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1045">1045</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1046">1046</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1047">1047</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1048">1048</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1049">1049</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1050">1050</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1051">1051</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1052">1052</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1053">1053</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1054">1054</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1055">1055</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1056">1056</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1057">1057</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1058">1058</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1059">1059</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1060">1060</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1061">1061</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1062">1062</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1063">1063</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1064">1064</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1065">1065</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1066">1066</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1067">1067</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1068">1068</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1069">1069</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1070">1070</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1071">1071</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1072">1072</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1073">1073</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1074">1074</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1075">1075</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1076">1076</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1077">1077</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1078">1078</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1079">1079</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1080">1080</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1081">1081</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1082">1082</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1083">1083</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1084">1084</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1085">1085</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1086">1086</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1087">1087</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1088">1088</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1089">1089</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1090">1090</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1091">1091</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1092">1092</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1093">1093</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1094">1094</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1095">1095</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1096">1096</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1097">1097</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1098">1098</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1099">1099</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1100">1100</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1101">1101</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1102">1102</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1103">1103</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1104">1104</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1105">1105</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1106">1106</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1107">1107</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1108">1108</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1109">1109</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1110">1110</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1111">1111</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1112">1112</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1113">1113</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1114">1114</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1115">1115</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1116">1116</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1117">1117</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1118">1118</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1119">1119</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1120">1120</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1121">1121</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1122">1122</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1123">1123</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1124">1124</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1125">1125</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1126">1126</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1127">1127</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1128">1128</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1129">1129</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1130">1130</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1131">1131</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1132">1132</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1133">1133</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1134">1134</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1135">1135</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1136">1136</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1137">1137</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1138">1138</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1139">1139</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1140">1140</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1141">1141</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1142">1142</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1143">1143</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1144">1144</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1145">1145</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1146">1146</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1147">1147</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1148">1148</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1149">1149</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1150">1150</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1151">1151</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1152">1152</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1153">1153</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1154">1154</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1155">1155</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1156">1156</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1157">1157</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1158">1158</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1159">1159</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1160">1160</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1161">1161</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1162">1162</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1163">1163</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1164">1164</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1165">1165</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1166">1166</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1167">1167</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1168">1168</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1169">1169</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1170">1170</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1171">1171</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1172">1172</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1173">1173</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1174">1174</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1175">1175</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1176">1176</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1177">1177</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1178">1178</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1179">1179</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1180">1180</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1181">1181</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1182">1182</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1183">1183</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1184">1184</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1185">1185</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1186">1186</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1187">1187</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1188">1188</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1189">1189</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1190">1190</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1191">1191</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1192">1192</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1193">1193</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1194">1194</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1195">1195</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1196">1196</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1197">1197</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1198">1198</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1199">1199</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1200">1200</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1201">1201</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1202">1202</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1203">1203</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1204">1204</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1205">1205</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1206">1206</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1207">1207</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1208">1208</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1209">1209</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1210">1210</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1211">1211</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1212">1212</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1213">1213</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1214">1214</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1215">1215</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1216">1216</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1217">1217</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1218">1218</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1219">1219</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1220">1220</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1221">1221</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1222">1222</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1223">1223</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1224">1224</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1225">1225</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1226">1226</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1227">1227</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1228">1228</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1229">1229</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1230">1230</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1231">1231</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1232">1232</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1233">1233</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1234">1234</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1235">1235</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1236">1236</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1237">1237</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1238">1238</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1239">1239</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1240">1240</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1241">1241</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1242">1242</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1243">1243</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1244">1244</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1245">1245</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1246">1246</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1247">1247</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1248">1248</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1249">1249</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1250">1250</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1251">1251</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1252">1252</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1253">1253</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1254">1254</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1255">1255</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1256">1256</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1257">1257</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1258">1258</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1259">1259</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1260">1260</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1261">1261</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1262">1262</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1263">1263</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1264">1264</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1265">1265</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1266">1266</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1267">1267</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1268">1268</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1269">1269</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1270">1270</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1271">1271</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1272">1272</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1273">1273</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1274">1274</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1275">1275</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1276">1276</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1277">1277</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1278">1278</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1279">1279</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1280">1280</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1281">1281</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1282">1282</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1283">1283</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1284">1284</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1285">1285</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1286">1286</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1287">1287</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1288">1288</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1289">1289</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1290">1290</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1291">1291</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1292">1292</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1293">1293</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1294">1294</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1295">1295</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1296">1296</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1297">1297</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1298">1298</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1299">1299</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1300">1300</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1301">1301</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1302">1302</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1303">1303</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1304">1304</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1305">1305</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1306">1306</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1307">1307</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1308">1308</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1309">1309</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1310">1310</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1311">1311</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1312">1312</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1313">1313</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1314">1314</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1315">1315</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1316">1316</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1317">1317</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1318">1318</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1319">1319</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1320">1320</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1321">1321</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1322">1322</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1323">1323</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1324">1324</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1325">1325</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1326">1326</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1327">1327</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1328">1328</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1329">1329</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1330">1330</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1331">1331</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1332">1332</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1333">1333</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1334">1334</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1335">1335</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1336">1336</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1337">1337</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1338">1338</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1339">1339</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1340">1340</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1341">1341</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1342">1342</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1343">1343</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1344">1344</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1345">1345</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1346">1346</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1347">1347</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1348">1348</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1349">1349</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1350">1350</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1351">1351</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1352">1352</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1353">1353</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1354">1354</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1355">1355</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1356">1356</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1357">1357</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1358">1358</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1359">1359</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1360">1360</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1361">1361</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1362">1362</a></span>
<span style="color: #666666; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1363">1363</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span id="__span-0-870"><a id="__codelineno-0-870" name="__codelineno-0-870"></a><span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">normalize_otree_data</span>(
</span><span id="__span-0-871"><a id="__codelineno-0-871" name="__codelineno-0-871"></a>    otree_csv_file: <span style="color: #007020">str</span>, 
</span><span id="__span-0-872"><a id="__codelineno-0-872" name="__codelineno-0-872"></a>    var_dict: <span style="color: #007020">dict</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> {
</span><span id="__span-0-873"><a id="__codelineno-0-873" name="__codelineno-0-873"></a>        <span style="color: #4070a0">&#39;participant&#39;</span>: {
</span><span id="__span-0-874"><a id="__codelineno-0-874" name="__codelineno-0-874"></a>            <span style="color: #4070a0">&#39;code&#39;</span>: <span style="color: #4070a0">&#39;participant_code&#39;</span>, 
</span><span id="__span-0-875"><a id="__codelineno-0-875" name="__codelineno-0-875"></a>            <span style="color: #4070a0">&#39;time_started_utc&#39;</span>: <span style="color: #4070a0">&#39;time_started_utc&#39;</span>,
</span><span id="__span-0-876"><a id="__codelineno-0-876" name="__codelineno-0-876"></a>            <span style="color: #4070a0">&#39;_current_app_name&#39;</span>: <span style="color: #4070a0">&#39;current_app&#39;</span>, 
</span><span id="__span-0-877"><a id="__codelineno-0-877" name="__codelineno-0-877"></a>            <span style="color: #4070a0">&#39;_current_page_name&#39;</span>: <span style="color: #4070a0">&#39;current_page&#39;</span>,
</span><span id="__span-0-878"><a id="__codelineno-0-878" name="__codelineno-0-878"></a>        },
</span><span id="__span-0-879"><a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span style="color: #4070a0">&#39;session&#39;</span>: {
</span><span id="__span-0-880"><a id="__codelineno-0-880" name="__codelineno-0-880"></a>            <span style="color: #4070a0">&#39;code&#39;</span>: <span style="color: #4070a0">&#39;session_code&#39;</span>
</span><span id="__span-0-881"><a id="__codelineno-0-881" name="__codelineno-0-881"></a>        }
</span><span id="__span-0-882"><a id="__codelineno-0-882" name="__codelineno-0-882"></a>    },
</span><span id="__span-0-883"><a id="__codelineno-0-883" name="__codelineno-0-883"></a>    store_as_csv: <span style="color: #007020">bool</span> <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>,
</span><span id="__span-0-884"><a id="__codelineno-0-884" name="__codelineno-0-884"></a>    data_exp_path: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&#39;.&#39;</span>, 
</span><span id="__span-0-885"><a id="__codelineno-0-885" name="__codelineno-0-885"></a>    exp_prefix: <span style="color: #007020">str</span> <span style="color: #666666">|</span> <span style="color: #007020; font-weight: bold">None</span> <span style="color: #666666">=</span> <span style="color: #4070a0">&#39;&#39;</span>,
</span><span id="__span-0-886"><a id="__codelineno-0-886" name="__codelineno-0-886"></a>) <span style="color: #666666">-&gt;</span> <span style="color: #007020">dict</span>:
</span><span id="__span-0-887"><a id="__codelineno-0-887" name="__codelineno-0-887"></a><span style="color: #bbbbbb">    </span><span style="color: #4070a0; font-style: italic">&quot;&quot;&quot;</span>
</span><span id="__span-0-888"><a id="__codelineno-0-888" name="__codelineno-0-888"></a><span style="color: #4070a0; font-style: italic">    Normalize oTree data from wide to long format, then reshape it into a set </span>
</span><span id="__span-0-889"><a id="__codelineno-0-889" name="__codelineno-0-889"></a><span style="color: #4070a0; font-style: italic">    of list-of-dicts structures. Optionally save it to a set of CSV files.</span>
</span><span id="__span-0-890"><a id="__codelineno-0-890" name="__codelineno-0-890"></a>
</span><span id="__span-0-891"><a id="__codelineno-0-891" name="__codelineno-0-891"></a><span style="color: #4070a0; font-style: italic">    Args:</span>
</span><span id="__span-0-892"><a id="__codelineno-0-892" name="__codelineno-0-892"></a><span style="color: #4070a0; font-style: italic">        otree_csv_file (str): Path to a wide multi app oTree CSV file.</span>
</span><span id="__span-0-893"><a id="__codelineno-0-893" name="__codelineno-0-893"></a><span style="color: #4070a0; font-style: italic">        var_dict (dict, optional): A dict to customize the exported data. See</span>
</span><span id="__span-0-894"><a id="__codelineno-0-894" name="__codelineno-0-894"></a><span style="color: #4070a0; font-style: italic">            detail section.</span>
</span><span id="__span-0-895"><a id="__codelineno-0-895" name="__codelineno-0-895"></a><span style="color: #4070a0; font-style: italic">        store_as_csv (bool, optional): Whether to store the normalized data as</span>
</span><span id="__span-0-896"><a id="__codelineno-0-896" name="__codelineno-0-896"></a><span style="color: #4070a0; font-style: italic">            CSV files. Defaults to False.</span>
</span><span id="__span-0-897"><a id="__codelineno-0-897" name="__codelineno-0-897"></a><span style="color: #4070a0; font-style: italic">        data_exp_path (str, optional): Path to the folder where the normalized</span>
</span><span id="__span-0-898"><a id="__codelineno-0-898" name="__codelineno-0-898"></a><span style="color: #4070a0; font-style: italic">            CSV files should be stored. Defaults to &#39;.&#39; (current folder).</span>
</span><span id="__span-0-899"><a id="__codelineno-0-899" name="__codelineno-0-899"></a><span style="color: #4070a0; font-style: italic">        exp_prefix (str, optional): Prefix to be used for the CSV file names. </span>
</span><span id="__span-0-900"><a id="__codelineno-0-900" name="__codelineno-0-900"></a><span style="color: #4070a0; font-style: italic">            Defaults to &#39;&#39; (no prefix).</span>
</span><span id="__span-0-901"><a id="__codelineno-0-901" name="__codelineno-0-901"></a>
</span><span id="__span-0-902"><a id="__codelineno-0-902" name="__codelineno-0-902"></a><span style="color: #4070a0; font-style: italic">    Returns:</span>
</span><span id="__span-0-903"><a id="__codelineno-0-903" name="__codelineno-0-903"></a><span style="color: #4070a0; font-style: italic">        A dict whose keys are table names (e.g. &#39;session&#39;, &#39;participant&#39;, </span>
</span><span id="__span-0-904"><a id="__codelineno-0-904" name="__codelineno-0-904"></a><span style="color: #4070a0; font-style: italic">            &#39;myapp_group&#39;, &#39;myapp_player&#39;, etc.) and whose values are lists of </span>
</span><span id="__span-0-905"><a id="__codelineno-0-905" name="__codelineno-0-905"></a><span style="color: #4070a0; font-style: italic">            dictionaries (i.e., row data).</span>
</span><span id="__span-0-906"><a id="__codelineno-0-906" name="__codelineno-0-906"></a>
</span><span id="__span-0-907"><a id="__codelineno-0-907" name="__codelineno-0-907"></a><span style="color: #4070a0; font-style: italic">    ??? tip &quot;Additional details&quot;</span>
</span><span id="__span-0-908"><a id="__codelineno-0-908" name="__codelineno-0-908"></a><span style="color: #4070a0; font-style: italic">        The var_dict parameter is a dictionary that allows to customize the</span>
</span><span id="__span-0-909"><a id="__codelineno-0-909" name="__codelineno-0-909"></a><span style="color: #4070a0; font-style: italic">        exported data. The keys of the dictionary are the names of the oTree</span>
</span><span id="__span-0-910"><a id="__codelineno-0-910" name="__codelineno-0-910"></a><span style="color: #4070a0; font-style: italic">        apps. The values are dictionaries that map the original column names to</span>
</span><span id="__span-0-911"><a id="__codelineno-0-911" name="__codelineno-0-911"></a><span style="color: #4070a0; font-style: italic">        the desired column names. The keys of these inner dictionaries are the</span>
</span><span id="__span-0-912"><a id="__codelineno-0-912" name="__codelineno-0-912"></a><span style="color: #4070a0; font-style: italic">        original column names and the values are the desired column names. All</span>
</span><span id="__span-0-913"><a id="__codelineno-0-913" name="__codelineno-0-913"></a><span style="color: #4070a0; font-style: italic">        variables that are not included in the dict are omitted from the output.</span>
</span><span id="__span-0-914"><a id="__codelineno-0-914" name="__codelineno-0-914"></a><span style="color: #4070a0; font-style: italic">        The &#39;participant&#39; and &#39;session&#39; keys are reserved for the participant </span>
</span><span id="__span-0-915"><a id="__codelineno-0-915" name="__codelineno-0-915"></a><span style="color: #4070a0; font-style: italic">        and session data, respectively.</span>
</span><span id="__span-0-916"><a id="__codelineno-0-916" name="__codelineno-0-916"></a><span style="color: #4070a0; font-style: italic">    &quot;&quot;&quot;</span>
</span><span id="__span-0-917"><a id="__codelineno-0-917" name="__codelineno-0-917"></a>
</span><span id="__span-0-918"><a id="__codelineno-0-918" name="__codelineno-0-918"></a>    <span style="color: #60a0b0; font-style: italic"># The function is based on the naming conventions of oTree CSV files.</span>
</span><span id="__span-0-919"><a id="__codelineno-0-919" name="__codelineno-0-919"></a>    <span style="color: #60a0b0; font-style: italic"># oTree uses multi-level headers in the CSV file, where each level is</span>
</span><span id="__span-0-920"><a id="__codelineno-0-920" name="__codelineno-0-920"></a>    <span style="color: #60a0b0; font-style: italic"># separated by a dot. </span>
</span><span id="__span-0-921"><a id="__codelineno-0-921" name="__codelineno-0-921"></a>
</span><span id="__span-0-922"><a id="__codelineno-0-922" name="__codelineno-0-922"></a>    <span style="color: #60a0b0; font-style: italic"># The general flow of the function is as follows:</span>
</span><span id="__span-0-923"><a id="__codelineno-0-923" name="__codelineno-0-923"></a>    <span style="color: #60a0b0; font-style: italic"># 1) Read the CSV file and extract the multi-level headers.</span>
</span><span id="__span-0-924"><a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span style="color: #60a0b0; font-style: italic"># 2) Pivot the data to long format by flattening wide columns into rows of   </span>
</span><span id="__span-0-925"><a id="__codelineno-0-925" name="__codelineno-0-925"></a>    <span style="color: #60a0b0; font-style: italic">#     [observation, level_1..4, value].</span>
</span><span id="__span-0-926"><a id="__codelineno-0-926" name="__codelineno-0-926"></a>    <span style="color: #60a0b0; font-style: italic"># 3) Extract participant and session data.</span>
</span><span id="__span-0-927"><a id="__codelineno-0-927" name="__codelineno-0-927"></a>    <span style="color: #60a0b0; font-style: italic"># 4) Separate the remaining long data by app and sub-level, pivoting each</span>
</span><span id="__span-0-928"><a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span style="color: #60a0b0; font-style: italic">#    resulting data set back into wide format and add the appropriate</span>
</span><span id="__span-0-929"><a id="__codelineno-0-929" name="__codelineno-0-929"></a>    <span style="color: #60a0b0; font-style: italic">#    keys from participant and session data.</span>
</span><span id="__span-0-930"><a id="__codelineno-0-930" name="__codelineno-0-930"></a>    <span style="color: #60a0b0; font-style: italic">#    - subsession (should be empty since subsessions seem to be equal to </span>
</span><span id="__span-0-931"><a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span style="color: #60a0b0; font-style: italic">#      rounds, tbc)</span>
</span><span id="__span-0-932"><a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span style="color: #60a0b0; font-style: italic">#    - group (merge with session data on participant_code to create key, </span>
</span><span id="__span-0-933"><a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span style="color: #60a0b0; font-style: italic">#      only keep if it contains data)</span>
</span><span id="__span-0-934"><a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span style="color: #60a0b0; font-style: italic">#    - player (rename id_in_group to player_id)  </span>
</span><span id="__span-0-935"><a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span style="color: #60a0b0; font-style: italic"># 5) Optionally store the data as CSV files.</span>
</span><span id="__span-0-936"><a id="__codelineno-0-936" name="__codelineno-0-936"></a>
</span><span id="__span-0-937"><a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span style="color: #60a0b0; font-style: italic"># --------------------------------------------------------------------------</span>
</span><span id="__span-0-938"><a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span style="color: #60a0b0; font-style: italic"># Helper functions</span>
</span><span id="__span-0-939"><a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span style="color: #60a0b0; font-style: italic"># --------------------------------------------------------------------------</span>
</span><span id="__span-0-940"><a id="__codelineno-0-940" name="__codelineno-0-940"></a>
</span><span id="__span-0-941"><a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">extract_data</span>(var, stacked_data, var_dict):
</span><span id="__span-0-942"><a id="__codelineno-0-942" name="__codelineno-0-942"></a>        relevant <span style="color: #666666">=</span> [
</span><span id="__span-0-943"><a id="__codelineno-0-943" name="__codelineno-0-943"></a>            d <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> stacked_data <span style="color: #007020; font-weight: bold">if</span> d[<span style="color: #4070a0">&#39;level_1&#39;</span>] <span style="color: #666666">==</span> var 
</span><span id="__span-0-944"><a id="__codelineno-0-944" name="__codelineno-0-944"></a>        ]
</span><span id="__span-0-945"><a id="__codelineno-0-945" name="__codelineno-0-945"></a>        var_dict <span style="color: #666666">=</span> var_dict<span style="color: #666666">.</span>get(var)
</span><span id="__span-0-946"><a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span style="color: #007020; font-weight: bold">if</span> var <span style="color: #007020; font-weight: bold">in</span> [<span style="color: #4070a0">&#39;participant&#39;</span>, <span style="color: #4070a0">&#39;session&#39;</span>]:
</span><span id="__span-0-947"><a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span style="color: #60a0b0; font-style: italic"># exclude not requested rows</span>
</span><span id="__span-0-948"><a id="__codelineno-0-948" name="__codelineno-0-948"></a>            relevant <span style="color: #666666">=</span> [
</span><span id="__span-0-949"><a id="__codelineno-0-949" name="__codelineno-0-949"></a>                d <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> relevant <span style="color: #007020; font-weight: bold">if</span> d[<span style="color: #4070a0">&#39;level_2&#39;</span>] <span style="color: #007020; font-weight: bold">in</span> var_dict<span style="color: #666666">.</span>keys()
</span><span id="__span-0-950"><a id="__codelineno-0-950" name="__codelineno-0-950"></a>            ]
</span><span id="__span-0-951"><a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span style="color: #60a0b0; font-style: italic"># Remap level_2 column names</span>
</span><span id="__span-0-952"><a id="__codelineno-0-952" name="__codelineno-0-952"></a>            <span style="color: #007020; font-weight: bold">for</span> item <span style="color: #007020; font-weight: bold">in</span> relevant:
</span><span id="__span-0-953"><a id="__codelineno-0-953" name="__codelineno-0-953"></a>                item[<span style="color: #4070a0">&#39;level_2&#39;</span>] <span style="color: #666666">=</span> var_dict[item[<span style="color: #4070a0">&#39;level_2&#39;</span>]]
</span><span id="__span-0-954"><a id="__codelineno-0-954" name="__codelineno-0-954"></a>
</span><span id="__span-0-955"><a id="__codelineno-0-955" name="__codelineno-0-955"></a>        <span style="color: #60a0b0; font-style: italic"># Build pivot result as dict {observation -&gt; one row dict}</span>
</span><span id="__span-0-956"><a id="__codelineno-0-956" name="__codelineno-0-956"></a>        pivoted <span style="color: #666666">=</span> {}
</span><span id="__span-0-957"><a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span style="color: #007020; font-weight: bold">for</span> item <span style="color: #007020; font-weight: bold">in</span> relevant:
</span><span id="__span-0-958"><a id="__codelineno-0-958" name="__codelineno-0-958"></a>            obs <span style="color: #666666">=</span> item[<span style="color: #4070a0">&#39;observation&#39;</span>]
</span><span id="__span-0-959"><a id="__codelineno-0-959" name="__codelineno-0-959"></a>            col <span style="color: #666666">=</span> item[<span style="color: #4070a0">&#39;level_2&#39;</span>]
</span><span id="__span-0-960"><a id="__codelineno-0-960" name="__codelineno-0-960"></a>            val <span style="color: #666666">=</span> item[<span style="color: #4070a0">&#39;value&#39;</span>]
</span><span id="__span-0-961"><a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span style="color: #007020; font-weight: bold">if</span> obs <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> pivoted:
</span><span id="__span-0-962"><a id="__codelineno-0-962" name="__codelineno-0-962"></a>                pivoted[obs] <span style="color: #666666">=</span> {<span style="color: #4070a0">&#39;observation&#39;</span>: obs}
</span><span id="__span-0-963"><a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span style="color: #60a0b0; font-style: italic"># Only keep first occurrence if duplicates exist</span>
</span><span id="__span-0-964"><a id="__codelineno-0-964" name="__codelineno-0-964"></a>            <span style="color: #007020; font-weight: bold">if</span> col <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> pivoted[obs]:
</span><span id="__span-0-965"><a id="__codelineno-0-965" name="__codelineno-0-965"></a>                pivoted[obs][col] <span style="color: #666666">=</span> val
</span><span id="__span-0-966"><a id="__codelineno-0-966" name="__codelineno-0-966"></a>
</span><span id="__span-0-967"><a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span style="color: #007020; font-weight: bold">return</span> <span style="color: #007020">list</span>(pivoted<span style="color: #666666">.</span>values())
</span><span id="__span-0-968"><a id="__codelineno-0-968" name="__codelineno-0-968"></a>
</span><span id="__span-0-969"><a id="__codelineno-0-969" name="__codelineno-0-969"></a>    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">index_to_participant_code</span>(data_list, obs_to_pcode):
</span><span id="__span-0-970"><a id="__codelineno-0-970" name="__codelineno-0-970"></a>        out <span style="color: #666666">=</span> []
</span><span id="__span-0-971"><a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> data_list:
</span><span id="__span-0-972"><a id="__codelineno-0-972" name="__codelineno-0-972"></a>            obs <span style="color: #666666">=</span> row[<span style="color: #4070a0">&#39;observation&#39;</span>]
</span><span id="__span-0-973"><a id="__codelineno-0-973" name="__codelineno-0-973"></a>            new_row <span style="color: #666666">=</span> <span style="color: #007020">dict</span>(row)
</span><span id="__span-0-974"><a id="__codelineno-0-974" name="__codelineno-0-974"></a>            new_row[<span style="color: #4070a0">&#39;participant_code&#39;</span>] <span style="color: #666666">=</span> obs_to_pcode<span style="color: #666666">.</span>get(obs, <span style="color: #007020; font-weight: bold">None</span>)
</span><span id="__span-0-975"><a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span style="color: #007020; font-weight: bold">del</span> new_row[<span style="color: #4070a0">&#39;observation&#39;</span>]
</span><span id="__span-0-976"><a id="__codelineno-0-976" name="__codelineno-0-976"></a>            out<span style="color: #666666">.</span>append(new_row)
</span><span id="__span-0-977"><a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span style="color: #007020; font-weight: bold">return</span> out
</span><span id="__span-0-978"><a id="__codelineno-0-978" name="__codelineno-0-978"></a>
</span><span id="__span-0-979"><a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">try_convert_number</span>(x):
</span><span id="__span-0-980"><a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span style="color: #007020; font-weight: bold">if</span> x <span style="color: #007020; font-weight: bold">is</span> <span style="color: #007020; font-weight: bold">None</span>:
</span><span id="__span-0-981"><a id="__codelineno-0-981" name="__codelineno-0-981"></a>            <span style="color: #007020; font-weight: bold">return</span> <span style="color: #007020; font-weight: bold">None</span>
</span><span id="__span-0-982"><a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span style="color: #60a0b0; font-style: italic"># Already a number? (in case we call this multiple times)</span>
</span><span id="__span-0-983"><a id="__codelineno-0-983" name="__codelineno-0-983"></a>        <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020">isinstance</span>(x, (<span style="color: #007020">int</span>, <span style="color: #007020">float</span>)):
</span><span id="__span-0-984"><a id="__codelineno-0-984" name="__codelineno-0-984"></a>            <span style="color: #007020; font-weight: bold">return</span> x
</span><span id="__span-0-985"><a id="__codelineno-0-985" name="__codelineno-0-985"></a>        <span style="color: #60a0b0; font-style: italic"># Attempt int -&gt; float -&gt; fallback str</span>
</span><span id="__span-0-986"><a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span style="color: #007020; font-weight: bold">try</span>:
</span><span id="__span-0-987"><a id="__codelineno-0-987" name="__codelineno-0-987"></a>            <span style="color: #007020; font-weight: bold">return</span> <span style="color: #007020">int</span>(x)
</span><span id="__span-0-988"><a id="__codelineno-0-988" name="__codelineno-0-988"></a>        <span style="color: #007020; font-weight: bold">except</span> (<span style="color: #007020">ValueError</span>, <span style="color: #007020">TypeError</span>):
</span><span id="__span-0-989"><a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span style="color: #007020; font-weight: bold">pass</span>
</span><span id="__span-0-990"><a id="__codelineno-0-990" name="__codelineno-0-990"></a>        <span style="color: #007020; font-weight: bold">try</span>:
</span><span id="__span-0-991"><a id="__codelineno-0-991" name="__codelineno-0-991"></a>            <span style="color: #007020; font-weight: bold">return</span> <span style="color: #007020">float</span>(x)
</span><span id="__span-0-992"><a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span style="color: #007020; font-weight: bold">except</span> (<span style="color: #007020">ValueError</span>, <span style="color: #007020">TypeError</span>):
</span><span id="__span-0-993"><a id="__codelineno-0-993" name="__codelineno-0-993"></a>            <span style="color: #007020; font-weight: bold">pass</span>
</span><span id="__span-0-994"><a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span style="color: #007020; font-weight: bold">return</span> <span style="color: #007020">str</span>(x)
</span><span id="__span-0-995"><a id="__codelineno-0-995" name="__codelineno-0-995"></a>
</span><span id="__span-0-996"><a id="__codelineno-0-996" name="__codelineno-0-996"></a>    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">convert_columns</span>(data_list, keys<span style="color: #666666">=</span><span style="color: #007020; font-weight: bold">None</span>):
</span><span id="__span-0-997"><a id="__codelineno-0-997" name="__codelineno-0-997"></a>        missing_keys <span style="color: #666666">=</span> <span style="color: #007020">set</span>()
</span><span id="__span-0-998"><a id="__codelineno-0-998" name="__codelineno-0-998"></a>        <span style="color: #007020; font-weight: bold">if</span> keys:
</span><span id="__span-0-999"><a id="__codelineno-0-999" name="__codelineno-0-999"></a>            missing_keys <span style="color: #666666">=</span> <span style="color: #007020">set</span>(keys) <span style="color: #666666">-</span> <span style="color: #007020">set</span>(data_list[<span style="color: #40a070">0</span>]<span style="color: #666666">.</span>keys())
</span><span id="__span-0-1000"><a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>        <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> data_list:
</span><span id="__span-0-1001"><a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>            <span style="color: #007020; font-weight: bold">for</span> k, v <span style="color: #007020; font-weight: bold">in</span> row<span style="color: #666666">.</span>items():
</span><span id="__span-0-1002"><a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                <span style="color: #007020; font-weight: bold">if</span> k <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> (<span style="color: #4070a0">&quot;observation&quot;</span>,):  <span style="color: #60a0b0; font-style: italic"># do not convert observation index</span>
</span><span id="__span-0-1003"><a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                    row[k] <span style="color: #666666">=</span> try_convert_number(v)
</span><span id="__span-0-1004"><a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>            <span style="color: #007020; font-weight: bold">for</span> k <span style="color: #007020; font-weight: bold">in</span> missing_keys:
</span><span id="__span-0-1005"><a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                row[k] <span style="color: #666666">=</span> <span style="color: #4070a0">&#39;&#39;</span> 
</span><span id="__span-0-1006"><a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>        <span style="color: #007020; font-weight: bold">return</span> data_list
</span><span id="__span-0-1007"><a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>
</span><span id="__span-0-1008"><a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">unify_dict_keys</span>(rows):
</span><span id="__span-0-1009"><a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        seen_keys <span style="color: #666666">=</span> []
</span><span id="__span-0-1010"><a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> rows:
</span><span id="__span-0-1011"><a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span style="color: #007020; font-weight: bold">for</span> k <span style="color: #007020; font-weight: bold">in</span> d<span style="color: #666666">.</span>keys():
</span><span id="__span-0-1012"><a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                <span style="color: #007020; font-weight: bold">if</span> k <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> seen_keys:
</span><span id="__span-0-1013"><a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                    seen_keys<span style="color: #666666">.</span>append(k)
</span><span id="__span-0-1014"><a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>        new_rows <span style="color: #666666">=</span> []
</span><span id="__span-0-1015"><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>        <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> rows:
</span><span id="__span-0-1016"><a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            new_d <span style="color: #666666">=</span> {}
</span><span id="__span-0-1017"><a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>            <span style="color: #007020; font-weight: bold">for</span> k <span style="color: #007020; font-weight: bold">in</span> seen_keys:
</span><span id="__span-0-1018"><a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                new_d[k] <span style="color: #666666">=</span> d<span style="color: #666666">.</span>get(k, <span style="color: #4070a0">&#39;&#39;</span>) 
</span><span id="__span-0-1019"><a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>            new_rows<span style="color: #666666">.</span>append(new_d)
</span><span id="__span-0-1020"><a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span style="color: #007020; font-weight: bold">return</span> new_rows
</span><span id="__span-0-1021"><a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
</span><span id="__span-0-1022"><a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">reorder_columns</span>(data_list, first_cols):
</span><span id="__span-0-1023"><a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        out <span style="color: #666666">=</span> []
</span><span id="__span-0-1024"><a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> data_list:
</span><span id="__span-0-1025"><a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>            new_row <span style="color: #666666">=</span> {}
</span><span id="__span-0-1026"><a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span style="color: #60a0b0; font-style: italic"># keep track of which keys got placed</span>
</span><span id="__span-0-1027"><a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            placed <span style="color: #666666">=</span> <span style="color: #007020">set</span>()
</span><span id="__span-0-1028"><a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span style="color: #60a0b0; font-style: italic"># place the &quot;first_cols&quot; in order</span>
</span><span id="__span-0-1029"><a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span style="color: #007020; font-weight: bold">for</span> c <span style="color: #007020; font-weight: bold">in</span> first_cols:
</span><span id="__span-0-1030"><a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>                <span style="color: #007020; font-weight: bold">if</span> c <span style="color: #007020; font-weight: bold">in</span> row:
</span><span id="__span-0-1031"><a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                    new_row[c] <span style="color: #666666">=</span> row[c]
</span><span id="__span-0-1032"><a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                    placed<span style="color: #666666">.</span>add(c)
</span><span id="__span-0-1033"><a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span style="color: #60a0b0; font-style: italic"># place remaining</span>
</span><span id="__span-0-1034"><a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>            <span style="color: #007020; font-weight: bold">for</span> c <span style="color: #007020; font-weight: bold">in</span> row:
</span><span id="__span-0-1035"><a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                <span style="color: #007020; font-weight: bold">if</span> c <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> placed:
</span><span id="__span-0-1036"><a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                    new_row[c] <span style="color: #666666">=</span> row[c]
</span><span id="__span-0-1037"><a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>            out<span style="color: #666666">.</span>append(new_row)
</span><span id="__span-0-1038"><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span style="color: #007020; font-weight: bold">return</span> out
</span><span id="__span-0-1039"><a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>
</span><span id="__span-0-1040"><a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>
</span><span id="__span-0-1041"><a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>    <span style="color: #007020; font-weight: bold">def</span> <span style="color: #06287e">write_dicts_to_csv</span>(dict_rows, file_path):
</span><span id="__span-0-1042"><a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020; font-weight: bold">not</span> dict_rows:
</span><span id="__span-0-1043"><a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>            <span style="color: #60a0b0; font-style: italic"># If empty, write just an empty file or possibly only headers</span>
</span><span id="__span-0-1044"><a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>            <span style="color: #007020; font-weight: bold">with</span> <span style="color: #007020">open</span>(file_path, <span style="color: #4070a0">&#39;w&#39;</span>, newline<span style="color: #666666">=</span><span style="color: #4070a0">&#39;&#39;</span>, encoding<span style="color: #666666">=</span><span style="color: #4070a0">&#39;utf-8&#39;</span>) <span style="color: #007020; font-weight: bold">as</span> f:
</span><span id="__span-0-1045"><a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>                <span style="color: #007020; font-weight: bold">pass</span>
</span><span id="__span-0-1046"><a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>            <span style="color: #007020; font-weight: bold">return</span>
</span><span id="__span-0-1047"><a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        fieldnames <span style="color: #666666">=</span> <span style="color: #007020">list</span>(dict_rows[<span style="color: #40a070">0</span>]<span style="color: #666666">.</span>keys())
</span><span id="__span-0-1048"><a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span style="color: #007020; font-weight: bold">with</span> <span style="color: #007020">open</span>(file_path, <span style="color: #4070a0">&#39;w&#39;</span>, newline<span style="color: #666666">=</span><span style="color: #4070a0">&#39;&#39;</span>, encoding<span style="color: #666666">=</span><span style="color: #4070a0">&#39;utf-8&#39;</span>) <span style="color: #007020; font-weight: bold">as</span> f:
</span><span id="__span-0-1049"><a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>            writer <span style="color: #666666">=</span> csv<span style="color: #666666">.</span>DictWriter(f, fieldnames<span style="color: #666666">=</span>fieldnames)
</span><span id="__span-0-1050"><a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>            writer<span style="color: #666666">.</span>writeheader()
</span><span id="__span-0-1051"><a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>            writer<span style="color: #666666">.</span>writerows(dict_rows)
</span><span id="__span-0-1052"><a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
</span><span id="__span-0-1053"><a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>
</span><span id="__span-0-1054"><a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>    <span style="color: #60a0b0; font-style: italic"># --------------------------------------------------------------------------</span>
</span><span id="__span-0-1055"><a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span style="color: #60a0b0; font-style: italic"># Main code</span>
</span><span id="__span-0-1056"><a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>    <span style="color: #60a0b0; font-style: italic"># --------------------------------------------------------------------------</span>
</span><span id="__span-0-1057"><a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>
</span><span id="__span-0-1058"><a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>    <span style="color: #60a0b0; font-style: italic"># --- 1) Read the CSV file and extract the multi-level headers -------------</span>
</span><span id="__span-0-1059"><a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>
</span><span id="__span-0-1060"><a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>    <span style="color: #007020; font-weight: bold">with</span> <span style="color: #007020">open</span>(otree_csv_file, <span style="color: #4070a0">&#39;r&#39;</span>, encoding<span style="color: #666666">=</span><span style="color: #4070a0">&#39;utf-8-sig&#39;</span>) <span style="color: #007020; font-weight: bold">as</span> f:
</span><span id="__span-0-1061"><a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        reader <span style="color: #666666">=</span> csv<span style="color: #666666">.</span>reader(f)
</span><span id="__span-0-1062"><a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        all_rows <span style="color: #666666">=</span> <span style="color: #007020">list</span>(reader)
</span><span id="__span-0-1063"><a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>    <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020; font-weight: bold">not</span> all_rows:
</span><span id="__span-0-1064"><a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span style="color: #007020; font-weight: bold">raise</span> <span style="color: #007020">ValueError</span>(<span style="color: #4070a0">f&quot;CSV file </span><span style="color: #70a0d0; font-style: italic">{</span>otree_csv_file<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0"> is empty or invalid.&quot;</span>)
</span><span id="__span-0-1065"><a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
</span><span id="__span-0-1066"><a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>    headers <span style="color: #666666">=</span> all_rows[<span style="color: #40a070">0</span>]
</span><span id="__span-0-1067"><a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>    data_rows <span style="color: #666666">=</span> all_rows[<span style="color: #40a070">1</span>:]
</span><span id="__span-0-1068"><a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>    multi_headers <span style="color: #666666">=</span> [<span style="color: #007020">tuple</span>(h<span style="color: #666666">.</span>split(<span style="color: #4070a0">&#39;.&#39;</span>)) <span style="color: #007020; font-weight: bold">for</span> h <span style="color: #007020; font-weight: bold">in</span> headers]
</span><span id="__span-0-1069"><a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>
</span><span id="__span-0-1070"><a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>
</span><span id="__span-0-1071"><a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>    <span style="color: #60a0b0; font-style: italic"># --- 2) Pivot the data to long format -------------------------------------</span>
</span><span id="__span-0-1072"><a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
</span><span id="__span-0-1073"><a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    processed_rows <span style="color: #666666">=</span> []
</span><span id="__span-0-1074"><a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>    <span style="color: #007020; font-weight: bold">for</span> row_idx, row <span style="color: #007020; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(data_rows):
</span><span id="__span-0-1075"><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>        row_dict <span style="color: #666666">=</span> {}
</span><span id="__span-0-1076"><a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>        <span style="color: #007020; font-weight: bold">for</span> col_idx, val <span style="color: #007020; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(row):
</span><span id="__span-0-1077"><a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>            key_tuple <span style="color: #666666">=</span> <span style="color: #007020">list</span>(multi_headers[col_idx])
</span><span id="__span-0-1078"><a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>            <span style="color: #007020; font-weight: bold">while</span> <span style="color: #007020">len</span>(key_tuple) <span style="color: #666666">&lt;</span> <span style="color: #40a070">4</span>:
</span><span id="__span-0-1079"><a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                key_tuple<span style="color: #666666">.</span>append(<span style="color: #007020; font-weight: bold">None</span>)
</span><span id="__span-0-1080"><a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>            row_dict[<span style="color: #007020">tuple</span>(key_tuple)] <span style="color: #666666">=</span> val
</span><span id="__span-0-1081"><a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>        processed_rows<span style="color: #666666">.</span>append(row_dict)
</span><span id="__span-0-1082"><a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>
</span><span id="__span-0-1083"><a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>    stacked_data <span style="color: #666666">=</span> []
</span><span id="__span-0-1084"><a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>    <span style="color: #007020; font-weight: bold">for</span> obs_idx, row_dict <span style="color: #007020; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(processed_rows):
</span><span id="__span-0-1085"><a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>        <span style="color: #007020; font-weight: bold">for</span> (lvl1, lvl2, lvl3, lvl4), val <span style="color: #007020; font-weight: bold">in</span> row_dict<span style="color: #666666">.</span>items():
</span><span id="__span-0-1086"><a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>            stacked_data<span style="color: #666666">.</span>append({
</span><span id="__span-0-1087"><a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                <span style="color: #4070a0">&#39;observation&#39;</span>: obs_idx,
</span><span id="__span-0-1088"><a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                <span style="color: #4070a0">&#39;level_1&#39;</span>: lvl1,
</span><span id="__span-0-1089"><a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                <span style="color: #4070a0">&#39;level_2&#39;</span>: lvl2,
</span><span id="__span-0-1090"><a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span style="color: #4070a0">&#39;level_3&#39;</span>: lvl3,
</span><span id="__span-0-1091"><a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                <span style="color: #4070a0">&#39;level_4&#39;</span>: lvl4,
</span><span id="__span-0-1092"><a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span style="color: #4070a0">&#39;value&#39;</span>: val
</span><span id="__span-0-1093"><a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>            })
</span><span id="__span-0-1094"><a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>
</span><span id="__span-0-1095"><a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>    all_level1 <span style="color: #666666">=</span> <span style="color: #007020">set</span>(d[<span style="color: #4070a0">&#39;level_1&#39;</span>] <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> stacked_data <span style="color: #007020; font-weight: bold">if</span> d[<span style="color: #4070a0">&#39;level_1&#39;</span>])
</span><span id="__span-0-1096"><a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>    all_level1 <span style="color: #666666">=</span> all_level1 <span style="color: #666666">-</span> {<span style="color: #4070a0">&#39;participant&#39;</span>, <span style="color: #4070a0">&#39;session&#39;</span>}
</span><span id="__span-0-1097"><a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>    apps <span style="color: #666666">=</span> <span style="color: #007020">sorted</span>(<span style="color: #007020">list</span>(all_level1))
</span><span id="__span-0-1098"><a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>
</span><span id="__span-0-1099"><a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>    <span style="color: #60a0b0; font-style: italic"># Ensure var_dict has entries for each discovered app (even if empty).</span>
</span><span id="__span-0-1100"><a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>    <span style="color: #007020; font-weight: bold">for</span> app <span style="color: #007020; font-weight: bold">in</span> apps:
</span><span id="__span-0-1101"><a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>        <span style="color: #007020; font-weight: bold">if</span> app <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> var_dict:
</span><span id="__span-0-1102"><a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            var_dict[app] <span style="color: #666666">=</span> {}
</span><span id="__span-0-1103"><a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>
</span><span id="__span-0-1104"><a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>
</span><span id="__span-0-1105"><a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>    <span style="color: #60a0b0; font-style: italic"># --- 3) Extract participant and session data ------------------------------</span>
</span><span id="__span-0-1106"><a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>
</span><span id="__span-0-1107"><a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>    participant_data <span style="color: #666666">=</span> extract_data(<span style="color: #4070a0">&#39;participant&#39;</span>, stacked_data, var_dict)
</span><span id="__span-0-1108"><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>    participant_data <span style="color: #666666">=</span> convert_columns(participant_data)
</span><span id="__span-0-1109"><a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>
</span><span id="__span-0-1110"><a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>    <span style="color: #60a0b0; font-style: italic"># Build a map: obs -&gt; participant_code</span>
</span><span id="__span-0-1111"><a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>    obs_to_participant_code <span style="color: #666666">=</span> {}
</span><span id="__span-0-1112"><a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>    <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> participant_data:
</span><span id="__span-0-1113"><a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>        <span style="color: #60a0b0; font-style: italic"># We expect &#39;participant_code&#39; in these rows</span>
</span><span id="__span-0-1114"><a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>        <span style="color: #007020; font-weight: bold">if</span> <span style="color: #4070a0">&#39;participant_code&#39;</span> <span style="color: #007020; font-weight: bold">in</span> row:
</span><span id="__span-0-1115"><a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>            obs_to_participant_code[row[<span style="color: #4070a0">&#39;observation&#39;</span>]] <span style="color: #666666">=</span> row[<span style="color: #4070a0">&#39;participant_code&#39;</span>]
</span><span id="__span-0-1116"><a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>
</span><span id="__span-0-1117"><a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>    session_data <span style="color: #666666">=</span> extract_data(<span style="color: #4070a0">&#39;session&#39;</span>, stacked_data, var_dict)
</span><span id="__span-0-1118"><a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>    session_data <span style="color: #666666">=</span> convert_columns(session_data)
</span><span id="__span-0-1119"><a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>    session_data <span style="color: #666666">=</span> index_to_participant_code(session_data, obs_to_participant_code)
</span><span id="__span-0-1120"><a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>
</span><span id="__span-0-1121"><a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> participant_data: row<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;observation&#39;</span>)
</span><span id="__span-0-1122"><a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    participant_data <span style="color: #666666">=</span> reorder_columns(participant_data, [<span style="color: #4070a0">&#39;participant_code&#39;</span>])
</span><span id="__span-0-1123"><a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>
</span><span id="__span-0-1124"><a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>    final_tables <span style="color: #666666">=</span> {
</span><span id="__span-0-1125"><a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>        <span style="color: #4070a0">&#39;participant&#39;</span>: participant_data,
</span><span id="__span-0-1126"><a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>        <span style="color: #4070a0">&#39;session&#39;</span>: session_data,
</span><span id="__span-0-1127"><a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>    }
</span><span id="__span-0-1128"><a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>
</span><span id="__span-0-1129"><a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>    <span style="color: #60a0b0; font-style: italic"># --- 4) Separate the remaining long data by app and sub-level -------------</span>
</span><span id="__span-0-1130"><a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>
</span><span id="__span-0-1131"><a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>    <span style="color: #60a0b0; font-style: italic"># For convenience, gather all unique level_3 for each (level_1 == app).</span>
</span><span id="__span-0-1132"><a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>    <span style="color: #60a0b0; font-style: italic"># Typically level_3 is &#39;subsession&#39;, &#39;group&#39;, &#39;player&#39;, etc.</span>
</span><span id="__span-0-1133"><a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>    <span style="color: #007020; font-weight: bold">for</span> app <span style="color: #007020; font-weight: bold">in</span> apps:
</span><span id="__span-0-1134"><a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>        logger<span style="color: #666666">.</span>info(<span style="color: #4070a0">f&quot;Normalize data for oTree app: &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>app<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39;&quot;</span>)
</span><span id="__span-0-1135"><a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>        app_level_3 <span style="color: #666666">=</span> <span style="color: #007020">sorted</span>(<span style="color: #007020">set</span>(
</span><span id="__span-0-1136"><a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>            d[<span style="color: #4070a0">&#39;level_3&#39;</span>] <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> stacked_data <span style="color: #007020; font-weight: bold">if</span> d[<span style="color: #4070a0">&#39;level_1&#39;</span>] <span style="color: #666666">==</span> app <span style="color: #007020; font-weight: bold">and</span> d[<span style="color: #4070a0">&#39;level_3&#39;</span>]
</span><span id="__span-0-1137"><a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        ))
</span><span id="__span-0-1138"><a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>
</span><span id="__span-0-1139"><a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span style="color: #007020; font-weight: bold">for</span> group_name <span style="color: #007020; font-weight: bold">in</span> app_level_3:
</span><span id="__span-0-1140"><a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>            <span style="color: #60a0b0; font-style: italic"># Filter data for this app &amp; group</span>
</span><span id="__span-0-1141"><a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>            relevant <span style="color: #666666">=</span> [
</span><span id="__span-0-1142"><a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>                d <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> stacked_data
</span><span id="__span-0-1143"><a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                <span style="color: #007020; font-weight: bold">if</span> d[<span style="color: #4070a0">&#39;level_1&#39;</span>] <span style="color: #666666">==</span> app <span style="color: #007020; font-weight: bold">and</span> d[<span style="color: #4070a0">&#39;level_3&#39;</span>] <span style="color: #666666">==</span> group_name
</span><span id="__span-0-1144"><a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>            ]
</span><span id="__span-0-1145"><a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020; font-weight: bold">not</span> relevant:
</span><span id="__span-0-1146"><a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>                <span style="color: #007020; font-weight: bold">continue</span>
</span><span id="__span-0-1147"><a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>
</span><span id="__span-0-1148"><a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>            <span style="color: #60a0b0; font-style: italic"># Check whether the user provided a custom variable dictionary</span>
</span><span id="__span-0-1149"><a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>            <span style="color: #60a0b0; font-style: italic"># for this app and group </span>
</span><span id="__span-0-1150"><a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>
</span><span id="__span-0-1151"><a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>            group_dict <span style="color: #666666">=</span> var_dict[app]<span style="color: #666666">.</span>get(group_name, <span style="color: #007020; font-weight: bold">None</span>)
</span><span id="__span-0-1152"><a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>            <span style="color: #007020; font-weight: bold">if</span> group_dict:
</span><span id="__span-0-1153"><a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>                <span style="color: #60a0b0; font-style: italic"># exclude not requested rows</span>
</span><span id="__span-0-1154"><a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                struct_vars <span style="color: #666666">=</span> [
</span><span id="__span-0-1155"><a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                    <span style="color: #4070a0">&#39;id_in_group&#39;</span>, <span style="color: #4070a0">&#39;id_in_subsession&#39;</span>, <span style="color: #4070a0">&#39;round_number&#39;</span>
</span><span id="__span-0-1156"><a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                ]
</span><span id="__span-0-1157"><a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                relevant <span style="color: #666666">=</span> [
</span><span id="__span-0-1158"><a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                    d <span style="color: #007020; font-weight: bold">for</span> d <span style="color: #007020; font-weight: bold">in</span> relevant <span style="color: #007020; font-weight: bold">if</span> (
</span><span id="__span-0-1159"><a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>                        d[<span style="color: #4070a0">&#39;level_4&#39;</span>] <span style="color: #007020; font-weight: bold">in</span> group_dict<span style="color: #666666">.</span>keys() <span style="color: #007020; font-weight: bold">or</span>
</span><span id="__span-0-1160"><a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>                        d[<span style="color: #4070a0">&#39;level_4&#39;</span>] <span style="color: #007020; font-weight: bold">in</span> struct_vars
</span><span id="__span-0-1161"><a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>                    )
</span><span id="__span-0-1162"><a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>                ]
</span><span id="__span-0-1163"><a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>                <span style="color: #60a0b0; font-style: italic"># Remap level_4 column names</span>
</span><span id="__span-0-1164"><a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>                <span style="color: #007020; font-weight: bold">for</span> item <span style="color: #007020; font-weight: bold">in</span> relevant:
</span><span id="__span-0-1165"><a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>                    <span style="color: #007020; font-weight: bold">if</span> item[<span style="color: #4070a0">&#39;level_4&#39;</span>] <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> struct_vars:
</span><span id="__span-0-1166"><a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>                        item[<span style="color: #4070a0">&#39;level_4&#39;</span>] <span style="color: #666666">=</span> group_dict[item[<span style="color: #4070a0">&#39;level_4&#39;</span>]]
</span><span id="__span-0-1167"><a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>
</span><span id="__span-0-1168"><a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>            pivoted <span style="color: #666666">=</span> {}
</span><span id="__span-0-1169"><a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>            cols <span style="color: #666666">=</span> <span style="color: #007020">set</span>()
</span><span id="__span-0-1170"><a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>            <span style="color: #007020; font-weight: bold">for</span> item <span style="color: #007020; font-weight: bold">in</span> relevant:
</span><span id="__span-0-1171"><a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>                obs <span style="color: #666666">=</span> item[<span style="color: #4070a0">&#39;observation&#39;</span>]
</span><span id="__span-0-1172"><a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>                <span style="color: #007020; font-weight: bold">try</span>:
</span><span id="__span-0-1173"><a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>                    rnd <span style="color: #666666">=</span> <span style="color: #007020">int</span>(item[<span style="color: #4070a0">&#39;level_2&#39;</span>])  <span style="color: #60a0b0; font-style: italic"># round number</span>
</span><span id="__span-0-1174"><a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                <span style="color: #007020; font-weight: bold">except</span> (<span style="color: #007020">ValueError</span>, <span style="color: #007020">TypeError</span>):
</span><span id="__span-0-1175"><a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>                    rnd <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">None</span>
</span><span id="__span-0-1176"><a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>
</span><span id="__span-0-1177"><a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                cols<span style="color: #666666">.</span>add(item[<span style="color: #4070a0">&#39;level_4&#39;</span>])
</span><span id="__span-0-1178"><a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                <span style="color: #007020; font-weight: bold">if</span> item[<span style="color: #4070a0">&#39;value&#39;</span>] <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> (<span style="color: #007020; font-weight: bold">None</span>, <span style="color: #4070a0">&#39;&#39;</span>):
</span><span id="__span-0-1179"><a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>                    col <span style="color: #666666">=</span> item[<span style="color: #4070a0">&#39;level_4&#39;</span>]
</span><span id="__span-0-1180"><a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>                    val <span style="color: #666666">=</span> item[<span style="color: #4070a0">&#39;value&#39;</span>]
</span><span id="__span-0-1181"><a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>                    key <span style="color: #666666">=</span> (obs, rnd)
</span><span id="__span-0-1182"><a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>
</span><span id="__span-0-1183"><a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>                    <span style="color: #007020; font-weight: bold">if</span> key <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> pivoted:
</span><span id="__span-0-1184"><a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>                        pivoted[key] <span style="color: #666666">=</span> {
</span><span id="__span-0-1185"><a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                            <span style="color: #4070a0">&#39;observation&#39;</span>: obs,
</span><span id="__span-0-1186"><a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                            <span style="color: #4070a0">&#39;round&#39;</span>: rnd
</span><span id="__span-0-1187"><a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                        }
</span><span id="__span-0-1188"><a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>                    <span style="color: #007020; font-weight: bold">if</span> col <span style="color: #007020; font-weight: bold">and</span> col <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> pivoted[key]:
</span><span id="__span-0-1189"><a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>                        pivoted[key][col] <span style="color: #666666">=</span> val
</span><span id="__span-0-1190"><a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>
</span><span id="__span-0-1191"><a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>            pivoted_list <span style="color: #666666">=</span> unify_dict_keys(<span style="color: #007020">list</span>(pivoted<span style="color: #666666">.</span>values()))
</span><span id="__span-0-1192"><a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>            out_df_rows <span style="color: #666666">=</span> convert_columns(pivoted_list, cols)
</span><span id="__span-0-1193"><a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>            out_df_rows <span style="color: #666666">=</span> index_to_participant_code(
</span><span id="__span-0-1194"><a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>                out_df_rows, obs_to_participant_code
</span><span id="__span-0-1195"><a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>            )
</span><span id="__span-0-1196"><a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>            table_name <span style="color: #666666">=</span> <span style="color: #4070a0">f&quot;</span><span style="color: #70a0d0; font-style: italic">{</span>app<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">_</span><span style="color: #70a0d0; font-style: italic">{</span>group_name<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&quot;</span>  
</span><span id="__span-0-1197"><a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>
</span><span id="__span-0-1198"><a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span style="color: #007020; font-weight: bold">if</span> group_name <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;subsession&#39;</span>:
</span><span id="__span-0-1199"><a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span style="color: #60a0b0; font-style: italic"># This code assumes that subsesions are equal to rounds.</span>
</span><span id="__span-0-1200"><a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                <span style="color: #60a0b0; font-style: italic"># This implies that round_number&#39; and &#39;round&#39; columns should </span>
</span><span id="__span-0-1201"><a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                <span style="color: #60a0b0; font-style: italic"># match and that the resulting data should have 3 columns.</span>
</span><span id="__span-0-1202"><a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                col_names <span style="color: #666666">=</span> out_df_rows[<span style="color: #40a070">0</span>]<span style="color: #666666">.</span>keys() <span style="color: #007020; font-weight: bold">if</span> out_df_rows <span style="color: #007020; font-weight: bold">else</span> []
</span><span id="__span-0-1203"><a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020">len</span>(col_names) <span style="color: #666666">!=</span> <span style="color: #40a070">3</span>:
</span><span id="__span-0-1204"><a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                    logger<span style="color: #666666">.</span>error(
</span><span id="__span-0-1205"><a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                        <span style="color: #4070a0">f&quot;Error </span><span style="color: #70a0d0; font-style: italic">{</span>app<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0"> data extraction: app seems to contain &quot;</span>
</span><span id="__span-0-1206"><a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                        <span style="color: #4070a0">&quot;more subsessions than rounds or subsession level data.&quot;</span>
</span><span id="__span-0-1207"><a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                    )
</span><span id="__span-0-1208"><a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                    <span style="color: #007020; font-weight: bold">raise</span> <span style="color: #007020">ValueError</span>(
</span><span id="__span-0-1209"><a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                        <span style="color: #4070a0">f&quot;Error in </span><span style="color: #70a0d0; font-style: italic">{</span>app<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0"> data extraction: app seems to contain &quot;</span>
</span><span id="__span-0-1210"><a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>                        <span style="color: #4070a0">&quot;more subsessions than rounds.&quot;</span>
</span><span id="__span-0-1211"><a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                    )
</span><span id="__span-0-1212"><a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> out_df_rows:
</span><span id="__span-0-1213"><a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>                    <span style="color: #007020; font-weight: bold">if</span> <span style="color: #4070a0">&#39;round_number&#39;</span> <span style="color: #007020; font-weight: bold">in</span> row <span style="color: #007020; font-weight: bold">and</span> row[<span style="color: #4070a0">&#39;round_number&#39;</span>] <span style="color: #666666">!=</span> row[<span style="color: #4070a0">&#39;round&#39;</span>]:
</span><span id="__span-0-1214"><a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>                        logger<span style="color: #666666">.</span>error(
</span><span id="__span-0-1215"><a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>                            <span style="color: #4070a0">f&quot;Error </span><span style="color: #70a0d0; font-style: italic">{</span>app<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0"> data extraction: subsession round_number &quot;</span>
</span><span id="__span-0-1216"><a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>                            <span style="color: #4070a0">&quot;does not match inferred round.&quot;</span>
</span><span id="__span-0-1217"><a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>                        )
</span><span id="__span-0-1218"><a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>                        <span style="color: #007020; font-weight: bold">raise</span> <span style="color: #007020">ValueError</span>(
</span><span id="__span-0-1219"><a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>                            <span style="color: #4070a0">f&quot;Error in </span><span style="color: #70a0d0; font-style: italic">{</span>app<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0"> data extraction: subsession round_number &quot;</span>
</span><span id="__span-0-1220"><a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>                            <span style="color: #4070a0">&quot;does not match inferred round.&quot;</span>
</span><span id="__span-0-1221"><a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>                        )
</span><span id="__span-0-1222"><a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>                <span style="color: #60a0b0; font-style: italic"># No data in subsession, so skip storing</span>
</span><span id="__span-0-1223"><a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>                <span style="color: #007020; font-weight: bold">continue</span>
</span><span id="__span-0-1224"><a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>
</span><span id="__span-0-1225"><a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>            <span style="color: #007020; font-weight: bold">elif</span> group_name <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;group&#39;</span>:
</span><span id="__span-0-1226"><a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>                <span style="color: #60a0b0; font-style: italic"># group data might or might not have data</span>
</span><span id="__span-0-1227"><a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>                <span style="color: #60a0b0; font-style: italic"># (only if there&#39;s more than one group or if there are </span>
</span><span id="__span-0-1228"><a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>                <span style="color: #60a0b0; font-style: italic"># group-level variables)</span>
</span><span id="__span-0-1229"><a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>
</span><span id="__span-0-1230"><a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>                sess_index <span style="color: #666666">=</span> {}
</span><span id="__span-0-1231"><a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>                <span style="color: #007020; font-weight: bold">for</span> srow <span style="color: #007020; font-weight: bold">in</span> session_data:
</span><span id="__span-0-1232"><a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>                    pcode <span style="color: #666666">=</span> srow<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;participant_code&#39;</span>, <span style="color: #007020; font-weight: bold">None</span>)
</span><span id="__span-0-1233"><a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>                    sess_index[pcode] <span style="color: #666666">=</span> srow
</span><span id="__span-0-1234"><a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>
</span><span id="__span-0-1235"><a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>                merged_group <span style="color: #666666">=</span> []
</span><span id="__span-0-1236"><a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>                cols <span style="color: #666666">=</span> <span style="color: #007020">set</span>()
</span><span id="__span-0-1237"><a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>                <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> out_df_rows:
</span><span id="__span-0-1238"><a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>                    pcode <span style="color: #666666">=</span> row<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;participant_code&#39;</span>, <span style="color: #007020; font-weight: bold">None</span>)
</span><span id="__span-0-1239"><a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>                    newrow <span style="color: #666666">=</span> <span style="color: #007020">dict</span>(row)
</span><span id="__span-0-1240"><a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>                    <span style="color: #007020; font-weight: bold">if</span> pcode <span style="color: #007020; font-weight: bold">in</span> sess_index:
</span><span id="__span-0-1241"><a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>                        <span style="color: #60a0b0; font-style: italic"># merge session data into newrow</span>
</span><span id="__span-0-1242"><a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>                        <span style="color: #007020; font-weight: bold">for</span> k, v <span style="color: #007020; font-weight: bold">in</span> sess_index[pcode]<span style="color: #666666">.</span>items():
</span><span id="__span-0-1243"><a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>                            <span style="color: #60a0b0; font-style: italic"># do not overwrite if we already have something</span>
</span><span id="__span-0-1244"><a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>                            <span style="color: #007020; font-weight: bold">if</span> k <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> (<span style="color: #4070a0">&#39;participant_code&#39;</span>, <span style="color: #4070a0">&#39;observation&#39;</span>, <span style="color: #4070a0">&#39;round&#39;</span>):
</span><span id="__span-0-1245"><a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>                                cols<span style="color: #666666">.</span>add(k)
</span><span id="__span-0-1246"><a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>                                newrow[k] <span style="color: #666666">=</span> v
</span><span id="__span-0-1247"><a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                    merged_group<span style="color: #666666">.</span>append(newrow)
</span><span id="__span-0-1248"><a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>                out_df_rows <span style="color: #666666">=</span> merged_group
</span><span id="__span-0-1249"><a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>
</span><span id="__span-0-1250"><a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>                <span style="color: #60a0b0; font-style: italic"># Check if &#39;id_in_subsession&#39; is all 1 - meaning there is only </span>
</span><span id="__span-0-1251"><a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                <span style="color: #60a0b0; font-style: italic"># one group per session</span>
</span><span id="__span-0-1252"><a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                all_id1 <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">True</span>
</span><span id="__span-0-1253"><a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> out_df_rows:
</span><span id="__span-0-1254"><a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>                    <span style="color: #007020; font-weight: bold">if</span> row<span style="color: #666666">.</span>get(<span style="color: #4070a0">&#39;id_in_subsession&#39;</span>) <span style="color: #666666">!=</span> <span style="color: #40a070">1</span>:
</span><span id="__span-0-1255"><a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>                        all_id1 <span style="color: #666666">=</span> <span style="color: #007020; font-weight: bold">False</span>
</span><span id="__span-0-1256"><a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>                        <span style="color: #007020; font-weight: bold">break</span>
</span><span id="__span-0-1257"><a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>
</span><span id="__span-0-1258"><a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>                <span style="color: #007020; font-weight: bold">if</span> all_id1:
</span><span id="__span-0-1259"><a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>                    <span style="color: #60a0b0; font-style: italic"># drop [&#39;id_in_subsession&#39;, &#39;participant_code&#39;]</span>
</span><span id="__span-0-1260"><a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>                    cleaned <span style="color: #666666">=</span> []
</span><span id="__span-0-1261"><a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>                    <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> out_df_rows:
</span><span id="__span-0-1262"><a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>                        newrow <span style="color: #666666">=</span> <span style="color: #007020">dict</span>(row)
</span><span id="__span-0-1263"><a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>                        newrow<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;id_in_subsession&#39;</span>, <span style="color: #007020; font-weight: bold">None</span>)
</span><span id="__span-0-1264"><a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>                        newrow<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;participant_code&#39;</span>, <span style="color: #007020; font-weight: bold">None</span>)
</span><span id="__span-0-1265"><a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>                        cleaned<span style="color: #666666">.</span>append(newrow)
</span><span id="__span-0-1266"><a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>                    out_df_rows <span style="color: #666666">=</span> cleaned
</span><span id="__span-0-1267"><a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>
</span><span id="__span-0-1268"><a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                    <span style="color: #60a0b0; font-style: italic"># If after dropping columns we are left with only 2 columns </span>
</span><span id="__span-0-1269"><a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>                    <span style="color: #60a0b0; font-style: italic"># (session_code, round), there is no group level data</span>
</span><span id="__span-0-1270"><a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>                    <span style="color: #007020; font-weight: bold">if</span> out_df_rows:
</span><span id="__span-0-1271"><a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>                        col_count <span style="color: #666666">=</span> <span style="color: #007020">len</span>(out_df_rows[<span style="color: #40a070">0</span>])
</span><span id="__span-0-1272"><a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>                        <span style="color: #007020; font-weight: bold">if</span> col_count <span style="color: #666666">==</span> <span style="color: #40a070">2</span>:
</span><span id="__span-0-1273"><a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>                            <span style="color: #60a0b0; font-style: italic"># skip storing</span>
</span><span id="__span-0-1274"><a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>                            <span style="color: #007020; font-weight: bold">continue</span>
</span><span id="__span-0-1275"><a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>                <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-1276"><a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>                    <span style="color: #60a0b0; font-style: italic"># rename id_in_subsession -&gt; group_id</span>
</span><span id="__span-0-1277"><a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>                    <span style="color: #60a0b0; font-style: italic"># build a map of group_id to participant_code</span>
</span><span id="__span-0-1278"><a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>                    cleaned <span style="color: #666666">=</span> []
</span><span id="__span-0-1279"><a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>                    group_participant_map <span style="color: #666666">=</span> []
</span><span id="__span-0-1280"><a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>                    <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> out_df_rows:
</span><span id="__span-0-1281"><a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>                        newrow <span style="color: #666666">=</span> <span style="color: #007020">dict</span>(row)
</span><span id="__span-0-1282"><a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>                        newmap <span style="color: #666666">=</span> <span style="color: #007020">dict</span>()
</span><span id="__span-0-1283"><a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                        newrow[<span style="color: #4070a0">&#39;group_id&#39;</span>] <span style="color: #666666">=</span> newrow<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;id_in_subsession&#39;</span>)
</span><span id="__span-0-1284"><a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                        newmap[<span style="color: #4070a0">&#39;participant_code&#39;</span>] <span style="color: #666666">=</span> newrow<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;participant_code&#39;</span>)
</span><span id="__span-0-1285"><a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>                        newmap[<span style="color: #4070a0">&#39;round&#39;</span>] <span style="color: #666666">=</span> newrow[<span style="color: #4070a0">&#39;round&#39;</span>]
</span><span id="__span-0-1286"><a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>                        newmap[<span style="color: #4070a0">&#39;group_id&#39;</span>] <span style="color: #666666">=</span> newrow[<span style="color: #4070a0">&#39;group_id&#39;</span>]
</span><span id="__span-0-1287"><a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>                        cleaned<span style="color: #666666">.</span>append(newrow)
</span><span id="__span-0-1288"><a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>                        group_participant_map<span style="color: #666666">.</span>append(newmap)
</span><span id="__span-0-1289"><a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>                    out_df_rows <span style="color: #666666">=</span> cleaned
</span><span id="__span-0-1290"><a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>
</span><span id="__span-0-1291"><a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>                <span style="color: #60a0b0; font-style: italic"># reorder columns</span>
</span><span id="__span-0-1292"><a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>                col_order <span style="color: #666666">=</span> [<span style="color: #4070a0">&#39;session_code&#39;</span>, <span style="color: #4070a0">&#39;round&#39;</span>]
</span><span id="__span-0-1293"><a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>                <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020; font-weight: bold">not</span> all_id1: col_order<span style="color: #666666">.</span>append(<span style="color: #4070a0">&#39;group_id&#39;</span>)
</span><span id="__span-0-1294"><a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>                out_df_rows <span style="color: #666666">=</span> convert_columns(
</span><span id="__span-0-1295"><a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                    reorder_columns(out_df_rows, col_order),
</span><span id="__span-0-1296"><a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>                    cols
</span><span id="__span-0-1297"><a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                )
</span><span id="__span-0-1298"><a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>
</span><span id="__span-0-1299"><a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>                <span style="color: #60a0b0; font-style: italic"># Deduplicate</span>
</span><span id="__span-0-1300"><a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>                unique_rows <span style="color: #666666">=</span> []
</span><span id="__span-0-1301"><a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>                seen <span style="color: #666666">=</span> <span style="color: #007020">set</span>()
</span><span id="__span-0-1302"><a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> out_df_rows:
</span><span id="__span-0-1303"><a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>                    <span style="color: #60a0b0; font-style: italic"># convert to a tuple of items</span>
</span><span id="__span-0-1304"><a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>                    row_tup <span style="color: #666666">=</span> <span style="color: #007020">tuple</span>(<span style="color: #007020">sorted</span>(row<span style="color: #666666">.</span>items()))
</span><span id="__span-0-1305"><a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>                    <span style="color: #007020; font-weight: bold">if</span> row_tup <span style="color: #007020; font-weight: bold">not</span> <span style="color: #007020; font-weight: bold">in</span> seen:
</span><span id="__span-0-1306"><a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>                        seen<span style="color: #666666">.</span>add(row_tup)
</span><span id="__span-0-1307"><a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>                        unique_rows<span style="color: #666666">.</span>append(row)
</span><span id="__span-0-1308"><a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>                out_df_rows <span style="color: #666666">=</span> unique_rows
</span><span id="__span-0-1309"><a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>
</span><span id="__span-0-1310"><a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>                final_tables[table_name] <span style="color: #666666">=</span> out_df_rows
</span><span id="__span-0-1311"><a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>
</span><span id="__span-0-1312"><a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>            <span style="color: #007020; font-weight: bold">elif</span> group_name <span style="color: #666666">==</span> <span style="color: #4070a0">&#39;player&#39;</span>:
</span><span id="__span-0-1313"><a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>                <span style="color: #60a0b0; font-style: italic"># rename id_in_group -&gt; player_id</span>
</span><span id="__span-0-1314"><a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>                <span style="color: #60a0b0; font-style: italic"># and merge with group_participant_map if it exists</span>
</span><span id="__span-0-1315"><a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>                cleaned <span style="color: #666666">=</span> []
</span><span id="__span-0-1316"><a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>                <span style="color: #007020; font-weight: bold">for</span> row <span style="color: #007020; font-weight: bold">in</span> out_df_rows:
</span><span id="__span-0-1317"><a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>                    newrow <span style="color: #666666">=</span> <span style="color: #007020">dict</span>(row)
</span><span id="__span-0-1318"><a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>                    newrow[<span style="color: #4070a0">&#39;player_id&#39;</span>] <span style="color: #666666">=</span> newrow<span style="color: #666666">.</span>pop(<span style="color: #4070a0">&#39;id_in_group&#39;</span>)
</span><span id="__span-0-1319"><a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>                    <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020; font-weight: bold">not</span> all_id1:
</span><span id="__span-0-1320"><a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>                        <span style="color: #007020; font-weight: bold">for</span> m <span style="color: #007020; font-weight: bold">in</span> group_participant_map:
</span><span id="__span-0-1321"><a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>                            <span style="color: #007020; font-weight: bold">if</span>  m[<span style="color: #4070a0">&#39;round&#39;</span>] <span style="color: #666666">==</span> newrow[<span style="color: #4070a0">&#39;round&#39;</span>] <span style="color: #007020; font-weight: bold">and</span> \
</span><span id="__span-0-1322"><a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                                m[<span style="color: #4070a0">&#39;participant_code&#39;</span>] <span style="color: #666666">==</span> newrow[<span style="color: #4070a0">&#39;participant_code&#39;</span>]:
</span><span id="__span-0-1323"><a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                                newrow[<span style="color: #4070a0">&#39;group_id&#39;</span>] <span style="color: #666666">=</span> m[<span style="color: #4070a0">&#39;group_id&#39;</span>]
</span><span id="__span-0-1324"><a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                                <span style="color: #007020; font-weight: bold">break</span>
</span><span id="__span-0-1325"><a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                    cleaned<span style="color: #666666">.</span>append(newrow)
</span><span id="__span-0-1326"><a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>                out_df_rows <span style="color: #666666">=</span> cleaned
</span><span id="__span-0-1327"><a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>                <span style="color: #60a0b0; font-style: italic"># reorder</span>
</span><span id="__span-0-1328"><a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020; font-weight: bold">not</span> all_id1:
</span><span id="__span-0-1329"><a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                    col_order <span style="color: #666666">=</span> [<span style="color: #4070a0">&#39;participant_code&#39;</span>, <span style="color: #4070a0">&#39;round&#39;</span>, <span style="color: #4070a0">&#39;group_id&#39;</span>, <span style="color: #4070a0">&#39;player_id&#39;</span>]
</span><span id="__span-0-1330"><a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-1331"><a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                    col_order <span style="color: #666666">=</span> [<span style="color: #4070a0">&#39;participant_code&#39;</span>, <span style="color: #4070a0">&#39;round&#39;</span>, <span style="color: #4070a0">&#39;player_id&#39;</span>]
</span><span id="__span-0-1332"><a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                out_df_rows <span style="color: #666666">=</span> reorder_columns(
</span><span id="__span-0-1333"><a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>                    out_df_rows, col_order
</span><span id="__span-0-1334"><a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                )
</span><span id="__span-0-1335"><a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                final_tables[table_name] <span style="color: #666666">=</span> out_df_rows
</span><span id="__span-0-1336"><a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>
</span><span id="__span-0-1337"><a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>            <span style="color: #007020; font-weight: bold">else</span>:
</span><span id="__span-0-1338"><a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>                <span style="color: #60a0b0; font-style: italic"># This should not happen - but if it does, store the data as is</span>
</span><span id="__span-0-1339"><a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                logger<span style="color: #666666">.</span>warning(
</span><span id="__span-0-1340"><a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                    <span style="color: #4070a0">f&quot;Unrecognized level name &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>group_name<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39; in app &#39;</span><span style="color: #70a0d0; font-style: italic">{</span>app<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">&#39;.&quot;</span>
</span><span id="__span-0-1341"><a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>                )
</span><span id="__span-0-1342"><a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>                final_tables[table_name] <span style="color: #666666">=</span> out_df_rows
</span><span id="__span-0-1343"><a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>
</span><span id="__span-0-1344"><a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>    <span style="color: #60a0b0; font-style: italic"># delete app names from table names if there is only one app</span>
</span><span id="__span-0-1345"><a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>    <span style="color: #007020; font-weight: bold">if</span> <span style="color: #007020">len</span>(apps) <span style="color: #666666">==</span> <span style="color: #40a070">1</span>:
</span><span id="__span-0-1346"><a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>        <span style="color: #007020; font-weight: bold">for</span> table_name <span style="color: #007020; font-weight: bold">in</span> final_tables<span style="color: #666666">.</span>keys():
</span><span id="__span-0-1347"><a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>                <span style="color: #007020; font-weight: bold">if</span> table_name<span style="color: #666666">.</span>startswith(apps[<span style="color: #40a070">0</span>] <span style="color: #666666">+</span> <span style="color: #4070a0">&#39;_&#39;</span>):
</span><span id="__span-0-1348"><a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>                    final_tables[table_name<span style="color: #666666">.</span>split(<span style="color: #4070a0">&#39;_&#39;</span>)[<span style="color: #666666">-</span><span style="color: #40a070">1</span>]] <span style="color: #666666">=</span> \
</span><span id="__span-0-1349"><a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>                        final_tables<span style="color: #666666">.</span>pop(table_name)
</span><span id="__span-0-1350"><a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>
</span><span id="__span-0-1351"><a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>
</span><span id="__span-0-1352"><a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>    <span style="color: #60a0b0; font-style: italic"># --- 5) Optionally store as CSV -------------------------------------------</span>
</span><span id="__span-0-1353"><a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>
</span><span id="__span-0-1354"><a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>    <span style="color: #007020; font-weight: bold">if</span> store_as_csv:
</span><span id="__span-0-1355"><a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span style="color: #007020; font-weight: bold">if</span> exp_prefix: exp_prefix <span style="color: #666666">+=</span> <span style="color: #4070a0">&#39;_&#39;</span>
</span><span id="__span-0-1356"><a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>        <span style="color: #007020; font-weight: bold">for</span> table_name, rows <span style="color: #007020; font-weight: bold">in</span> final_tables<span style="color: #666666">.</span>items():
</span><span id="__span-0-1357"><a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>            out_csv <span style="color: #666666">=</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(
</span><span id="__span-0-1358"><a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>                data_exp_path, <span style="color: #4070a0">f&quot;</span><span style="color: #70a0d0; font-style: italic">{</span>exp_prefix<span style="color: #70a0d0; font-style: italic">}{</span>table_name<span style="color: #70a0d0; font-style: italic">}</span><span style="color: #4070a0">.csv&quot;</span>
</span><span id="__span-0-1359"><a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>            )
</span><span id="__span-0-1360"><a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>            write_dicts_to_csv(rows, out_csv)
</span><span id="__span-0-1361"><a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>
</span><span id="__span-0-1362"><a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    logger<span style="color: #666666">.</span>info(<span style="color: #4070a0">f&quot;Normalizing data completed&quot;</span>)
</span><span id="__span-0-1363"><a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>    <span style="color: #007020; font-weight: bold">return</span> final_tables
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 - 2025 Fikir Worku Edossa and Joachim Gassen
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/joachim-gassen/botex" target="_blank" rel="noopener" title="Source Code" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/botex/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://bsky.app/profile/jgassen.bsky.social" target="_blank" rel="noopener" title="bsky.app" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2 42.1-31.6 110.3-56 110.3 21.8 0 15.5-8.9 130.5-14.1 149.2-18.2 64.8-84.4 81.4-143.3 71.3C456 322 482.2 380 425.6 438c-107.4 110.2-154.3-27.6-166.3-62.9-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8c-12 35.3-59 173.1-166.3 62.9-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1 10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["content.code.select", "content.code.copy", "navigation.tabs", "navigation.sections", "navigation.expand", "toc.integrate"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>